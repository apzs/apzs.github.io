import{_ as p}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as e,o as c,c as o,a as s,d as l,w as i,e as a,b as n}from"./app-db_OQQsY.js";const u={},k=a(`<h2 id="_5-6ã€å•†åŸä¸šåŠ¡-å¼‚æ­¥" tabindex="-1"><a class="header-anchor" href="#_5-6ã€å•†åŸä¸šåŠ¡-å¼‚æ­¥" aria-hidden="true">#</a> 5.6ã€å•†åŸä¸šåŠ¡-å¼‚æ­¥</h2><h3 id="_5-6-1ã€åˆå§‹åŒ–çº¿ç¨‹çš„4ç§æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_5-6-1ã€åˆå§‹åŒ–çº¿ç¨‹çš„4ç§æ–¹å¼" aria-hidden="true">#</a> 5.6.1ã€åˆå§‹åŒ–çº¿ç¨‹çš„4ç§æ–¹å¼</h3><p>åˆå§‹åŒ–çº¿ç¨‹çš„4ç§æ–¹å¼</p><ol><li>ç»§æ‰¿ Thread</li><li>å®ç° Runnable æ¥å£</li><li>å®ç° Callable æ¥å£ + FutureTask ï¼ˆå¯ä»¥æ‹¿åˆ°è¿”å›ç»“æœï¼Œå¯ä»¥å¤„ç†å¼‚å¸¸ï¼‰</li><li>çº¿ç¨‹æ± </li></ol><p>åœ¨<code>gulimall-search</code>æ¨¡å—çš„<code>com.atguigu.gulimall.search</code>åŒ…ä¸‹æ–°å»º<code>thread</code>æ–‡ä»¶å¤¹ï¼Œåœ¨<code>thread</code>æ–‡ä»¶å¤¹é‡Œæ–°å»º<code>ThreadTest</code>ç±»(çº¿ç¨‹çš„æµ‹è¯•ä¸é€‚åˆä½¿ç”¨æµ‹è¯•æ–¹æ³•æ¥æµ‹è¯•ï¼Œåªé€‚åˆåœ¨<code>main</code>æ–¹æ³•é‡Œæµ‹è¯•)</p><h4 id="_1ã€ç»§æ‰¿threadç±»" tabindex="-1"><a class="header-anchor" href="#_1ã€ç»§æ‰¿threadç±»" aria-hidden="true">#</a> 1ã€ç»§æ‰¿<code>Thread</code>ç±»</h4><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread01</span> thread01 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¯åŠ¨çº¿ç¨‹</span>
    thread01<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Thread01</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@SneakyThrows</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span><span class="token number">2</span> <span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
==========main end============
å½“å‰çº¿ç¨‹ï¼š12
è¿è¡Œç»“æœï¼š5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹å‡º<code>main</code>çº¿ç¨‹å’Œåˆšåˆšåˆ›å»ºçš„çº¿ç¨‹æ˜¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œ<code>main</code>çº¿ç¨‹æ‰§è¡Œå®Œååˆšåˆšåˆ›å»ºçš„çº¿ç¨‹ä¾æ—§åœ¨æ‰§è¡Œ</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.1.png" alt="image-20220731104410716" tabindex="0" loading="lazy"><figcaption>image-20220731104410716</figcaption></figure><h4 id="_2ã€å®ç°runnableæ¥å£" tabindex="-1"><a class="header-anchor" href="#_2ã€å®ç°runnableæ¥å£" aria-hidden="true">#</a> 2ã€å®ç°<code>Runnable</code>æ¥å£</h4><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Runnable02</span> runnable02 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> thread02 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>runnable02<span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread02<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Runnable02</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@SneakyThrows</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span><span class="token number">2</span> <span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
==========main end============
å½“å‰çº¿ç¨‹ï¼š12
è¿è¡Œç»“æœï¼š5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹å‡ºç»§æ‰¿<code>Thread</code>ç±»å’Œå®ç°<code>Runnable</code>æ¥å£è¾¾åˆ°çš„æ•ˆæœä¸€æ ·</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.2.png" alt="image-20220731104823314" tabindex="0" loading="lazy"><figcaption>image-20220731104823314</figcaption></figure><h4 id="_3ã€å®ç°-callable-æ¥å£-futuretask" tabindex="-1"><a class="header-anchor" href="#_3ã€å®ç°-callable-æ¥å£-futuretask" aria-hidden="true">#</a> 3ã€å®ç° Callable æ¥å£ + FutureTask</h4><h5 id="_1ã€å®ç°-callable-æ¥å£" tabindex="-1"><a class="header-anchor" href="#_1ã€å®ç°-callable-æ¥å£" aria-hidden="true">#</a> 1ã€å®ç° Callable æ¥å£</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Callable03</span> callable03 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Callable03</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> futureTask03 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>callable03<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> thread03 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask03<span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread03<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Callable03</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span><span class="token number">2</span> <span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
==========main end============
å½“å‰çº¿ç¨‹ï¼š12
è¿è¡Œç»“æœï¼š5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹å‡ºå¦‚æœä¸è·å–è¿”å›å€¼ï¼Œ<code>å®ç° Callable æ¥å£</code>å’Œç»§æ‰¿<code>Thread</code>ç±»ã€å®ç°<code>Runnable</code>æ¥å£è¾¾åˆ°çš„æ•ˆæœä¸€æ ·</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.3.1.png" alt="image-20220731105554127" tabindex="0" loading="lazy"><figcaption>image-20220731105554127</figcaption></figure><h5 id="_2ã€è·å–è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#_2ã€è·å–è¿”å›å€¼" aria-hidden="true">#</a> 2ã€è·å–è¿”å›å€¼</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Callable03</span> callable03 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Callable03</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> futureTask03 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>callable03<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> thread03 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask03<span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread03<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//é˜»å¡å¼ç­‰å¾…æ•´ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œè·å–è¿”å›ç»“æœ</span>
    <span class="token class-name">Integer</span> integer <span class="token operator">=</span> futureTask03<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿”å›çš„ç»“æœï¼š&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Callable03</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span><span class="token number">2</span> <span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
å½“å‰çº¿ç¨‹ï¼š12
è¿è¡Œç»“æœï¼š5
è¿”å›çš„ç»“æœï¼š5
==========main end============
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°<code>FutureTask</code>çš„<code>æ³›å‹ç±»å‹</code>å³ä¸º<code>è¿”å›ç±»å‹</code>ï¼Œå…¶<code>get()</code>æ–¹æ³•ä¸ºé˜»å¡æ–¹æ³•ï¼Œè°ƒç”¨<code>get()</code>æ–¹æ³•åï¼Œå¦‚æœæ²¡æœ‰è·å–åˆ°è¿”å›ç»“æœä¼šä¸€ç›´ç­‰å¾…ï¼Œè·å–åˆ°è¿”å›ç»“æœåæ‰ä¼šå¾€ä¸‹æ‰§è¡Œ</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.3.2.png" alt="image-20220731105922499" tabindex="0" loading="lazy"><figcaption>image-20220731105922499</figcaption></figure><h5 id="_3ã€å†æ¬¡æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3ã€å†æ¬¡æµ‹è¯•" aria-hidden="true">#</a> 3ã€å†æ¬¡æµ‹è¯•</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Callable03</span> callable03 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Callable03</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> futureTask03 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>callable03<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> thread03 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask03<span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread03<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å¯çº¿ç¨‹ä¹‹åï¼Œè·å–çº¿ç¨‹æ‰§è¡Œç»“æœä¹‹å‰...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//é˜»å¡å¼ç­‰å¾…æ•´ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œè·å–è¿”å›ç»“æœ</span>
    <span class="token class-name">Integer</span> integer <span class="token operator">=</span> futureTask03<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿”å›çš„ç»“æœï¼š&quot;</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Callable03</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span><span class="token number">2</span> <span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
å¼€å¯çº¿ç¨‹ä¹‹åï¼Œè·å–çº¿ç¨‹æ‰§è¡Œç»“æœä¹‹å‰...
å½“å‰çº¿ç¨‹ï¼š12
è¿è¡Œç»“æœï¼š5
è¿”å›çš„ç»“æœï¼š5
==========main end============
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°åªæœ‰è°ƒç”¨<code>FutureTask</code>ç±»çš„<code>get()</code>æ–¹æ³•æ‰ä¼šé˜»å¡ï¼Œå…¶å‰é¢çš„ä»£ç å¯ä»¥æ‰§è¡Œ</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.3.3.png" alt="image-20220731110952167" tabindex="0" loading="lazy"><figcaption>image-20220731110952167</figcaption></figure><h5 id="_4ã€futuretaskå‚æ•°" tabindex="-1"><a class="header-anchor" href="#_4ã€futuretaskå‚æ•°" aria-hidden="true">#</a> 4ã€<code>FutureTask</code>å‚æ•°</h5><p><code>FutureTask&lt;V&gt;</code>å®ç°äº†<code>RunnableFuture&lt;V&gt;</code>æ¥å£ï¼Œå¯ä»¥æ¥æ”¶<code>FutureTask(Callable&lt;V&gt; callable)</code>å’Œ<code>FutureTask(Runnable runnable, V result)</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.3.4.1.png" alt="image-20220731110130569" tabindex="0" loading="lazy"><figcaption>image-20220731110130569</figcaption></figure><p>å…¶ä¸­<code>FutureTask&lt;V&gt;</code>å®ç°çš„<code>RunnableFuture&lt;V&gt;</code>æ¥å£ç»§æ‰¿<code>Runnable</code>å’Œ<code> Future&lt;V&gt;</code></p><p>ğŸ“‘æ¥å£å¯ä»¥å¤šç»§æ‰¿ï¼Œä½†æ¥å£åªèƒ½ç»§æ‰¿æ¥å£ï¼Œæ¥å£ä¸èƒ½å®ç°æ¥å£ã€æŠ½è±¡ç±»ã€å®ä½“ç±»</p><p>æŠ½è±¡ç±»ä¸å¯ä»¥ç»§æ‰¿æ¥å£ï¼Œä½†å¯ä»¥å®ç°æ¥å£</p><p>æŠ½è±¡ç±»å¯ä»¥ç»§æ‰¿å®ä½“ç±»ï¼Œä½†å®ä½“ç±»å¿…é¡»æœ‰æ˜ç¡®çš„æ„é€ å‡½æ•°ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * A <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Future</span></span><span class="token punctuation">}</span> that is <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Runnable</span></span><span class="token punctuation">}</span>. Successful execution of
 * the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">run</span></span><span class="token punctuation">}</span> method causes completion of the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Future</span></span></span><span class="token punctuation">}</span>
 * and allows access to its results.
 * <span class="token keyword">@see</span> <span class="token reference"><span class="token class-name">FutureTask</span></span>
 * <span class="token keyword">@see</span> <span class="token reference"><span class="token class-name">Executor</span></span>
 * <span class="token keyword">@since</span> 1.6
 * <span class="token keyword">@author</span> Doug Lea
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>V<span class="token punctuation">&gt;</span></span> The result type returned by this Future&#39;s <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">get</span></span><span class="token punctuation">}</span> method
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Runnable</span><span class="token punctuation">,</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * Sets this Future to the result of its computation
     * unless it has been cancelled.
     */</span>
    <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.3.4.2.png" alt="image-20220731110517293" tabindex="0" loading="lazy"><figcaption>image-20220731110517293</figcaption></figure><p><code>FutureTask&lt;V&gt;</code>çš„æ„é€ å™¨å¯ä»¥ä¼ <code>Callable&lt;V&gt; callable</code>å‚æ•°</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Creates a <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">FutureTask</span></span></span><span class="token punctuation">}</span> that will, upon running, execute the
 * given <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Callable</span></span></span><span class="token punctuation">}</span>.
 *
 * <span class="token keyword">@param</span>  <span class="token parameter">callable</span> the callable task
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">NullPointerException</span></span> if the callable is null
 */</span>
<span class="token keyword">public</span> <span class="token class-name">FutureTask</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> callable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>callable <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callable <span class="token operator">=</span> callable<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">NEW</span><span class="token punctuation">;</span>       <span class="token comment">// ensure visibility of callable</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.3.4.3.png" alt="image-20220731110236524" tabindex="0" loading="lazy"><figcaption>image-20220731110236524</figcaption></figure><p><code>FutureTask&lt;V&gt;</code>çš„æ„é€ å™¨ä¹Ÿå¯ä»¥ä¼ <code>Runnable runnable, V result</code>ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­<code>V result</code>ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡è·å–ç»“æœçš„è¿”å›å€¼</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Creates a <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">FutureTask</span></span></span><span class="token punctuation">}</span> that will, upon running, execute the
 * given <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Runnable</span></span></span><span class="token punctuation">}</span>, and arrange that <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">get</span></span><span class="token punctuation">}</span> will return the
 * given result on successful completion.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">runnable</span> the runnable task
 * <span class="token keyword">@param</span> <span class="token parameter">result</span> the result to return on successful completion. If
 * you don&#39;t need a particular result, consider using
 * constructions of the form:
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>runnable<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span>
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">NullPointerException</span></span> if the runnable is null
 */</span>
<span class="token keyword">public</span> <span class="token class-name">FutureTask</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">,</span> <span class="token class-name">V</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callable <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">callable</span><span class="token punctuation">(</span>runnable<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token constant">NEW</span><span class="token punctuation">;</span>       <span class="token comment">// ensure visibility of callable</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.3.4.4.png" alt="image-20220731110324080" tabindex="0" loading="lazy"><figcaption>image-20220731110324080</figcaption></figure><h4 id="_4ã€çº¿ç¨‹æ± " tabindex="-1"><a class="header-anchor" href="#_4ã€çº¿ç¨‹æ± " aria-hidden="true">#</a> 4ã€çº¿ç¨‹æ± </h4><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
==========main end============
å½“å‰çº¿ç¨‹ï¼š12
è¿è¡Œç»“æœï¼š5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°å›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹åï¼Œè¯¥çº¿ç¨‹æ± ä¸ä¼šæ¶ˆå¤±ï¼Œæ§åˆ¶å°å¯ä»¥çœ‹å‡ºè¿˜åœ¨ä¸€ç›´è¿è¡Œ</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.4.1.png" alt="image-20220731111834984" tabindex="0" loading="lazy"><figcaption>image-20220731111834984</figcaption></figure><p><code>ExecutorService</code>ç±»æœ‰<code>submit</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æœ‰è¿”å›å€¼ã€‚è€Œ<code>execute</code>æ–¹æ³•æ²¡æœ‰è¿”å›å€¼</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.4.2.png" alt="image-20220731111723003" tabindex="0" loading="lazy"><figcaption>image-20220731111723003</figcaption></figure><h4 id="_5ã€çº¿ç¨‹æ± ä¸ƒå¤§å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_5ã€çº¿ç¨‹æ± ä¸ƒå¤§å‚æ•°" aria-hidden="true">#</a> 5ã€çº¿ç¨‹æ± ä¸ƒå¤§å‚æ•°</h4><pre><code>ä¸ƒå¤§å‚æ•°ï¼š
1ã€int corePoolSize    [5]æ ¸å¿ƒçº¿ç¨‹æ•°; çº¿ç¨‹æ± ï¼Œåˆ›å»ºå¥½ä»¥åå°±å‡†å¤‡å°±ä¸€ç›´å­˜åœ¨ã€é™¤éè®¾ç½®(allowCoreThreadTimeOut)ã€‘
                       5ä¸ª Thread thread = new Thread(); thread.start();
2ã€int maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°é‡ï¼Œæ§åˆ¶èµ„æº
3ã€long keepAliveTime  å­˜æ´»æ—¶é—´ã€‚å¦‚æœå½“å‰çš„çº¿ç¨‹æ•°é‡å¤§äºcoreæ•°é‡ï¼Œå¹¶ä¸”çº¿ç¨‹ç©ºé—²æ—¶é—´å¤§äºæŒ‡å®šçš„å­˜æ´»æ—¶é—´ï¼Œå°±é‡Šæ”¾ç©ºé—²çš„çº¿ç¨‹(æœ€å°‘ä¿							ç•™corePoolSizeä¸ª)ã€‚
4ã€TimeUnit unit       æ—¶é—´å•ä½
5ã€BlockingQueue&lt;Runnable&gt; workQueue é˜»å¡é˜Ÿåˆ—ã€‚å¦‚æœä»»åŠ¡æœ‰å¾ˆå¤šï¼Œå°±ä¼šå°†ç›®å‰å¤šçš„ä»»åŠ¡æ”¾åœ¨é˜Ÿåˆ—é‡Œé¢ã€‚
                                      åªè¦æœ‰çº¿ç¨‹ç©ºç”¨ï¼Œå°±ä¼šå»é˜Ÿåˆ—é‡Œé¢å–å‡ºæ–°çš„ä»»åŠ¡ç»§ç»­æ‰§è¡Œã€‚
 6ã€ThreadFactory threadFactory çº¿ç¨‹çš„åˆ›å»ºå·¥å‚
7ã€RejectedExecutionHandler handler æ‹’ç»ç­–ç•¥ å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼ŒæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„æ‹’ç»ç­–ç•¥æ‹’ç»æ‰§è¡Œä»»åŠ¡
</code></pre><h5 id="_1ã€æ‹’ç»ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_1ã€æ‹’ç»ç­–ç•¥" aria-hidden="true">#</a> 1ã€æ‹’ç»ç­–ç•¥</h5><p>åœ¨<code>java.util.concurrent.RejectedExecutionHandler</code>ç±»é‡Œï¼Œä½¿ç”¨<code>ctrl + H</code>å¿«æ·é”®ï¼ŒæŸ¥çœ‹å…¶å…·ä½“å®ç°ç±»ï¼Œå¯ä»¥çœ‹åˆ°ä¸»è¦æœ‰ä»¥ä¸‹å››ä¸ªå¸¸ç”¨æ‹’ç»æµ‹è¯•</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>java.util.concurrent.ThreadPoolExecutor.DiscardOldestPolicy ä¸¢å¼ƒæœ€è€çš„ä»»åŠ¡
java.util.concurrent.ThreadPoolExecutor.AbortPolicy         ä¸¢å¼ƒåˆšæ¥çš„ä»»åŠ¡ï¼Œå¹¶æŠ›å¼‚å¸¸
java.util.concurrent.ThreadPoolExecutor.CallerRunsPolicy    ä¸æ‰§è¡Œstart()ï¼Œç›´æ¥è°ƒç”¨run()æ–¹æ³•
java.util.concurrent.ThreadPoolExecutor.DiscardPolicy       ä¸¢å¼ƒåˆšæ¥çš„ä»»åŠ¡ï¼Œä¸æŠ›å¼‚å¸¸
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.5.1.png" alt="image-20220731131107234" tabindex="0" loading="lazy"><figcaption>image-20220731131107234</figcaption></figure><h5 id="_2ã€æµ‹è¯•ä»£ç " tabindex="-1"><a class="header-anchor" href="#_2ã€æµ‹è¯•ä»£ç " aria-hidden="true">#</a> 2ã€æµ‹è¯•ä»£ç </h5><p>ä»¥ä¸‹ä¸º<code>ThreadPoolExecutor</code>ç±»åˆ›å»ºå¯¹è±¡çš„ç¤ºä¾‹ä»£ç </p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ä¸ƒå¤§å‚æ•°ï¼š
 * 1ã€int corePoolSize    [5]æ ¸å¿ƒçº¿ç¨‹æ•°; çº¿ç¨‹æ± ï¼Œåˆ›å»ºå¥½ä»¥åå°±å‡†å¤‡å°±ä¸€ç›´å­˜åœ¨ã€é™¤éè®¾ç½®(allowCoreThreadTimeOut)ã€‘
 *                        5ä¸ª Thread thread = new Thread(); thread.start();
 * 2ã€int maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°é‡ï¼Œæ§åˆ¶èµ„æº
 * 3ã€long keepAliveTime  å­˜æ´»æ—¶é—´ã€‚å¦‚æœå½“å‰çš„çº¿ç¨‹æ•°é‡å¤§äºcoreæ•°é‡ï¼Œå¹¶ä¸”çº¿ç¨‹ç©ºé—²æ—¶é—´å¤§äºæŒ‡å®šçš„å­˜æ´»æ—¶é—´ï¼Œå°±é‡Šæ”¾ç©ºé—²çš„çº¿ç¨‹(æœ€å°‘ä¿ç•™corePoolSizeä¸ª)ã€‚
 * 4ã€TimeUnit unit       æ—¶é—´å•ä½
 * 5ã€BlockingQueue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Runnable</span><span class="token punctuation">&gt;</span></span> workQueue é˜»å¡é˜Ÿåˆ—ã€‚å¦‚æœä»»åŠ¡æœ‰å¾ˆå¤šï¼Œå°±ä¼šå°†ç›®å‰å¤šçš„ä»»åŠ¡æ”¾åœ¨é˜Ÿåˆ—é‡Œé¢ã€‚
 *                                      åªè¦æœ‰çº¿ç¨‹ç©ºç”¨ï¼Œå°±ä¼šå»é˜Ÿåˆ—é‡Œé¢å–å‡ºæ–°çš„ä»»åŠ¡ç»§ç»­æ‰§è¡Œã€‚
 * 6ã€ThreadFactory threadFactory çº¿ç¨‹çš„åˆ›å»ºå·¥å‚
 * 7ã€RejectedExecutionHandler handler æ‹’ç»ç­–ç•¥ å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼ŒæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„æ‹’ç»ç­–ç•¥æ‹’ç»æ‰§è¡Œä»»åŠ¡
 *
 * è¿è¡Œæµç¨‹ï¼š
 * 1ã€çº¿ç¨‹æ± åˆ›å»ºï¼Œå‡†å¤‡å¥½ core  æ•°é‡çš„æ ¸å¿ƒçº¿ç¨‹ï¼Œå‡†å¤‡æ¥å—ä»»åŠ¡
 * 2ã€æ–°çš„ä»»åŠ¡è¿›æ¥ï¼Œç”¨ core å‡†å¤‡å¥½çš„ç©ºé—²çº¿ç¨‹æ‰§è¡Œã€‚
 *      (1)ã€core æ»¡äº†ï¼Œå°±å°†å†è¿›æ¥çš„ä»»åŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­ã€‚ç©ºé—²çš„ core å°±ä¼šè‡ªå·±å»é˜»å¡é˜Ÿåˆ—è·å–ä»»åŠ¡æ‰§è¡Œ
 *      (2)ã€é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œå°±ç›´æ¥å¼€æ–°çº¿ç¨‹æ‰§è¡Œï¼Œæœ€å¤§åªèƒ½å¼€åˆ° max  æŒ‡å®šçš„æ•°é‡
 *      (3)ã€max éƒ½æ‰§è¡Œå¥½äº†ã€‚max-core æ•°é‡ç©ºé—²çš„çº¿ç¨‹ä¼šåœ¨ keepAliveTime æŒ‡å®šçš„æ—¶é—´åè‡ªåŠ¨é”€æ¯ã€‚æœ€ç»ˆä¿æŒåˆ° core å¤§å°
 *      (4)ã€å¦‚æœçº¿ç¨‹æ•°å¼€åˆ°äº† max çš„æ•°é‡ï¼Œè¿˜æœ‰æ–°ä»»åŠ¡è¿›æ¥ï¼Œå°±ä¼šä½¿ç”¨ reject æŒ‡å®šçš„æ‹’ç»ç­–ç•¥è¿›è¡Œå¤„ç†
 * 3ã€æ‰€æœ‰çš„çº¿ç¨‹åˆ›å»ºéƒ½æ˜¯ç”±æŒ‡å®šçš„ factory åˆ›å»ºçš„ã€‚
 */</span>
<span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token number">200</span><span class="token punctuation">,</span>
        <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span>
        <span class="token comment">//new LinkedBlockingDeque&lt;&gt;() æ—¶ä¸€å®šè¦è®¾ç½®å®¹é‡ï¼Œé»˜è®¤æ˜¯Integer.MAX_VALUEï¼Œä¼šå¯¼è‡´å†…å­˜ä¸å¤Ÿ</span>
        <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.5.2.png" alt="image-20220731132530881" tabindex="0" loading="lazy"><figcaption>image-20220731132530881</figcaption></figure><h5 id="_3ã€çº¿ç¨‹æ± å·¥å…·ç±»" tabindex="-1"><a class="header-anchor" href="#_3ã€çº¿ç¨‹æ± å·¥å…·ç±»" aria-hidden="true">#</a> 3ã€çº¿ç¨‹æ± å·¥å…·ç±»</h5><p><code>Executors</code>å·¥å…·ç±»æœ‰ä»¥ä¸‹4ä¸ªå¸¸ç”¨æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *
 * ä¸€ä¸ªçº¿ç¨‹æ± core 7;max 20; queue 50ï¼Œ 100å¹¶å‘è¿›æ¥æ€ä¹ˆåˆ†é…çš„;
 * ç­”ï¼š7ä¸ªä¼šç«‹å³å¾—åˆ°æ‰§è¡Œï¼Œ50ä¸ªä¼šè¿›å…¥é˜Ÿåˆ—ï¼Œå†å¼€13ä¸ªè¿›è¡Œæ‰§è¡Œã€‚å‰©ä¸‹çš„30ä¸ªå°±ä½¿ç”¨æ‹’ç»ç­–ç•¥ã€‚
 */</span>

<span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//coreæ˜¯0ï¼Œæ‰€æœ‰éƒ½å¯å›æ”¶</span>
<span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å›ºå®šå¤§å°ï¼Œcore=max; éƒ½ä¸å¯å›æ”¶</span>
<span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å®šæ—¶ä»»åŠ¡çš„çº¿ç¨‹æ±  DelayedWorkQueue</span>
<span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œåå°ä»é˜Ÿåˆ—é‡Œé¢è·å–ä»»åŠ¡ï¼ŒæŒ¨ä¸ªæ‰§è¡Œ</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.5.3.png" alt="image-20220731133132597" tabindex="0" loading="lazy"><figcaption>image-20220731133132597</figcaption></figure><h5 id="_4ã€æºä»£ç " tabindex="-1"><a class="header-anchor" href="#_4ã€æºä»£ç " aria-hidden="true">#</a> 4ã€æºä»£ç </h5><p><code>ThreadPoolExecutor</code>ç±»ä½äº<code>java.util.concurrent.ThreadPoolExecutor</code>(JUC)åŒ…ï¼Œå…¶ä¸ƒå¤§å‚æ•°ä¸º</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Creates a new <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">ThreadPoolExecutor</span></span></span><span class="token punctuation">}</span> with the given initial
 * parameters.
 *ä½¿ç”¨ç»™å®šçš„åˆå§‹åŒ–å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„<span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">ThreadPoolExecutor</span></span></span><span class="token punctuation">}</span>ã€‚ 
 * <span class="token keyword">@param</span> <span class="token parameter">corePoolSize</span> the number of threads to keep in the pool, even
 *        if they are idle, unless <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">allowCoreThreadTimeOut</span></span><span class="token punctuation">}</span> is set
 *        ä¿ç•™åœ¨æ± ä¸­çš„çº¿ç¨‹æ•°ï¼Œå³ä½¿å®ƒä»¬æ˜¯ç©ºé—²çš„ï¼Œé™¤éè®¾ç½®äº† <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">allowCoreThreadTimeOut</span></span><span class="token punctuation">}</span> 
 * <span class="token keyword">@param</span> <span class="token parameter">maximumPoolSize</span> the maximum number of threads to allow in the
 *        pool
 *		  æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•° 
 * <span class="token keyword">@param</span> <span class="token parameter">keepAliveTime</span> when the number of threads is greater than
 *        the core, this is the maximum time that excess idle threads
 *        will wait for new tasks before terminating.
 *        å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œè¿™äº›å¤šä½™çš„ç©ºé—²çº¿ç¨‹åœ¨ç»ˆæ­¢å‰ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€é•¿æ—¶é—´ã€‚
 * <span class="token keyword">@param</span> <span class="token parameter">unit</span> the time unit for the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">keepAliveTime</span></span><span class="token punctuation">}</span> argument
 *        å‚æ•°çš„æ—¶é—´å•ä½
 * <span class="token keyword">@param</span> <span class="token parameter">workQueue</span> the queue to use for holding tasks before they are
 *        executed.  This queue will hold only the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Runnable</span></span></span><span class="token punctuation">}</span>
 *        tasks submitted by the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">execute</span></span><span class="token punctuation">}</span> method.
 *		  ç”¨äºåœ¨æ‰§è¡Œä»»åŠ¡ä¹‹å‰ä¿å­˜ä»»åŠ¡çš„é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—å°†ä»…ä¿å­˜ç”± <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">execute</span></span><span class="token punctuation">}</span> æ–¹æ³•æäº¤çš„ <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Runnable</span></span></span><span class="token punctuation">}</span> ä»»åŠ¡ã€‚ 
 * <span class="token keyword">@param</span> <span class="token parameter">threadFactory</span> the factory to use when the executor
 *        creates a new thread
 *        æ‰§è¡Œç¨‹åºåˆ›å»ºæ–°çº¿ç¨‹æ—¶ä½¿ç”¨çš„å·¥å‚ 
 * <span class="token keyword">@param</span> <span class="token parameter">handler</span> the handler to use when execution is blocked
 *        because the thread bounds and queue capacities are reached
 		  æ‰§è¡Œå› è¾¾åˆ°çº¿ç¨‹è¾¹ç•Œå’Œé˜Ÿåˆ—å®¹é‡è€Œè¢«é˜»å¡æ—¶ä½¿ç”¨çš„å¤„ç†ç¨‹åº
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IllegalArgumentException</span></span> if one of the following holds:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 *		   <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">IllegalArgumentException</span></span> å¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ä¹‹ä¸€ï¼š
 *         <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">corePoolSize <span class="token operator">&lt;</span> <span class="token number">0</span></span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 *         <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">keepAliveTime <span class="token operator">&lt;</span> <span class="token number">0</span></span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 *         <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">maximumPoolSize <span class="token operator">&lt;=</span> <span class="token number">0</span></span></span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
 *         <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">maximumPoolSize <span class="token operator">&lt;</span> corePoolSize</span></span><span class="token punctuation">}</span>
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">NullPointerException</span></span> if <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">workQueue</span></span><span class="token punctuation">}</span>
 *         or <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">threadFactory</span></span><span class="token punctuation">}</span> or <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">handler</span></span><span class="token punctuation">}</span> is null
 */</span>
<span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                          <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                          <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span>
                          <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span>
                          <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>corePoolSize <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span>
        maximumPoolSize <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span>
        maximumPoolSize <span class="token operator">&lt;</span> corePoolSize <span class="token operator">||</span>
        keepAliveTime <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>workQueue <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> threadFactory <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>acc <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span>
            <span class="token keyword">null</span> <span class="token operator">:</span>
            <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>corePoolSize <span class="token operator">=</span> corePoolSize<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>maximumPoolSize <span class="token operator">=</span> maximumPoolSize<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>workQueue <span class="token operator">=</span> workQueue<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>keepAliveTime <span class="token operator">=</span> unit<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span>keepAliveTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>threadFactory <span class="token operator">=</span> threadFactory<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handler <span class="token operator">=</span> handler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.1.5.4.png" alt="image-20220731123732874" tabindex="0" loading="lazy"><figcaption>image-20220731123732874</figcaption></figure><h4 id="_6ã€å¼€å‘ä¸­ä½¿ç”¨çº¿ç¨‹æ± çš„åŸå› " tabindex="-1"><a class="header-anchor" href="#_6ã€å¼€å‘ä¸­ä½¿ç”¨çº¿ç¨‹æ± çš„åŸå› " aria-hidden="true">#</a> 6ã€å¼€å‘ä¸­ä½¿ç”¨çº¿ç¨‹æ± çš„åŸå› </h4><ul><li>é™ä½èµ„æºçš„æ¶ˆè€—</li><li>é€šè¿‡é‡å¤åˆ©ç”¨å·²ç»åˆ›å»ºå¥½çš„çº¿ç¨‹é™ä½çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯å¸¦æ¥çš„æŸè€—</li><li>æé«˜å“åº”é€Ÿåº¦</li><li>å› ä¸ºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°æ²¡æœ‰è¶…è¿‡çº¿ç¨‹æ± çš„æœ€å¤§ä¸Šé™æ—¶ï¼Œæœ‰çš„çº¿ç¨‹å¤„äºç­‰å¾…åˆ†é…ä»»åŠ¡çš„çŠ¶æ€ï¼Œå½“ä»»åŠ¡æ¥æ—¶æ— éœ€åˆ›å»ºæ–°çš„çº¿ç¨‹å°±èƒ½æ‰§è¡Œ</li><li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§</li><li>çº¿ç¨‹æ± ä¼šæ ¹æ®å½“å‰ç³»ç»Ÿç‰¹ç‚¹å¯¹æ± å†…çš„çº¿ç¨‹è¿›è¡Œä¼˜åŒ–å¤„ç†ï¼Œå‡å°‘åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹å¸¦æ¥çš„ç³»ç»Ÿå¼€é”€ã€‚æ— é™çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ä¸ä»…æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜é™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± è¿›è¡Œç»Ÿä¸€åˆ†é…</li></ul><h4 id="_7ã€å®Œæ•´ä»£ç " tabindex="-1"><a class="header-anchor" href="#_7ã€å®Œæ•´ä»£ç " aria-hidden="true">#</a> 7ã€å®Œæ•´ä»£ç </h4><p><a href="code/5.6.1.7.ThreadTest.java">ç‚¹å‡»æŸ¥çœ‹<code>ThreadTest</code>ç±»å®Œæ•´ä»£ç </a></p><h3 id="_5-6-2ã€completablefuture-å¼‚æ­¥ç¼–æ’" tabindex="-1"><a class="header-anchor" href="#_5-6-2ã€completablefuture-å¼‚æ­¥ç¼–æ’" aria-hidden="true">#</a> 5.6.2ã€CompletableFuture å¼‚æ­¥ç¼–æ’</h3><p><code>Future</code>çš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º</p><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.0.png" alt="image-20220801213339920" style="zoom:67%;"><p><strong>ä¸šåŠ¡åœºæ™¯</strong></p><p>æŸ¥è¯¢å•†å“è¯¦æƒ…é¡µçš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæœ‰äº›æ•°æ®è¿˜éœ€è¦è¿œç¨‹è°ƒç”¨ï¼Œå¿…ç„¶éœ€è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚</p><p>å‡å¦‚å•†å“è¯¦æƒ…é¡µçš„æ¯ä¸ªæŸ¥è¯¢ï¼Œéœ€è¦å¦‚ä¸‹æ ‡æ³¨çš„æ—¶é—´æ‰èƒ½å®Œæˆã€‚é‚£ä¹ˆï¼Œç”¨æˆ·éœ€è¦ 5.5s åæ‰èƒ½çœ‹åˆ°å•†å“è¯¦æƒ…é¡µçš„å†…å®¹ã€‚å¾ˆæ˜¾ç„¶æ˜¯ä¸èƒ½æ¥å—çš„ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å®Œæˆè¿™ 6 æ­¥æ“ä½œï¼Œä¹Ÿè®¸åªéœ€è¦ 1.5s å³å¯å®Œæˆå“åº”ã€‚</p><table><thead><tr><th>åºå·</th><th>è¦æ‰§è¡Œçš„ä¸šåŠ¡</th><th>è€—æ—¶</th></tr></thead><tbody><tr><td>1</td><td>è·å–skuçš„åŸºæœ¬ä¿¡æ¯</td><td>0.5s</td></tr><tr><td>2</td><td>è·å–skuçš„å›¾ç‰‡ä¿¡æ¯</td><td>0.5s</td></tr><tr><td>3</td><td>è·å–skuçš„ä¿ƒé”€ä¿¡æ¯</td><td>1s</td></tr><tr><td>4</td><td>è·å–spuçš„æ‰€æœ‰é”€å”®å±æ€§</td><td>1s</td></tr><tr><td>5</td><td>è·å–è§„æ ¼å‚æ•°ç»„åŠç»„ä¸‹çš„è§„æ ¼å‚æ•°</td><td>1.5s</td></tr><tr><td>6</td><td>spuè¯¦æƒ…</td><td>1s</td></tr></tbody></table><p><code>1</code>ã€<code>2</code>ã€<code>3</code>å¯ä»¥åŒæ—¶æ‰§è¡Œï¼Œè€Œ<code>4</code>ã€<code>5</code>ã€<code>6</code>å¿…é¡»å¾—åˆ°<code>1</code>çš„è¿”å›ç»“æœåæ‰èƒ½æ‰§è¡Œï¼Œ<code>4</code>ã€<code>5</code>ã€<code>6</code>ä¹‹é—´å¯ä»¥åŒæ—¶æ‰§è¡Œ</p><h4 id="_1ã€åˆ›å»ºå¼‚æ­¥å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_1ã€åˆ›å»ºå¼‚æ­¥å¯¹è±¡" aria-hidden="true">#</a> 1ã€åˆ›å»ºå¼‚æ­¥å¯¹è±¡</h4><h5 id="_1ã€å¸¸ç”¨æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_1ã€å¸¸ç”¨æ–¹æ³•" aria-hidden="true">#</a> 1ã€å¸¸ç”¨æ–¹æ³•</h5><p><code>CompletableFuture</code>ç±»æä¾›äº†å››ä¸ªé™æ€æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>runAsync</code>æ–¹æ³•éƒ½æ˜¯æ²¡æœ‰è¿”å›ç»“æœçš„</li><li><code> supplyAsync</code>æ–¹æ³•éƒ½æ˜¯å¯ä»¥è·å–è¿”å›ç»“æœçš„</li><li>å¯ä»¥ä¼ å…¥è‡ªå®šä¹‰çš„çº¿ç¨‹æ± ï¼Œå¦åˆ™å°±ç”¨é»˜è®¤çš„çº¿ç¨‹æ± ï¼›</li></ul><h5 id="_2ã€runasyncæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_2ã€runasyncæ–¹æ³•" aria-hidden="true">#</a> 2ã€<code>runAsync</code>æ–¹æ³•</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span><span class="token number">2</span> <span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
==========main end============
å½“å‰çº¿ç¨‹ï¼š12
è¿è¡Œç»“æœï¼š5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°è¯¥æ–¹æ³•ä¸éœ€è¦æœ‰è¿”å›å€¼ï¼Œä¸”è¯¥æ–¹æ³•ä¸ä¼šåœæ­¢ï¼Œçº¿ç¨‹æ± é‡Œçš„æ ¸å¿ƒçº¿ç¨‹ä¸ä¼šæ¶ˆå¤±</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.1.2.png" alt="image-20220731140708664" tabindex="0" loading="lazy"><figcaption>image-20220731140708664</figcaption></figure><h5 id="_3ã€supplyasyncæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_3ã€supplyasyncæ–¹æ³•" aria-hidden="true">#</a> 3ã€<code>supplyAsync</code>æ–¹æ³•</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span><span class="token number">2</span> <span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
==========main end============
å½“å‰çº¿ç¨‹ï¼š12
è¿è¡Œç»“æœï¼š5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°è¯¥æ–¹æ³•æœ‰è¿”å›å€¼ï¼Œä¸”è¯¥æ–¹æ³•ä¸ä¼šåœæ­¢ï¼Œçº¿ç¨‹æ± é‡Œçš„æ ¸å¿ƒçº¿ç¨‹ä¸ä¼šæ¶ˆå¤±</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.1.3.png" alt="image-20220731140835585" tabindex="0" loading="lazy"><figcaption>image-20220731140835585</figcaption></figure><h5 id="_4ã€supplyasyncæ–¹æ³•è·å–è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#_4ã€supplyasyncæ–¹æ³•è·å–è¿”å›å€¼" aria-hidden="true">#</a> 4ã€<code>supplyAsync</code>æ–¹æ³•è·å–è¿”å›å€¼</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å¯çº¿ç¨‹ä¹‹åï¼Œè·å–çº¿ç¨‹æ‰§è¡Œç»“æœä¹‹å‰...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//é˜»å¡å¼ç­‰å¾…æ•´ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œè·å–è¿”å›ç»“æœ</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
å¼€å¯çº¿ç¨‹ä¹‹åï¼Œè·å–çº¿ç¨‹æ‰§è¡Œç»“æœä¹‹å‰...
å½“å‰çº¿ç¨‹ï¼š12
è¿è¡Œç»“æœï¼š5
5
==========main end============
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥é€šè¿‡<code>future.get()</code>æ–¹æ³•è·å–æ–¹æ³•çš„è¿”å›å€¼ï¼Œä¸”è¯¥æ–¹æ³•æ˜¯é˜»å¡æ–¹æ³•ï¼Œæ²¡æœ‰è·å–åˆ°è¿”å›å€¼ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è·å–åˆ°è¿”å›å€¼åï¼Œæ‰ä¼šæ‰§è¡Œä¸‹é¢çš„ä»£ç </p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.1.4.png" alt="image-20220731141206092" tabindex="0" loading="lazy"><figcaption>image-20220731141206092</figcaption></figure><h5 id="_5ã€æºç " tabindex="-1"><a class="header-anchor" href="#_5ã€æºç " aria-hidden="true">#</a> 5ã€æºç </h5><p><code>CompletableFuture</code>ç±»ä½äº<code>java.util.concurrent</code>ï¼ˆJUCï¼‰åŒ…ä¸‹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Returns a new CompletableFuture that is asynchronously completed
 * by a task running in the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">ForkJoinPool</span><span class="token punctuation">#</span><span class="token function">commonPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> with
 * the value obtained by calling the given Supplier.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">supplier</span> a function returning the value to be used
 * to complete the returned CompletableFuture
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>U<span class="token punctuation">&gt;</span></span> the function&#39;s return type
 * <span class="token keyword">@return</span> the new CompletableFuture
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asyncSupplyStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> supplier<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Returns a new CompletableFuture that is asynchronously completed
 * by a task running in the given executor with the value obtained
 * by calling the given Supplier.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">supplier</span> a function returning the value to be used
 * to complete the returned CompletableFuture
 * <span class="token keyword">@param</span> <span class="token parameter">executor</span> the executor to use for asynchronous execution
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>U<span class="token punctuation">&gt;</span></span> the function&#39;s return type
 * <span class="token keyword">@return</span> the new CompletableFuture
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">,</span>
                                                   <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asyncSupplyStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> supplier<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Returns a new CompletableFuture that is asynchronously completed
 * by a task running in the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">ForkJoinPool</span><span class="token punctuation">#</span><span class="token function">commonPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> after
 * it runs the given action.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">runnable</span> the action to run before completing the
 * returned CompletableFuture
 * <span class="token keyword">@return</span> the new CompletableFuture
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asyncRunStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> runnable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Returns a new CompletableFuture that is asynchronously completed
 * by a task running in the given executor after it runs the given
 * action.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">runnable</span> the action to run before completing the
 * returned CompletableFuture
 * <span class="token keyword">@param</span> <span class="token parameter">executor</span> the executor to use for asynchronous execution
 * <span class="token keyword">@return</span> the new CompletableFuture
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">,</span>
                                               <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">asyncRunStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> runnable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.1.5.png" alt="image-20220731140402932" tabindex="0" loading="lazy"><figcaption>image-20220731140402932</figcaption></figure><h4 id="_2ã€æ–¹æ³•å®Œæˆåçš„æ„ŸçŸ¥" tabindex="-1"><a class="header-anchor" href="#_2ã€æ–¹æ³•å®Œæˆåçš„æ„ŸçŸ¥" aria-hidden="true">#</a> 2ã€æ–¹æ³•å®Œæˆåçš„æ„ŸçŸ¥</h4><h5 id="_1ã€å¸¸ç”¨æ–¹æ³•-1" tabindex="-1"><a class="header-anchor" href="#_1ã€å¸¸ç”¨æ–¹æ³•-1" aria-hidden="true">#</a> 1ã€å¸¸ç”¨æ–¹æ³•</h5><p><code>whenComplete</code>ã€<code>whenCompleteAsync</code>ä¸å¯ä»¥ä¿®æ”¹è¿”å›ç»“æœï¼Œ<code>exceptionally</code>å¯ä»¥ä¿®æ”¹è¿”å›ç»“æœ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//whenComplete  å¯ä»¥å¤„ç†æ­£å¸¸å’Œå¼‚å¸¸çš„è®¡ç®—ç»“æœ (Tä¸ºä¸Šä¸€æ­¥çš„è¿”å›ç»“æœï¼Œ? super Throwableä¸ºä¸Šä¸€æ­¥çš„å¼‚å¸¸ä¿¡æ¯)</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">whenCompleteAsync</span><span class="token punctuation">(</span><span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">whenCompleteAsync</span><span class="token punctuation">(</span><span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//exceptionally  å¤„ç†å¼‚å¸¸æƒ…å†µ(å¯ä»¥ä¿®æ”¹è¿”å›ç»“æœ)ã€‚((Throwableä¸ºä¸Šä¸€æ­¥çš„å¼‚å¸¸ä¿¡æ¯,? extends Tä¸ºè¿™ä¸€æ­¥è¦è¿”å›çš„ç»“æœ)</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">exceptionally</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Throwable</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>whenComplete å’Œ whenCompleteAsync çš„åŒºåˆ«ï¼š</p><ul><li>whenCompleteï¼šæ˜¯æ‰§è¡Œå½“å‰ä»»åŠ¡çš„çº¿ç¨‹æ‰§è¡Œç»§ç»­æ‰§è¡Œ whenComplete çš„ä»»åŠ¡ã€‚</li><li>whenCompleteAsyncï¼šæ˜¯æ‰§è¡ŒæŠŠ whenCompleteAsync è¿™ä¸ªä»»åŠ¡ç»§ç»­æäº¤ç»™çº¿ç¨‹æ± æ¥è¿›è¡Œæ‰§è¡Œã€‚</li><li>æ–¹æ³•ä¸ä»¥ Async ç»“å°¾ï¼Œæ„å‘³ç€ Action ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹æ‰§è¡Œï¼Œè€Œ Async å¯èƒ½ä¼šä½¿ç”¨å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼ˆå¦‚æœæ˜¯ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹æ± ï¼Œä¹Ÿå¯èƒ½ä¼šè¢«åŒä¸€ä¸ªçº¿ç¨‹é€‰ä¸­æ‰§è¡Œï¼‰</li></ul><h5 id="_2ã€whencompleteæ„ŸçŸ¥å¼‚å¸¸-æ²¡æœ‰å¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#_2ã€whencompleteæ„ŸçŸ¥å¼‚å¸¸-æ²¡æœ‰å¼‚å¸¸" aria-hidden="true">#</a> 2ã€<code>whenComplete</code>æ„ŸçŸ¥å¼‚å¸¸(æ²¡æœ‰å¼‚å¸¸)</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span>exception<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼‚æ­¥ä»»åŠ¡å®Œæˆåçš„è¿”å›ç»“æœï¼š&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼‚æ­¥ä»»åŠ¡æŠ›å‡ºçš„å¼‚å¸¸ï¼š&quot;</span> <span class="token operator">+</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
å½“å‰çº¿ç¨‹ï¼š12
è¿è¡Œç»“æœï¼š5
å¼‚æ­¥ä»»åŠ¡å®Œæˆåçš„è¿”å›ç»“æœï¼š5
å¼‚æ­¥ä»»åŠ¡æŠ›å‡ºçš„å¼‚å¸¸ï¼šnull
==========main end============
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°<code>whenComplete</code>å¯ä»¥è·å–åˆ°è¯¥çº¿ç¨‹çš„<code>è¿”å›ç»“æœ</code>å’Œ<code>å¼‚å¸¸ä¿¡æ¯</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.2.2.png" alt="image-20220731145834946" tabindex="0" loading="lazy"><figcaption>image-20220731145834946</figcaption></figure><h5 id="_3ã€whencompleteæ„ŸçŸ¥å¼‚å¸¸-æœ‰å¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#_3ã€whencompleteæ„ŸçŸ¥å¼‚å¸¸-æœ‰å¼‚å¸¸" aria-hidden="true">#</a> 3ã€<code>whenComplete</code>æ„ŸçŸ¥å¼‚å¸¸(æœ‰å¼‚å¸¸)</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span>exception<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼‚æ­¥ä»»åŠ¡å®Œæˆåçš„è¿”å›ç»“æœï¼š&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼‚æ­¥ä»»åŠ¡æŠ›å‡ºçš„å¼‚å¸¸ï¼š&quot;</span> <span class="token operator">+</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
å½“å‰çº¿ç¨‹ï¼š12
å¼‚æ­¥ä»»åŠ¡å®Œæˆåçš„è¿”å›ç»“æœï¼šnull
å¼‚æ­¥ä»»åŠ¡æŠ›å‡ºçš„å¼‚å¸¸ï¼šjava.util.concurrent.CompletionException: java.lang.ArithmeticException: / by zero
==========main end============
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°<code>whenComplete</code>å¯ä»¥è·å–åˆ°è¯¥çº¿ç¨‹çš„<code>è¿”å›ç»“æœ</code>å’Œ<code>å¼‚å¸¸ä¿¡æ¯</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.2.3.png" alt="image-20220731145952658" tabindex="0" loading="lazy"><figcaption>image-20220731145952658</figcaption></figure><h5 id="_4ã€exceptionallyå¤„ç†å¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#_4ã€exceptionallyå¤„ç†å¼‚å¸¸" aria-hidden="true">#</a> 4ã€<code>exceptionally</code>å¤„ç†å¼‚å¸¸</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span>exception<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">//è™½ç„¶èƒ½å¾—åˆ°å¼‚å¸¸ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æ³•ä¿®æ”¹è¿”å›æ•°æ®ã€‚</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼‚æ­¥ä»»åŠ¡å®Œæˆåçš„è¿”å›ç»“æœï¼š&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼‚æ­¥ä»»åŠ¡æŠ›å‡ºçš„å¼‚å¸¸ï¼š&quot;</span> <span class="token operator">+</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionally</span><span class="token punctuation">(</span>throwable <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//å¯ä»¥æ„ŸçŸ¥å¼‚å¸¸ï¼ŒåŒæ—¶è¿”å›é»˜è®¤å€¼</span>
        <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;çº¿ç¨‹è¿”å›çš„ç»“æœï¼š&quot;</span><span class="token operator">+</span>future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
å½“å‰çº¿ç¨‹ï¼š12
å¼‚æ­¥ä»»åŠ¡å®Œæˆåçš„è¿”å›ç»“æœï¼šnull
å¼‚æ­¥ä»»åŠ¡æŠ›å‡ºçš„å¼‚å¸¸ï¼šjava.util.concurrent.CompletionException: java.lang.ArithmeticException: / by zero
çº¿ç¨‹è¿”å›çš„ç»“æœï¼š10
==========main end============
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>exceptionally</code>æ–¹æ³•å¯ä»¥å¯¹è¯¥çº¿ç¨‹çš„å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œä½†æ˜¯å¦‚æœçº¿ç¨‹æ²¡æœ‰å¼‚å¸¸å°±ä¸èƒ½å¯¹æ­£å¸¸è¿”å›ç»“æœè¿›è¡Œå¤„ç†</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.2.4.png" alt="image-20220731150404465" tabindex="0" loading="lazy"><figcaption>image-20220731150404465</figcaption></figure><h5 id="_5ã€æºç -1" tabindex="-1"><a class="header-anchor" href="#_5ã€æºç -1" aria-hidden="true">#</a> 5ã€æºç </h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">whenComplete</span><span class="token punctuation">(</span>
    <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniWhenCompleteStage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">whenCompleteAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniWhenCompleteStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">whenCompleteAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniWhenCompleteStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// not in interface CompletionStage</span>

<span class="token doc-comment comment">/**
 * Returns a new CompletableFuture that is completed when this
 * CompletableFuture completes, with the result of the given
 * function of the exception triggering this CompletableFuture&#39;s
 * completion when it completes exceptionally; otherwise, if this
 * CompletableFuture completes normally, then the returned
 * CompletableFuture also completes normally with the same value.
 * Note: More flexible versions of this functionality are
 * available using methods <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">whenComplete</span></span><span class="token punctuation">}</span> and <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">handle</span></span><span class="token punctuation">}</span>.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">fn</span> the function to use to compute the value of the
 * returned CompletableFuture if this CompletableFuture completed
 * exceptionally
 * <span class="token keyword">@return</span> the new CompletableFuture
 */</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">exceptionally</span><span class="token punctuation">(</span>
    <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Throwable</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniExceptionallyStage</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.2.5.1.png" alt="image-20220731145421477" tabindex="0" loading="lazy"><figcaption>image-20220731145421477</figcaption></figure><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.2.5.2.png" alt="image-20220731145427210" tabindex="0" loading="lazy"><figcaption>image-20220731145427210</figcaption></figure><h4 id="_3ã€æ–¹æ³•å®Œæˆåçš„å¤„ç†-handle" tabindex="-1"><a class="header-anchor" href="#_3ã€æ–¹æ³•å®Œæˆåçš„å¤„ç†-handle" aria-hidden="true">#</a> 3ã€æ–¹æ³•å®Œæˆåçš„å¤„ç†(handle)</h4><h5 id="_1ã€å¸¸ç”¨æ–¹æ³•-2" tabindex="-1"><a class="header-anchor" href="#_1ã€å¸¸ç”¨æ–¹æ³•-2" aria-hidden="true">#</a> 1ã€å¸¸ç”¨æ–¹æ³•</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//(? super Tä¸ºä¸Šä¸€æ­¥çš„è¿”å›ç»“æœ,Throwableä¸ºä¸Šä¸€æ­¥çš„å¼‚å¸¸ä¿¡æ¯,? extends U&gt; fnä¸ºè¿™ä¸€æ­¥çš„è¿”å›ç»“æœ)</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Throwable</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleAsync</span><span class="token punctuation">(</span><span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Throwable</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleAsync</span><span class="token punctuation">(</span><span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Throwable</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2ã€handleå¤„ç†å¼‚å¸¸æˆ–è¿”å›å€¼-æœ‰å¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#_2ã€handleå¤„ç†å¼‚å¸¸æˆ–è¿”å›å€¼-æœ‰å¼‚å¸¸" aria-hidden="true">#</a> 2ã€<code>handle</code>å¤„ç†<code>å¼‚å¸¸</code>æˆ–<code>è¿”å›å€¼</code>(æœ‰å¼‚å¸¸)</h5><p>å¯ä»¥ä¿®æ”¹è¿”å›ç»“æœ</p><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span>throwable<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> result<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>throwable<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;çº¿ç¨‹è¿”å›çš„ç»“æœï¼š&quot;</span><span class="token operator">+</span>future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
å½“å‰çº¿ç¨‹ï¼š12
çº¿ç¨‹è¿”å›çš„ç»“æœï¼š0
==========main end============
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>handle</code>å¯ä»¥å¯¹è¯¥çº¿ç¨‹çš„<code>æ­£å¸¸è¿”å›ç»“æœ</code>å’Œ<code>å¼‚å¸¸è¿”å›ç»“æœ</code>è¿›è¡Œå¤„ç†</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.3.2.png" alt="image-20220731151320171" tabindex="0" loading="lazy"><figcaption>image-20220731151320171</figcaption></figure><h5 id="_3ã€handleå¤„ç†å¼‚å¸¸æˆ–è¿”å›å€¼-æ²¡æœ‰å¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#_3ã€handleå¤„ç†å¼‚å¸¸æˆ–è¿”å›å€¼-æ²¡æœ‰å¼‚å¸¸" aria-hidden="true">#</a> 3ã€<code>handle</code>å¤„ç†<code>å¼‚å¸¸</code>æˆ–<code>è¿”å›å€¼</code>(æ²¡æœ‰å¼‚å¸¸)</h5><p>å¦‚æœæŠŠ<code>int i = 10 / 0;</code>æ”¹ä¸º</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>int i = 10 / 2;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
å½“å‰çº¿ç¨‹ï¼š12
è¿è¡Œç»“æœï¼š5
çº¿ç¨‹è¿”å›çš„ç»“æœï¼š10
==========main end============
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>handle</code>å¯ä»¥å¯¹è¯¥çº¿ç¨‹çš„<code>æ­£å¸¸è¿”å›ç»“æœ</code>å’Œ<code>å¼‚å¸¸è¿”å›ç»“æœ</code>è¿›è¡Œå¤„ç†</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.3.3.png" alt="image-20220731151354996" tabindex="0" loading="lazy"><figcaption>image-20220731151354996</figcaption></figure><h5 id="_4ã€æºç " tabindex="-1"><a class="header-anchor" href="#_4ã€æºç " aria-hidden="true">#</a> 4ã€æºç </h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">handle</span><span class="token punctuation">(</span>
    <span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Throwable</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniHandleStage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Throwable</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniHandleStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Throwable</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniHandleStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.3.4.png" alt="image-20220731162118455" tabindex="0" loading="lazy"><figcaption>image-20220731162118455</figcaption></figure><h4 id="_4ã€çº¿ç¨‹ä¸²è¡ŒåŒ–æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_4ã€çº¿ç¨‹ä¸²è¡ŒåŒ–æ–¹æ³•" aria-hidden="true">#</a> 4ã€çº¿ç¨‹ä¸²è¡ŒåŒ–æ–¹æ³•</h4><h5 id="_1ã€å¸¸ç”¨æ–¹æ³•-3" tabindex="-1"><a class="header-anchor" href="#_1ã€å¸¸ç”¨æ–¹æ³•-3" aria-hidden="true">#</a> 1ã€å¸¸ç”¨æ–¹æ³•</h5><p>thenRunä¸èƒ½æ„ŸçŸ¥ä¸Šä¸€æ­¥ç»“æœï¼ŒthenAcceptèƒ½æ„ŸçŸ¥ä¸Šä¸€æ­¥å¤„ç†ç»“æœ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//Aå¤„ç†å®ŒåBå¤„ç†ï¼ŒBä¸éœ€è¦Açš„è¿”å›ç»“æœ</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenRun</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> action<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Aå¤„ç†å®ŒåBå¤„ç†ï¼ŒBéœ€è¦Açš„è¿”å›ç»“æœ</span>
<span class="token comment">//(Consumer&lt;? super T&gt; actionä¸ºä¸Šä¸€æ­¥çš„è¿”å›ç»“æœ)</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAccept</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Aå¤„ç†å®ŒåBå¤„ç†ï¼ŒBéœ€è¦Açš„è¿”å›ç»“æœã€Bå¤„ç†å®Œåè¿˜éœ€è¦è¿”å›æœ¬æ¬¡å¤„ç†åçš„ç»“æœï¼Œåˆ«äººæ„ŸçŸ¥</span>
<span class="token comment">//(Function&lt;? super Tä¸ºä¸Šä¸€æ­¥çš„è¿”å›ç»“æœ,? extends U&gt; fnä¸ºè¿™ä¸€æ­¥çš„è¿”å›ç»“æœ)</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenApplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>thenRun æ–¹æ³•ï¼šåªè¦ä¸Šé¢çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå°±å¼€å§‹æ‰§è¡Œ thenRunï¼Œåªæ˜¯å¤„ç†å®Œä»»åŠ¡åï¼Œæ‰§è¡Œ thenRun çš„åç»­æ“ä½œ</li><li>thenAccept æ–¹æ³•ï¼šæ¶ˆè´¹å¤„ç†ç»“æœã€‚æ¥æ”¶ä»»åŠ¡çš„å¤„ç†ç»“æœï¼Œå¹¶æ¶ˆè´¹å¤„ç†ï¼Œæ— è¿”å›ç»“æœã€‚</li><li>thenApply æ–¹æ³•ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¾èµ–å¦ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œè·å–ä¸Šä¸€ä¸ªä»»åŠ¡è¿”å›çš„ç»“æœï¼Œå¹¶è¿”å›å½“å‰ä»»åŠ¡çš„è¿”å›å€¼ã€‚</li><li>æ–¹æ³•ä¸ä»¥ Async ç»“å°¾ï¼Œæ„å‘³ç€ Action ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹æ‰§è¡Œï¼Œè€Œ Async å¯èƒ½ä¼šä½¿ç”¨å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼ˆå¦‚æœæ˜¯ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹æ± ï¼Œä¹Ÿå¯èƒ½ä¼šè¢«åŒä¸€ä¸ªçº¿ç¨‹é€‰ä¸­æ‰§è¡Œï¼‰</li></ul><h5 id="_2ã€thenrunasyncbä¸éœ€è¦açš„è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#_2ã€thenrunasyncbä¸éœ€è¦açš„è¿”å›å€¼" aria-hidden="true">#</a> 2ã€<code>thenRunAsync</code>Bä¸éœ€è¦Açš„è¿”å›å€¼</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenRun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2å¯åŠ¨äº†...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
å½“å‰çº¿ç¨‹ï¼š12
==========main end============
è¿è¡Œç»“æœï¼š5
ä»»åŠ¡2å¯åŠ¨äº†...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>thenRunAsync</code>æ–¹æ³•æ˜¯<code>ä»»åŠ¡1</code>æ‰§è¡Œå®Œå<code>ä»»åŠ¡2</code>å†æ‰§è¡Œï¼Œ<code>ä»»åŠ¡2</code>ä¸èƒ½è·å–åˆ°<code>ä»»åŠ¡1</code>çš„è¿”å›å€¼</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.4.2.png" alt="image-20220731153402668" tabindex="0" loading="lazy"><figcaption>image-20220731153402668</figcaption></figure><h5 id="_3ã€thenacceptasyncbéœ€è¦açš„è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#_3ã€thenacceptasyncbéœ€è¦açš„è¿”å›å€¼" aria-hidden="true">#</a> 3ã€<code>thenAcceptAsync</code>Béœ€è¦Açš„è¿”å›å€¼</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAccept</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2å¯åŠ¨äº†...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–åˆ°äº†ä¸Šä¸€æ­¥çš„è¿”å›ç»“æœï¼š&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
å½“å‰çº¿ç¨‹ï¼š12
==========main end============
è¿è¡Œç»“æœï¼š5
ä»»åŠ¡2å¯åŠ¨äº†...
è·å–åˆ°äº†ä¸Šä¸€æ­¥çš„è¿”å›ç»“æœï¼š5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>thenAcceptAsync</code>æ–¹æ³•æ˜¯<code>ä»»åŠ¡1</code>æ‰§è¡Œå®Œå<code>ä»»åŠ¡2</code>å†æ‰§è¡Œï¼Œ<code>ä»»åŠ¡2</code>å¯ä»¥è·å–åˆ°<code>ä»»åŠ¡1</code>çš„è¿”å›å€¼</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.4.3.png" alt="image-20220731154341218" tabindex="0" loading="lazy"><figcaption>image-20220731154341218</figcaption></figure><h5 id="_4ã€thenapplyasyncaã€béƒ½è¿”å›ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_4ã€thenapplyasyncaã€béƒ½è¿”å›ç»“æœ" aria-hidden="true">#</a> 4ã€<code>thenApplyAsync</code>Aã€Béƒ½è¿”å›ç»“æœ</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2å¯åŠ¨äº†...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2è·å–åˆ°äº†ä»»åŠ¡1çš„è¿”å›ç»“æœï¼š&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡éƒ½å®Œæˆåè¿”å›ç»“æœï¼š&quot;</span> <span class="token operator">+</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
å½“å‰çº¿ç¨‹ï¼š12
ä»»åŠ¡1è¿è¡Œç»“æœï¼š5
ä»»åŠ¡2å¯åŠ¨äº†...
ä»»åŠ¡2è·å–åˆ°äº†ä»»åŠ¡1çš„è¿”å›ç»“æœï¼š5
ä»»åŠ¡éƒ½å®Œæˆåè¿”å›ç»“æœï¼šHello 5
==========main end============
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>thenApplyAsync</code>æ–¹æ³•æ˜¯<code>ä»»åŠ¡1</code>æ‰§è¡Œå®Œå<code>ä»»åŠ¡2</code>å†æ‰§è¡Œï¼Œ<code>ä»»åŠ¡2</code>å¯ä»¥è·å–åˆ°<code>ä»»åŠ¡1</code>çš„è¿”å›å€¼ï¼Œä¸”<code>ä»»åŠ¡2</code>ä¹Ÿéœ€è¿”å›ç»“æœ</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.4.4.png" alt="image-20220731154900573" tabindex="0" loading="lazy"><figcaption>image-20220731154900573</figcaption></figure><h5 id="_5ã€æºç -2" tabindex="-1"><a class="header-anchor" href="#_5ã€æºç -2" aria-hidden="true">#</a> 5ã€æºç </h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenApply</span><span class="token punctuation">(</span>
    <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniApplyStage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenApplyAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniApplyStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenApplyAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniApplyStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAccept</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniAcceptStage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniAcceptStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">,</span>
                                               <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniAcceptStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenRun</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniRunStage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniRunStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> action<span class="token punctuation">,</span>
                                            <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">uniRunStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.4.5.png" alt="image-20220731152222563" tabindex="0" loading="lazy"><figcaption>image-20220731152222563</figcaption></figure><h4 id="_5ã€ä¸¤ä»»åŠ¡ç»„åˆ-éƒ½è¦å®Œæˆ" tabindex="-1"><a class="header-anchor" href="#_5ã€ä¸¤ä»»åŠ¡ç»„åˆ-éƒ½è¦å®Œæˆ" aria-hidden="true">#</a> 5ã€<strong>ä¸¤ä»»åŠ¡ç»„åˆ</strong> - éƒ½è¦å®Œæˆ</h4><h5 id="_1ã€å¸¸ç”¨æ–¹æ³•-4" tabindex="-1"><a class="header-anchor" href="#_1ã€å¸¸ç”¨æ–¹æ³•-4" aria-hidden="true">#</a> 1ã€å¸¸ç”¨æ–¹æ³•</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//CompletableFuture&lt;T&gt; implements Future&lt;T&gt;, CompletionStage&lt;T&gt;</span>
<span class="token comment">//ä»»åŠ¡1å’Œä»»åŠ¡2(CompletionStage&lt;?&gt; other)éƒ½åšå®Œåï¼Œå†åšRunnable actionæŒ‡å®šçš„äº‹æƒ…</span>
<span class="token comment">//ä¸èƒ½è·å–ä»»åŠ¡1å’Œä»»åŠ¡2(CompletionStage&lt;?&gt; other)çš„è¿”å›ç»“æœï¼Œä¸”è¿™æ¬¡æ‰§è¡Œä¸ç”¨è¿”å›ç»“æœ</span>
<span class="token comment">//CompletionStage&lt;?&gt; other:è¦å®Œæˆçš„å¦ä¸€ä¸ªä»»åŠ¡(ä»»åŠ¡2)ï¼ŒRunnable action:æ¥ä¸‹æ¥è¦å®Œæˆçš„ä»»åŠ¡</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterBoth</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterBothAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterBothAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Runnable</span> action<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span>

<span class="token comment">//å¯ä»¥è·å–ä»»åŠ¡1å’Œä»»åŠ¡2(CompletionStage&lt;?&gt; other)çš„è¿”å›ç»“æœï¼Œè¿™æ¬¡æ‰§è¡Œä¸ç”¨è¿”å›ç»“æœ</span>
<span class="token comment">//CompletionStage&lt;? extends U&gt; other:è¦å®Œæˆçš„å¦ä¸€ä¸ªä»»åŠ¡(ä»»åŠ¡2),BiConsumer&lt;? super T, ? super U&gt; action:ä»»åŠ¡1å’Œä»»åŠ¡2çš„è¿”å›å€¼</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptBoth</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptBothAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptBothAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span>

<span class="token comment">//å¯ä»¥è·å–ä»»åŠ¡1å’Œä»»åŠ¡2(CompletionStage&lt;?&gt; other)çš„è¿”å›ç»“æœï¼Œå¹¶è¿”å›æœ¬æ¬¡çš„æ‰§è¡Œç»“æœ</span>
<span class="token comment">//CompletionStage&lt;?&gt; other:è¦å®Œæˆçš„å¦ä¸€ä¸ªä»»åŠ¡(ä»»åŠ¡2)</span>
<span class="token comment">//? super T:æ¥ä¸‹æ¥è¦å®Œæˆçš„ä»»åŠ¡çš„è¿”å›å€¼ï¼Œ? super U:ä»»åŠ¡1çš„è¿”å›å€¼,? extends V:ä»»åŠ¡2çš„è¿”å›å€¼</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenCombine</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenCombineAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenCombineAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>runAfterBothï¼šç»„åˆä¸¤ä¸ª futureï¼Œä¸éœ€è¦è·å– future çš„ç»“æœï¼Œåªéœ€ä¸¤ä¸ª future å¤„ç†å®Œä»»åŠ¡åï¼Œå¤„ç†è¯¥ä»»åŠ¡ã€‚</li><li>thenAcceptBothï¼šç»„åˆä¸¤ä¸ª futureï¼Œè·å–ä¸¤ä¸ª future ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œç„¶åå¤„ç†ä»»åŠ¡ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚</li><li>thenCombineï¼šç»„åˆä¸¤ä¸ª futureï¼Œè·å–ä¸¤ä¸ª future çš„è¿”å›ç»“æœï¼Œå¹¶è¿”å›å½“å‰ä»»åŠ¡çš„è¿”å›å€¼</li><li>æ–¹æ³•ä¸ä»¥ Async ç»“å°¾ï¼Œæ„å‘³ç€ Action ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹æ‰§è¡Œï¼Œè€Œ Async å¯èƒ½ä¼šä½¿ç”¨å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼ˆå¦‚æœæ˜¯ä½¿ç”¨ç›¸åŒçš„çº¿ç¨‹æ± ï¼Œä¹Ÿå¯èƒ½ä¼šè¢«åŒä¸€ä¸ªçº¿ç¨‹é€‰ä¸­æ‰§è¡Œï¼‰</li></ul><h5 id="_2ã€runafterbothasync" tabindex="-1"><a class="header-anchor" href="#_2ã€runafterbothasync" aria-hidden="true">#</a> 2ã€<code>runAfterBothAsync</code></h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future1 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future2 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello2&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    future1<span class="token punctuation">.</span><span class="token function">runAfterBothAsync</span><span class="token punctuation">(</span>future2<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello3&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
ä»»åŠ¡1çº¿ç¨‹ï¼š12
ä»»åŠ¡2çº¿ç¨‹ï¼š13
==========main end============
ä»»åŠ¡1è¿è¡Œç»“æœï¼š5
ä»»åŠ¡2è¿è¡Œç»“æœï¼šhello2
ä»»åŠ¡3çº¿ç¨‹ï¼š15
ä»»åŠ¡3è¿è¡Œç»“æœï¼šhello3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>runAfterBothAsync</code>æ˜¯<code>ä»»åŠ¡1</code>å’Œ<code>ä»»åŠ¡2</code>éƒ½æ‰§è¡Œå®Œæˆåï¼Œ<code>ä»»åŠ¡3</code>æ‰èƒ½å¼€å§‹æ‰§è¡Œï¼Œä¸”<code>ä»»åŠ¡3</code>ä¸éœ€è¦<code>ä»»åŠ¡1</code>ã€<code>ä»»åŠ¡2</code>çš„è¿”å›å€¼</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.5.2.png" alt="image-20220731165058934" tabindex="0" loading="lazy"><figcaption>image-20220731165058934</figcaption></figure><h5 id="_3ã€thenacceptbothasync" tabindex="-1"><a class="header-anchor" href="#_3ã€thenacceptbothasync" aria-hidden="true">#</a> 3ã€<code>thenAcceptBothAsync</code></h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future1 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future2 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello2&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    future1<span class="token punctuation">.</span><span class="token function">thenAcceptBothAsync</span><span class="token punctuation">(</span>future2<span class="token punctuation">,</span><span class="token punctuation">(</span>f1<span class="token punctuation">,</span>f2<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello3&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è·å–åˆ°çš„ä»»åŠ¡1ç»“æœï¼š&quot;</span> <span class="token operator">+</span> f1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è·å–åˆ°çš„ä»»åŠ¡2ç»“æœï¼š&quot;</span> <span class="token operator">+</span> f2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
ä»»åŠ¡1çº¿ç¨‹ï¼š12
ä»»åŠ¡2çº¿ç¨‹ï¼š13
==========main end============
ä»»åŠ¡1è¿è¡Œç»“æœï¼š5
ä»»åŠ¡2è¿è¡Œç»“æœï¼šhello2
ä»»åŠ¡3çº¿ç¨‹ï¼š15
ä»»åŠ¡3è·å–åˆ°çš„ä»»åŠ¡1ç»“æœï¼š5
ä»»åŠ¡3è·å–åˆ°çš„ä»»åŠ¡2ç»“æœï¼šhello2
ä»»åŠ¡3è¿è¡Œç»“æœï¼šhello3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>thenAcceptBothAsync</code>æ˜¯<code>ä»»åŠ¡1</code>å’Œ<code>ä»»åŠ¡2</code>éƒ½æ‰§è¡Œå®Œæˆåï¼Œ<code>ä»»åŠ¡3</code>æ‰èƒ½å¼€å§‹æ‰§è¡Œï¼Œä¸”<code>ä»»åŠ¡3</code>å¯ä»¥è·å–åˆ°<code>ä»»åŠ¡1</code>ã€<code>ä»»åŠ¡2</code>çš„è¿”å›å€¼</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.5.3.png" alt="image-20220731165718791" tabindex="0" loading="lazy"><figcaption>image-20220731165718791</figcaption></figure><h5 id="_4ã€thencombineasync" tabindex="-1"><a class="header-anchor" href="#_4ã€thencombineasync" aria-hidden="true">#</a> 4ã€<code>thenCombineAsync</code></h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future1 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future2 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello2&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future3 <span class="token operator">=</span> future1<span class="token punctuation">.</span><span class="token function">thenCombineAsync</span><span class="token punctuation">(</span>future2<span class="token punctuation">,</span> <span class="token punctuation">(</span>f1<span class="token punctuation">,</span> f2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello3&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è·å–åˆ°çš„ä»»åŠ¡1ç»“æœï¼š&quot;</span> <span class="token operator">+</span> f1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è·å–åˆ°çš„ä»»åŠ¡2ç»“æœï¼š&quot;</span> <span class="token operator">+</span> f2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> f1 <span class="token operator">+</span> <span class="token string">&quot; =&gt; &quot;</span> <span class="token operator">+</span> f2 <span class="token operator">+</span> <span class="token string">&quot; =&gt; &quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸‰ä¸ªä»»åŠ¡æ‰§è¡Œå®Œçš„è¿”å›ç»“æœï¼š&quot;</span> <span class="token operator">+</span> future3<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
ä»»åŠ¡1çº¿ç¨‹ï¼š12
ä»»åŠ¡2çº¿ç¨‹ï¼š13
ä»»åŠ¡2è¿è¡Œç»“æœï¼šhello2
ä»»åŠ¡1è¿è¡Œç»“æœï¼š5
ä»»åŠ¡3çº¿ç¨‹ï¼š14
ä»»åŠ¡3è·å–åˆ°çš„ä»»åŠ¡1ç»“æœï¼š5
ä»»åŠ¡3è·å–åˆ°çš„ä»»åŠ¡2ç»“æœï¼šhello2
ä»»åŠ¡3è¿è¡Œç»“æœï¼šhello3
ä¸‰ä¸ªä»»åŠ¡æ‰§è¡Œå®Œçš„è¿”å›ç»“æœï¼š5 =&gt; hello2 =&gt; hello3
==========main end============
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>thenCombineAsync</code>æ˜¯<code>ä»»åŠ¡1</code>å’Œ<code>ä»»åŠ¡2</code>éƒ½æ‰§è¡Œå®Œæˆåï¼Œ<code>ä»»åŠ¡3</code>æ‰èƒ½å¼€å§‹æ‰§è¡Œï¼Œ<code>ä»»åŠ¡3</code>å¯ä»¥è·å–çš„<code>ä»»åŠ¡1</code>ã€<code>ä»»åŠ¡2</code>çš„è¿”å›å€¼ï¼Œä¸”<code>ä»»åŠ¡3</code>éœ€è¦æœ‰è¿”å›å€¼</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.5.4.png" alt="image-20220731170401151" tabindex="0" loading="lazy"><figcaption>image-20220731170401151</figcaption></figure><h5 id="_5ã€æºç -3" tabindex="-1"><a class="header-anchor" href="#_5ã€æºç -3" aria-hidden="true">#</a> 5ã€æºç </h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterBoth</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span>
                                            <span class="token class-name">Runnable</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">biRunStage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> other<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterBothAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span>
                                                 <span class="token class-name">Runnable</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">biRunStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> other<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterBothAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span>
                                                 <span class="token class-name">Runnable</span> action<span class="token punctuation">,</span>
                                                 <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">biRunStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> other<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptBoth</span><span class="token punctuation">(</span>
    <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span>
    <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">biAcceptStage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> other<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptBothAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span>
    <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">biAcceptStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> other<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenAcceptBothAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span>
    <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">biAcceptStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> other<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenCombine</span><span class="token punctuation">(</span>
    <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span>
    <span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">biApplyStage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> other<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenCombineAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span>
    <span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">biApplyStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> other<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token function">thenCombineAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span>
    <span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">U</span><span class="token punctuation">,</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span> <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">biApplyStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> other<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong><code>runAfterBothAsync</code></strong></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.5.5.1.png" alt="image-20220731163529661" tabindex="0" loading="lazy"><figcaption>image-20220731163529661</figcaption></figure><p><strong><code>thenAcceptBothAsync</code></strong></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.5.5.2.png" alt="image-20220731163512341" tabindex="0" loading="lazy"><figcaption>image-20220731163512341</figcaption></figure><p><strong><code>thenCombineAsync</code></strong></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.5.5.3.png" alt="image-20220731163441464" tabindex="0" loading="lazy"><figcaption>image-20220731163441464</figcaption></figure><h4 id="_6ã€ä¸¤ä»»åŠ¡ç»„åˆ-ä¸€ä¸ªå®Œæˆ" tabindex="-1"><a class="header-anchor" href="#_6ã€ä¸¤ä»»åŠ¡ç»„åˆ-ä¸€ä¸ªå®Œæˆ" aria-hidden="true">#</a> 6ã€<strong>ä¸¤ä»»åŠ¡ç»„åˆ</strong> - ä¸€ä¸ªå®Œæˆ</h4><h5 id="_1ã€å¸¸ç”¨æ–¹æ³•-5" tabindex="-1"><a class="header-anchor" href="#_1ã€å¸¸ç”¨æ–¹æ³•-5" aria-hidden="true">#</a> 1ã€å¸¸ç”¨æ–¹æ³•</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä»»åŠ¡1å’Œä»»åŠ¡2(CompletionStage&lt;?&gt; other)å…¶ä¸­ä¸€ä¸ªåšå®Œåï¼Œå†åšRunnable actionæŒ‡å®šçš„äº‹æƒ…</span>
<span class="token comment">//ä¸èƒ½è·å–ä»»åŠ¡1å’Œä»»åŠ¡2(CompletionStage&lt;?&gt; other)çš„è¿”å›ç»“æœï¼Œä¸”è¿™æ¬¡æ‰§è¡Œä¸ç”¨è¿”å›</span>
<span class="token comment">//CompletionStage&lt;?&gt; other:è¦å®Œæˆçš„å¦ä¸€ä¸ªä»»åŠ¡(ä»»åŠ¡2)ï¼ŒRunnable action:æ¥ä¸‹æ¥è¦å®Œæˆçš„ä»»åŠ¡</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterEither</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Runnable</span> action<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span><span class="token class-name">Runnable</span> action<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span>

<span class="token comment">//å¯ä»¥è·å–ä»»åŠ¡1æˆ–ä»»åŠ¡2(CompletionStage&lt;?&gt; other)çš„è¿”å›ç»“æœï¼Œè¿™æ¬¡æ‰§è¡Œä¸ç”¨è¿”å›ç»“æœ</span>
<span class="token comment">//CompletionStage&lt;? extends U&gt; other:è¦å®Œæˆçš„å¦ä¸€ä¸ªä»»åŠ¡(ä»»åŠ¡2),Consumer&lt;? super T&gt; action:å…ˆæ‰§è¡Œå®Œçš„é‚£ä¸ªä»»åŠ¡çš„è¿”å›å€¼</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">acceptEither</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">acceptEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">acceptEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span>

<span class="token comment">//å¯ä»¥è·å–ä»»åŠ¡1æˆ–ä»»åŠ¡2(CompletionStage&lt;?&gt; other)çš„è¿”å›ç»“æœï¼Œè¿™æ¬¡æ‰§è¡Œéœ€è¦è¿”å›ç»“æœ</span>
<span class="token comment">//CompletionStage&lt;? extends T&gt; other:è¦å®Œæˆçš„å¦ä¸€ä¸ªä»»åŠ¡(ä»»åŠ¡2)</span>
<span class="token comment">//Function&lt;? super T, U&gt; fn:å…ˆæ‰§è¡Œå®Œçš„é‚£ä¸ªä»»åŠ¡çš„è¿”å›å€¼ å’Œ æ¥ä¸‹æ¥è¦å®Œæˆçš„ä»»åŠ¡çš„è¿”å›å€¼</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">applyToEither</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">applyToEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">applyToEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2ã€runaftereitherasync" tabindex="-1"><a class="header-anchor" href="#_2ã€runaftereitherasync" aria-hidden="true">#</a> 2ã€<code>runAfterEitherAsync</code></h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> future1 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future2 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello2&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    future1<span class="token punctuation">.</span><span class="token function">runAfterEitherAsync</span><span class="token punctuation">(</span>future2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello3&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
ä»»åŠ¡1çº¿ç¨‹ï¼š12
ä»»åŠ¡2çº¿ç¨‹ï¼š13
==========main end============
ä»»åŠ¡1è¿è¡Œç»“æœï¼š5
ä»»åŠ¡3çº¿ç¨‹ï¼š15
ä»»åŠ¡3è¿è¡Œç»“æœï¼šhello3
ä»»åŠ¡2è¿è¡Œç»“æœï¼šhello2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>runAfterEitherAsync</code>æ˜¯<code>ä»»åŠ¡1</code>æˆ–<code>ä»»åŠ¡2</code>å…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå®Œæˆåï¼Œ<code>ä»»åŠ¡3</code>æ‰èƒ½å¼€å§‹æ‰§è¡Œï¼Œ<code>ä»»åŠ¡3</code>ä¸å¯ä»¥è·å–<code>ä»»åŠ¡1</code>æˆ–<code>ä»»åŠ¡2</code>çš„è¿”å›å€¼</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.6.2.png" alt="image-20220731185139964" tabindex="0" loading="lazy"><figcaption>image-20220731185139964</figcaption></figure><h5 id="_3ã€accepteitherasync" tabindex="-1"><a class="header-anchor" href="#_3ã€accepteitherasync" aria-hidden="true">#</a> 3ã€<code>acceptEitherAsync</code></h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future1 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future2 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello2&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    future1<span class="token punctuation">.</span><span class="token function">acceptEitherAsync</span><span class="token punctuation">(</span>future2<span class="token punctuation">,</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è·å–åˆ°çš„å‰ä¸¤ä¸ªä»»åŠ¡å…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå®Œçš„è¿”å›å€¼&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello3&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
ä»»åŠ¡1çº¿ç¨‹ï¼š12
ä»»åŠ¡2çº¿ç¨‹ï¼š13
==========main end============
ä»»åŠ¡1è¿è¡Œç»“æœï¼š5
ä»»åŠ¡3çº¿ç¨‹ï¼š15
ä»»åŠ¡3è·å–åˆ°çš„å‰ä¸¤ä¸ªä»»åŠ¡å…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå®Œçš„è¿”å›å€¼5
ä»»åŠ¡3è¿è¡Œç»“æœï¼šhello3
ä»»åŠ¡2è¿è¡Œç»“æœï¼šhello2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>acceptEitherAsync</code>æ˜¯<code>ä»»åŠ¡1</code>æˆ–<code>ä»»åŠ¡2</code>å…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå®Œæˆåï¼Œ<code>ä»»åŠ¡3</code>æ‰èƒ½å¼€å§‹æ‰§è¡Œï¼Œ<code>ä»»åŠ¡3</code>å¯ä»¥è·å–å·²æˆåŠŸæ‰§è¡Œçš„é‚£ä¸ªçº¿ç¨‹çš„è¿”å›å€¼</p><p><code>ä»»åŠ¡1</code>å’Œ<code>ä»»åŠ¡2</code>ä»»åŠ¡è¦æ±‚è¿”å›å€¼å¿…é¡»æ˜¯ä¸€è‡´çš„ï¼Œå› ä¸ºéœ€è¦è·å–å·²æˆåŠŸæ‰§è¡Œçš„é‚£ä¸ªçº¿ç¨‹çš„è¿”å›å€¼ï¼Œæ‰€ä»¥ä¸¤ä¸ªä»»åŠ¡éƒ½å¿…é¡»è¦æœ‰ç›¸åŒç±»å‹çš„è¿”å›å€¼</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.6.3.1.png" alt="image-20220731185547647" tabindex="0" loading="lazy"><figcaption>image-20220731185547647</figcaption></figure><p>æŠŠ<code>ä»»åŠ¡1</code>å’Œ<code>ä»»åŠ¡2</code>çš„è¿”å›å€¼ç±»å‹éƒ½ä¿®æ”¹ä¸º<code>Object</code>ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»ä¸æŠ¥é”™äº†</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.6.3.2.png" alt="image-20220731185639506" tabindex="0" loading="lazy"><figcaption>image-20220731185639506</figcaption></figure><p>æ‰§è¡ŒæˆåŠŸåæˆåŠŸè·å–åˆ°<code>ä»»åŠ¡1</code>çš„è¿”å›å€¼</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.6.3.3.png" alt="image-20220731190107420" tabindex="0" loading="lazy"><figcaption>image-20220731190107420</figcaption></figure><h5 id="_4ã€applytoeitherasync" tabindex="-1"><a class="header-anchor" href="#_4ã€applytoeitherasync" aria-hidden="true">#</a> 4ã€<code>applyToEitherAsync</code></h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future1 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future2 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello2&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> future1<span class="token punctuation">.</span><span class="token function">applyToEitherAsync</span><span class="token punctuation">(</span>future2<span class="token punctuation">,</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è·å–åˆ°çš„å‰ä¸¤ä¸ªä»»åŠ¡å…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå®Œçš„è¿”å›å€¼&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello3&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result <span class="token operator">+</span> <span class="token string">&quot; =&gt; &quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3æ‰§è¡Œå®Œåçš„è¿”å›ç»“æœ:&quot;</span> <span class="token operator">+</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
ä»»åŠ¡1çº¿ç¨‹ï¼š12
ä»»åŠ¡2çº¿ç¨‹ï¼š13
ä»»åŠ¡1è¿è¡Œç»“æœï¼š5
ä»»åŠ¡3çº¿ç¨‹ï¼š14
ä»»åŠ¡3è·å–åˆ°çš„å‰ä¸¤ä¸ªä»»åŠ¡å…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå®Œçš„è¿”å›å€¼5
ä»»åŠ¡3è¿è¡Œç»“æœï¼šhello3
ä»»åŠ¡3æ‰§è¡Œå®Œåçš„è¿”å›ç»“æœ:5 =&gt; hello3
==========main end============
ä»»åŠ¡2è¿è¡Œç»“æœï¼šhello2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>applyToEitherAsync</code>æ˜¯<code>ä»»åŠ¡1</code>æˆ–<code>ä»»åŠ¡2</code>å…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå®Œæˆåï¼Œ<code>ä»»åŠ¡3</code>æ‰èƒ½å¼€å§‹æ‰§è¡Œï¼Œ<code>ä»»åŠ¡3</code>å¯ä»¥è·å–å·²æˆåŠŸæ‰§è¡Œçš„é‚£ä¸ªçº¿ç¨‹çš„è¿”å›å€¼ï¼Œä¸”<code>ä»»åŠ¡3</code>éœ€è¦æœ‰è¿”å›å€¼</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.6.4.png" alt="image-20220731190543612" tabindex="0" loading="lazy"><figcaption>image-20220731190543612</figcaption></figure><h5 id="_5ã€æºç -4" tabindex="-1"><a class="header-anchor" href="#_5ã€æºç -4" aria-hidden="true">#</a> 5ã€æºç </h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterEither</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span>
                                              <span class="token class-name">Runnable</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">orRunStage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> other<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span>
                                                   <span class="token class-name">Runnable</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">orRunStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> other<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAfterEitherAsync</span><span class="token punctuation">(</span><span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span>
                                                   <span class="token class-name">Runnable</span> action<span class="token punctuation">,</span>
                                                   <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">orRunStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> other<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">acceptEither</span><span class="token punctuation">(</span>
    <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">orAcceptStage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> other<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">acceptEitherAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">orAcceptStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> other<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">acceptEitherAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">,</span>
    <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">orAcceptStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> other<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">applyToEither</span><span class="token punctuation">(</span>
    <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">orApplyStage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> other<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">applyToEitherAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">orApplyStage</span><span class="token punctuation">(</span>asyncPool<span class="token punctuation">,</span> other<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">applyToEitherAsync</span><span class="token punctuation">(</span>
    <span class="token class-name">CompletionStage</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> fn<span class="token punctuation">,</span>
    <span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">orApplyStage</span><span class="token punctuation">(</span><span class="token function">screenExecutor</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">,</span> other<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä¸¤ä¸ªä»»åŠ¡ä¸­ï¼Œä»»æ„ä¸€ä¸ª future ä»»åŠ¡å®Œæˆçš„æ—¶å€™ï¼Œæ‰§è¡Œä»»åŠ¡ã€‚</p><p>applyToEitherï¼šä¸¤ä¸ªä»»åŠ¡æœ‰ä¸€ä¸ªæ‰§è¡Œå®Œæˆï¼Œè·å–å®ƒçš„è¿”å›å€¼ï¼Œå¤„ç†ä»»åŠ¡å¹¶æœ‰æ–°çš„è¿”å›å€¼ã€‚ acceptEitherï¼šä¸¤ä¸ªä»»åŠ¡æœ‰ä¸€ä¸ªæ‰§è¡Œå®Œæˆï¼Œè·å–å®ƒçš„è¿”å›å€¼ï¼Œå¤„ç†ä»»åŠ¡ï¼Œæ²¡æœ‰æ–°çš„è¿”å›å€¼ã€‚ runAfterEitherï¼šä¸¤ä¸ªä»»åŠ¡æœ‰ä¸€ä¸ªæ‰§è¡Œå®Œæˆï¼Œä¸éœ€è¦è·å– future çš„ç»“æœï¼Œå¤„ç†ä»»åŠ¡ï¼Œä¹Ÿæ²¡æœ‰è¿”å›å€¼ã€‚</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.6.5.1.png" alt="image-20220731170716550" tabindex="0" loading="lazy"><figcaption>image-20220731170716550</figcaption></figure><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.6.5.2.png" alt="image-20220731170825404" tabindex="0" loading="lazy"><figcaption>image-20220731170825404</figcaption></figure><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.6.5.3.png" alt="image-20220731170916342" tabindex="0" loading="lazy"><figcaption>image-20220731170916342</figcaption></figure><h4 id="_7ã€å¤šä»»åŠ¡ç»„åˆ" tabindex="-1"><a class="header-anchor" href="#_7ã€å¤šä»»åŠ¡ç»„åˆ" aria-hidden="true">#</a> 7ã€å¤šä»»åŠ¡ç»„åˆ</h4><h5 id="_1ã€å¸¸ç”¨æ–¹æ³•-6" tabindex="-1"><a class="header-anchor" href="#_1ã€å¸¸ç”¨æ–¹æ³•-6" aria-hidden="true">#</a> 1ã€å¸¸ç”¨æ–¹æ³•</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//æ‰€æœ‰çš„éƒ½å®Œæˆ</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">allOf</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> cfs<span class="token punctuation">)</span>
<span class="token comment">//å…¶ä¸­ä¸€ä¸ªå®Œæˆ</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">anyOf</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> cfs<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2ã€alloféƒ½è¦å®Œæˆ" tabindex="-1"><a class="header-anchor" href="#_2ã€alloféƒ½è¦å®Œæˆ" aria-hidden="true">#</a> 2ã€<code>allOf</code>éƒ½è¦å®Œæˆ</h5><h6 id="_1ã€æµ‹è¯•1" tabindex="-1"><a class="header-anchor" href="#_1ã€æµ‹è¯•1" aria-hidden="true">#</a> 1ã€æµ‹è¯•1</h6><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future1 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future2 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello2&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future3 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello3&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>future1<span class="token punctuation">,</span> future2<span class="token punctuation">,</span> future3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;3ä¸ªä»»åŠ¡çš„è¿”å›ç»“æœï¼š&quot;</span> <span class="token operator">+</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é˜»å¡å¼ç­‰å¾…æ‰€æ¶ˆè€—ï¼š&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
ä»»åŠ¡1çº¿ç¨‹ï¼š12
ä»»åŠ¡2çº¿ç¨‹ï¼š13
ä»»åŠ¡3çº¿ç¨‹ï¼š14
ä»»åŠ¡1è¿è¡Œç»“æœï¼š5
ä»»åŠ¡3è¿è¡Œç»“æœï¼šhello3
ä»»åŠ¡2è¿è¡Œç»“æœï¼šhello2
3ä¸ªä»»åŠ¡çš„è¿”å›ç»“æœï¼šnull
é˜»å¡å¼ç­‰å¾…æ‰€æ¶ˆè€—ï¼š3000s
==========main end============
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>allOf</code>æ–¹æ³•è¦å»æ‰€æœ‰ä»»åŠ¡éƒ½è¦å®Œæˆï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨æœ€ç»ˆçš„<code>future.get()</code>ä¼šé˜»å¡çº¿ç¨‹ï¼Œå…¶è¿”å›å€¼ä¸º<code>null</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.7.2.1.png" alt="image-20220731191825653" tabindex="0" loading="lazy"><figcaption>image-20220731191825653</figcaption></figure><h6 id="_2ã€æµ‹è¯•2" tabindex="-1"><a class="header-anchor" href="#_2ã€æµ‹è¯•2" aria-hidden="true">#</a> 2ã€æµ‹è¯•2</h6><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future1 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future2 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello2&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future3 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello3&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>future1<span class="token punctuation">,</span> future2<span class="token punctuation">,</span> future3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;3ä¸ªä»»åŠ¡çš„è¿”å›ç»“æœï¼š&quot;</span> <span class="token operator">+</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é˜»å¡å¼ç­‰å¾…æ‰€æ¶ˆè€—ï¼š&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–ä»»åŠ¡1è¿”å›çš„ç»“æœï¼š&quot;</span> <span class="token operator">+</span> future1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–ä»»åŠ¡2è¿”å›çš„ç»“æœï¼š&quot;</span> <span class="token operator">+</span> future2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–ä»»åŠ¡3è¿”å›çš„ç»“æœï¼š&quot;</span> <span class="token operator">+</span> future3<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
ä»»åŠ¡1çº¿ç¨‹ï¼š12
ä»»åŠ¡2çº¿ç¨‹ï¼š13
ä»»åŠ¡3çº¿ç¨‹ï¼š14
ä»»åŠ¡1è¿è¡Œç»“æœï¼š5
ä»»åŠ¡3è¿è¡Œç»“æœï¼šhello3
ä»»åŠ¡2è¿è¡Œç»“æœï¼šhello2
3ä¸ªä»»åŠ¡çš„è¿”å›ç»“æœï¼šnull
é˜»å¡å¼ç­‰å¾…æ‰€æ¶ˆè€—ï¼š2999s
è·å–ä»»åŠ¡1è¿”å›çš„ç»“æœï¼š5
è·å–ä»»åŠ¡2è¿”å›çš„ç»“æœï¼šhello2
è·å–ä»»åŠ¡3è¿”å›çš„ç»“æœï¼šhello3
==========main end============
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥é€šè¿‡å„è‡ªçš„<code>future.get()</code>æ–¹æ³•ï¼Œæ¥è·å–å„è‡ªçš„è¿”å›å€¼</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.7.2.2.png" alt="image-20220731192539083" tabindex="0" loading="lazy"><figcaption>image-20220731192539083</figcaption></figure><h6 id="_3ã€æµ‹è¯•3" tabindex="-1"><a class="header-anchor" href="#_3ã€æµ‹è¯•3" aria-hidden="true">#</a> 3ã€æµ‹è¯•3</h6><p>å¦‚æœæ³¨é‡Šæ‰æœ€ç»ˆçš„<code>future.get()</code>æ–¹æ³•ï¼Œåˆ™ä¸ä¼šè¢«é˜»å¡ï¼Œ<code>main</code>æ–¹æ³•å…ˆé€€å‡º</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>future.get()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
ä»»åŠ¡1çº¿ç¨‹ï¼š12
ä»»åŠ¡2çº¿ç¨‹ï¼š13
ä»»åŠ¡3çº¿ç¨‹ï¼š14
==========main end============
ä»»åŠ¡1è¿è¡Œç»“æœï¼š5
ä»»åŠ¡3è¿è¡Œç»“æœï¼šhello3
ä»»åŠ¡2è¿è¡Œç»“æœï¼šhello2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.7.2.3.png" alt="image-20220731192051270" tabindex="0" loading="lazy"><figcaption>image-20220731192051270</figcaption></figure><h5 id="_3ã€anyofä»»ä½•ä¸€ä¸ªå®Œæˆ" tabindex="-1"><a class="header-anchor" href="#_3ã€anyofä»»ä½•ä¸€ä¸ªå®Œæˆ" aria-hidden="true">#</a> 3ã€<code>anyOf</code>ä»»ä½•ä¸€ä¸ªå®Œæˆ</h5><p>è¿è¡Œä»¥ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main start==========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future1 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡1è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future2 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello2&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡2è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future3 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;hello3&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»»åŠ¡3è¿è¡Œç»“æœï¼š&quot;</span> <span class="token operator">+</span> hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> hello<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executorService<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">anyOf</span><span class="token punctuation">(</span>future1<span class="token punctuation">,</span> future2<span class="token punctuation">,</span> future3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;3ä¸ªä»»åŠ¡çš„è¿”å›ç»“æœï¼š&quot;</span> <span class="token operator">+</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é˜»å¡å¼ç­‰å¾…æ‰€æ¶ˆè€—ï¼š&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;==========main end============&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>==========main start==========
ä»»åŠ¡1çº¿ç¨‹ï¼š12
ä»»åŠ¡2çº¿ç¨‹ï¼š13
ä»»åŠ¡3çº¿ç¨‹ï¼š14
ä»»åŠ¡1è¿è¡Œç»“æœï¼š5
3ä¸ªä»»åŠ¡çš„è¿”å›ç»“æœï¼š5
é˜»å¡å¼ç­‰å¾…æ‰€æ¶ˆè€—ï¼š1000s
==========main end============
ä»»åŠ¡3è¿è¡Œç»“æœï¼šhello3
ä»»åŠ¡2è¿è¡Œç»“æœï¼šhello2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>anyOf</code>æ–¹æ³•è¦æ±‚ï¼Œæ‰€æœ‰ä»»åŠ¡ä¸­ï¼Œä»»ä½•ä¸€ä¸ªå®Œæˆå³å¯</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.7.3.png" alt="image-20220731192832799" tabindex="0" loading="lazy"><figcaption>image-20220731192832799</figcaption></figure><h5 id="_4ã€æºç -1" tabindex="-1"><a class="header-anchor" href="#_4ã€æºç -1" aria-hidden="true">#</a> 4ã€æºç </h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">/* ------------- Arbitrary-arity constructions -------------- */</span>

<span class="token doc-comment comment">/**
 * Returns a new CompletableFuture that is completed when all of
 * the given CompletableFutures complete.  If any of the given
 * CompletableFutures complete exceptionally, then the returned
 * CompletableFuture also does so, with a CompletionException
 * holding this exception as its cause.  Otherwise, the results,
 * if any, of the given CompletableFutures are not reflected in
 * the returned CompletableFuture, but may be obtained by
 * inspecting them individually. If no CompletableFutures are
 * provided, returns a CompletableFuture completed with the value
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span>.
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Among the applications of this method is to await completion
 * of a set of independent CompletableFutures before continuing a
 * program, as in: <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span></span>
 * <span class="token code language-java">c3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token punctuation">}</span>.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">cfs</span> the CompletableFutures
 * <span class="token keyword">@return</span> a new CompletableFuture that is completed when all of the
 * given CompletableFutures complete
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">NullPointerException</span></span> if the array or any of its elements are
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">allOf</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> cfs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">andTree</span><span class="token punctuation">(</span>cfs<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cfs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * Returns a new CompletableFuture that is completed when any of
 * the given CompletableFutures complete, with the same result.
 * Otherwise, if it completed exceptionally, the returned
 * CompletableFuture also does so, with a CompletionException
 * holding this exception as its cause.  If no CompletableFutures
 * are provided, returns an incomplete CompletableFuture.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">cfs</span> the CompletableFutures
 * <span class="token keyword">@return</span> a new CompletableFuture that is completed with the
 * result or exception of any of the given CompletableFutures when
 * one completes
 * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">NullPointerException</span></span> if the array or any of its elements are
 * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">anyOf</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> cfs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">orTree</span><span class="token punctuation">(</span>cfs<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cfs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.2.7.4.png" alt="image-20220731191323588" tabindex="0" loading="lazy"><figcaption>image-20220731191323588</figcaption></figure><h4 id="_8ã€å®Œæ•´ä»£ç " tabindex="-1"><a class="header-anchor" href="#_8ã€å®Œæ•´ä»£ç " aria-hidden="true">#</a> 8ã€å®Œæ•´ä»£ç </h4><p><a href="code/5.6.2.8.ThreadTest.java">ç‚¹å‡»æŸ¥çœ‹<code>ThreadTest</code>ç±»å®Œæ•´ä»£ç </a></p><h3 id="_5-6-3ã€å•†åŸä¸šåŠ¡-å•†å“è¯¦æƒ…" tabindex="-1"><a class="header-anchor" href="#_5-6-3ã€å•†åŸä¸šåŠ¡-å•†å“è¯¦æƒ…" aria-hidden="true">#</a> 5.6.3ã€å•†åŸä¸šåŠ¡-å•†å“è¯¦æƒ…</h3><h4 id="_1ã€ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#_1ã€ç¯å¢ƒæ­å»º" aria-hidden="true">#</a> 1ã€ç¯å¢ƒæ­å»º</h4><h5 id="_1ã€ä¿®æ”¹hostæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1ã€ä¿®æ”¹hostæ–‡ä»¶" aria-hidden="true">#</a> 1ã€ä¿®æ”¹<code>host</code>æ–‡ä»¶</h5><p>æ‰“å¼€<code>SwitchHosts</code>è½¯ä»¶ï¼Œç‚¹å‡»<code>æœ¬åœ°æ–¹æ¡ˆ</code>é‡Œçš„<code>gulimall</code>ï¼Œåœ¨é‡Œé¢æ·»åŠ <code>192.168.56.10 item.gulimall.com</code>åŸŸåæ˜ å°„ï¼Œç”¨äºå•†å“è¯¦æƒ…é¡µå±•ç¤º</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># gulimall</span>
<span class="token key attr-name">192.168.56.10</span> <span class="token value attr-value">gulimall.com</span>
<span class="token key attr-name">192.168.56.10</span> <span class="token value attr-value">search.gulimall.com</span>
<span class="token key attr-name">192.168.56.10</span> <span class="token value attr-value">item.gulimall.com</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.1.1.png" alt="image-20220731193725444" style="zoom:67%;"><h5 id="_2ã€æ·»åŠ nginxé…ç½®" tabindex="-1"><a class="header-anchor" href="#_2ã€æ·»åŠ nginxé…ç½®" aria-hidden="true">#</a> 2ã€æ·»åŠ <code>nginx</code>é…ç½®</h5><p>æ‰“å¼€<code>Xshell</code>ï¼Œä¿®æ”¹<code>/mydata/nginx/conf/gulimall.conf</code>æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /mydata/nginx/conf/
<span class="token function">ls</span>
<span class="token builtin class-name">cd</span> conf.d/
<span class="token function">ls</span>
<span class="token function">vi</span> gulimall.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.1.2.1.png" alt="image-20220731194052069" tabindex="0" loading="lazy"><figcaption>image-20220731194052069</figcaption></figure><p>ç”±äº<code>server_name</code>é…ç½®çš„æ˜¯<code>*.gulimall.com</code>ï¼Œå·²ç»æŠŠ<code>gulimall.com</code>çš„å­åŸŸåéƒ½é…ç½®äº†ï¼Œæ‰€æœ‰ä¸ç”¨å†é…ç½®äº†</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.1.2.2.png" alt="image-20220731193944867" tabindex="0" loading="lazy"><figcaption>image-20220731193944867</figcaption></figure><h5 id="_3ã€é…ç½®gateway" tabindex="-1"><a class="header-anchor" href="#_3ã€é…ç½®gateway" aria-hidden="true">#</a> 3ã€é…ç½®<code>gateway</code></h5><p>åœ¨ç½‘å…³ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼ŒæŠŠ<code>item.gulimall.com</code>åŸŸåä¸‹çš„è¯·æ±‚è´Ÿè½½å‡è¡¡åˆ°<code>gulimall-product</code>æœåŠ¡</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      	<span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> gulimall_host_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//gulimall<span class="token punctuation">-</span>product
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Host=gulimall.com<span class="token punctuation">,</span>item.gulimall.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.1.3.png" alt="image-20220731194707345" tabindex="0" loading="lazy"><figcaption>image-20220731194707345</figcaption></figure><h5 id="_4ã€å¯¼å…¥æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_4ã€å¯¼å…¥æ–‡ä»¶" aria-hidden="true">#</a> 4ã€å¯¼å…¥æ–‡ä»¶</h5><p>å°†èµ„æºé‡Œçš„<code>2.åˆ†å¸ƒå¼é«˜çº§ç¯‡ï¼ˆå¾®æœåŠ¡æ¶æ„ç¯‡ï¼‰\\èµ„æ–™æºç \\ä»£ç \\html\\è¯¦æƒ…é¡µ</code>ç›®å½•é‡Œçš„<code>shangpinxiangqing.html</code>æ–‡ä»¶å¤åˆ¶åˆ°<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates</code>ç›®å½•ä¸‹ï¼Œå¹¶å°†<code>shangpinxiangqing.html</code>æ–‡ä»¶ä¿®æ”¹ä¸º<code>item.html</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.1.4.1.png" alt="image-20220731194607792" tabindex="0" loading="lazy"><figcaption>image-20220731194607792</figcaption></figure><p>åœ¨<code>linuxè™šæ‹Ÿæœº</code>é‡Œçš„<code>/mydata/nginx/html/static</code>ç›®å½•é‡Œé¢æ–°å»º<code>item</code>æ–‡ä»¶å¤¹ï¼Œå°†èµ„æºé‡Œçš„<code>2.åˆ†å¸ƒå¼é«˜çº§ç¯‡ï¼ˆå¾®æœåŠ¡æ¶æ„ç¯‡ï¼‰\\èµ„æ–™æºç \\ä»£ç \\html\\è¯¦æƒ…é¡µ</code>é‡Œçš„å…¶ä»–æ–‡ä»¶å¤¹å¤åˆ¶åˆ°<code>linuxè™šæ‹Ÿæœº</code>çš„<code>/mydata/nginx/html/static/item</code>ç›®å½•é‡Œé¢</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.1.4.2.gif" alt="GIF 2022-7-31 19-54-25" tabindex="0" loading="lazy"><figcaption>GIF 2022-7-31 19-54-25</figcaption></figure><p>å°†<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œçš„éƒ¨åˆ†<code>href=&quot;</code>(é™¤äº†<code>href=&quot;#&quot;</code>)æ›¿æ¢ä¸º<code>href=&quot;/static/item/</code>ï¼Œå°†éƒ¨åˆ†<code>src=&quot;</code>(é™¤äº†<code>src=&quot;å®é™…url&quot;</code>)æ›¿æ¢ä¸º<code>src=&quot;/static/item/</code></p>`,333),r=s("code",null,"item",-1),d=a(`<h5 id="_5ã€æ–°å»ºskuitemæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_5ã€æ–°å»ºskuitemæ–¹æ³•" aria-hidden="true">#</a> 5ã€æ–°å»º<code>skuItem</code>æ–¹æ³•</h5><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.web.ItemController</code>åŒ…ä¸‹æ–°å»º<code>skuItem</code>æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>product<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> æ— åæ°
 * <span class="token keyword">@date</span> 2022/7/31
 * @Description: å•†å“çš„è¯¦æƒ…ä¿¡æ¯
 */</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ItemController</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * å±•ç¤ºskuçš„è¯¦æƒ…
     * <span class="token keyword">@param</span> <span class="token parameter">skuId</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{skuId}.html&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">skuItem</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å‡†å¤‡æŸ¥è¯¢&quot;</span> <span class="token operator">+</span> skuId <span class="token operator">+</span> <span class="token string">&quot;çš„è¯¦æƒ…&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.1.5.png" alt="image-20220731202407973" tabindex="0" loading="lazy"><figcaption>image-20220731202407973</figcaption></figure><h5 id="_6ã€æ·»åŠ é¡µé¢è·³è½¬" tabindex="-1"><a class="header-anchor" href="#_6ã€æ·»åŠ é¡µé¢è·³è½¬" aria-hidden="true">#</a> 6ã€æ·»åŠ é¡µé¢è·³è½¬</h5><p>æ‰“å¼€<code>http://search.gulimall.com/list.html?catalog3Id=225</code>é¡µé¢ï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½åˆ°<code>æŸä¸ªå•†å“</code>ï¼Œå¤åˆ¶<code>class=&quot;da&quot;</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.1.6.1.png" alt="image-20220731201122217" tabindex="0" loading="lazy"><figcaption>image-20220731201122217</figcaption></figure><p>åœ¨<code> class=&quot;da&quot;</code>çš„<code>&lt;p&gt;</code>æ ‡ç­¾é‡Œçš„<code>&lt;a&gt;</code>æ ‡ç­¾é‡Œæ·»åŠ <code>th:href=&quot;|http://item.gulimall.com/\${prodect.skuId}.html|&quot;</code>å±æ€§ï¼Œç‚¹å‡»è¯¥å›¾ç‰‡è·³è½¬åˆ°ç›¸åº”çš„é¡µé¢ï¼Œ<code>|</code>ä¸º<code>thymeleaf</code>è¯­æ³•ï¼Œå¯ä»¥å¿«é€Ÿæ‹¼ä¸²</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token comment">&lt;!--æ’åºå†…å®¹--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rig_tab<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prodect:\${result.getProducts()}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ico<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont icon-weiguanzhu<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>å…³æ³¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>da<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>|http://item.gulimall.com/\${prodect.skuId}.html|<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${prodect.skuImg}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dim<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tab_im<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>é»‘è‰²<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${prodect.skuImg}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tab_R<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&#39;</span>Â¥&#39;+\${prodect.skuPrice}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Â¥5199.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tab_JE<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>utext</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${prodect.skuTitle}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                Apple iPhone 7 Plus (A1661) 32G é»‘è‰² ç§»åŠ¨è”é€šç”µä¿¡4Gæ‰‹æœº
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tab_PI<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>å·²æœ‰<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>11ä¸‡+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>çƒ­é—¨è¯„ä»·
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>äºŒæ‰‹æœ‰å”®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tab_CP<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>è°·ç²’å•†åŸAppleäº§å“ä¸“è¥åº—<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>è°·ç²’å•†åŸAppleäº§å“...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>#<span class="token punctuation">&#39;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>è”ç³»ä¾›åº”å•†è¿›è¡Œå’¨è¯¢<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/static/search/img/xcxc.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tab_FO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FO_one<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è‡ªè¥
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>è°·ç²’å•†åŸè‡ªè¥,å“è´¨ä¿è¯<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>æ»¡èµ 
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>è¯¥å•†å“å‚åŠ æ»¡èµ æ´»åŠ¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.1.6.2.png" alt="image-20220731202128687" tabindex="0" loading="lazy"><figcaption>image-20220731202128687</figcaption></figure><h5 id="_7ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_7ã€æµ‹è¯•" aria-hidden="true">#</a> 7ã€æµ‹è¯•</h5><p>é‡å¯<code>GulimallProductApplication</code>æœåŠ¡å’Œ<code>GulimallGatewayApplication</code>æœåŠ¡ï¼Œæ‰“å¼€<code>http://search.gulimall.com/list.html</code>é¡µé¢ï¼Œå®šä½åˆ°æŸä¸ªå•†å“çš„<code>&lt;a&gt;</code>æ ‡ç­¾ï¼Œå¯ä»¥çœ‹åˆ°å…¶<code>href</code>å±æ€§å·²ä¿®æ”¹ä¸º<code>http://item.gulimall.com/9.html</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.1.7.1.png" alt="image-20220731202040269" tabindex="0" loading="lazy"><figcaption>image-20220731202040269</figcaption></figure><p>ç‚¹å‡»è¯¥å•†å“ï¼Œå·²ç»è·³è½¬åˆ°äº†<code>http://item.gulimall.com/9.html</code>é¡µé¢ï¼Œä¸è¿‡ä¸æ˜¯åŠ¨æ€çš„æ•°æ®</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.1.7.2.png" alt="image-20220731202143743" tabindex="0" loading="lazy"><figcaption>image-20220731202143743</figcaption></figure><p>æ‰“å¼€<code>GulimallProductApplication</code>æœåŠ¡çš„æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡º<code>å‡†å¤‡æŸ¥è¯¢9çš„è¯¦æƒ…</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.1.7.3.png" alt="image-20220731202258611" tabindex="0" loading="lazy"><figcaption>image-20220731202258611</figcaption></figure><h4 id="_2ã€å°è£…è¯¦æƒ…é¡µæ•°æ®" tabindex="-1"><a class="header-anchor" href="#_2ã€å°è£…è¯¦æƒ…é¡µæ•°æ®" aria-hidden="true">#</a> 2ã€å°è£…è¯¦æƒ…é¡µæ•°æ®</h4><h5 id="_1ã€å‡†å¤‡å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#_1ã€å‡†å¤‡å·¥ä½œ" aria-hidden="true">#</a> 1ã€å‡†å¤‡å·¥ä½œ</h5><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.vo</code>åŒ…é‡Œæ–°å»º<code>SkuItemVo</code>ç±»ç”¨äºå°è£…å•†å“è¯¦æƒ…é¡µæ•°æ®</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>product<span class="token punctuation">.</span>vo</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> æ— åæ°
 * <span class="token keyword">@date</span> 2022/7/31
 * @Description: å•†å“è¯¦æƒ…é¡µæ•°æ®
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SkuItemVo</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.1.1.png" alt="image-20220731202609160" tabindex="0" loading="lazy"><figcaption>image-20220731202609160</figcaption></figure><p>ä¿®æ”¹<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.web.ItemController</code>ç±»çš„<code>skuItem</code>æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">SkuInfoService</span> skuInfoService<span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * å±•ç¤ºskuçš„è¯¦æƒ…
 * <span class="token keyword">@param</span> <span class="token parameter">skuId</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{skuId}.html&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">skuItem</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment">//System.out.println(&quot;å‡†å¤‡æŸ¥è¯¢&quot; + skuId + &quot;çš„è¯¦æƒ…&quot;);</span>

    <span class="token class-name">SkuItemVo</span> vo <span class="token operator">=</span> skuInfoService<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.1.2.png" alt="image-20220731203013826" tabindex="0" loading="lazy"><figcaption>image-20220731203013826</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.SkuInfoService</code>æ¥å£é‡Œæ·»åŠ <code>item</code>æŠ½è±¡æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SkuItemVo</span> <span class="token function">item</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.1.3.png" alt="image-20220731203048457" tabindex="0" loading="lazy"><figcaption>image-20220731203048457</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.impl.SkuInfoServiceImpl</code>ç±»é‡Œå®ç°<code>item</code>æŠ½è±¡æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">SkuItemVo</span> <span class="token function">item</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SkuItemVo</span> skuItemVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuItemVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//1ã€skuåŸºæœ¬ä¿¡æ¯è·å–pms_sku_info</span>

    <span class="token comment">//2ã€skuçš„å›¾ç‰‡ä¿¡æ¯pms_sku_images</span>

    <span class="token comment">//3ã€è·å–spuçš„é”€å”®å±æ€§ç»„åˆã€‚</span>

    <span class="token comment">//4ã€è·å–spuçš„ä»‹ç»</span>

    <span class="token comment">//5ã€è·å–spuçš„è§„æ ¼å‚æ•°ä¿¡æ¯ã€‚</span>


    <span class="token keyword">return</span> skuItemVo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.1.4.png" alt="image-20220731203543095" tabindex="0" loading="lazy"><figcaption>image-20220731203543095</figcaption></figure><h5 id="_2ã€æŸ¥å‡ºè¯¦æƒ…é¡µçš„æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_2ã€æŸ¥å‡ºè¯¦æƒ…é¡µçš„æ•°æ®" aria-hidden="true">#</a> 2ã€æŸ¥å‡ºè¯¦æƒ…é¡µçš„æ•°æ®</h5><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.vo.SkuItemVo</code>ç±»é‡Œæ·»åŠ éœ€è¦å°è£…çš„æ•°æ®å­—æ®µ</p><p><a href="code/5.6.3.2.2.SkuItemVo.java">ç‚¹å‡»æŸ¥çœ‹<code>SkuItemVo</code>ç±»å®Œæ•´ä»£ç </a></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.2.1.png" alt="image-20220731205828359" tabindex="0" loading="lazy"><figcaption>image-20220731205828359</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.impl.SkuInfoServiceImpl</code>ç±»çš„<code>item</code>æ–¹æ³•é‡Œæ·»åŠ å…·ä½“å®ç°</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">SkuItemVo</span> <span class="token function">item</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SkuItemVo</span> skuItemVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuItemVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//1ã€skuåŸºæœ¬ä¿¡æ¯è·å–pms_sku_info</span>
    <span class="token class-name">SkuInfoEntity</span> skuInfoEntity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    skuItemVo<span class="token punctuation">.</span><span class="token function">setInfo</span><span class="token punctuation">(</span>skuInfoEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> spuId <span class="token operator">=</span> skuInfoEntity<span class="token punctuation">.</span><span class="token function">getSpuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Long</span> catalogId <span class="token operator">=</span> skuInfoEntity<span class="token punctuation">.</span><span class="token function">getCatalogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//2ã€skuçš„å›¾ç‰‡ä¿¡æ¯pms_sku_images</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuImagesEntity</span><span class="token punctuation">&gt;</span></span> images <span class="token operator">=</span> skuImagesService<span class="token punctuation">.</span><span class="token function">getImagesBySkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    skuItemVo<span class="token punctuation">.</span><span class="token function">setImages</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//3ã€è·å–spuçš„é”€å”®å±æ€§ç»„åˆã€‚</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemVo<span class="token punctuation">.</span>SkuItemSaleAttrVo</span><span class="token punctuation">&gt;</span></span> skuItemSaleAttrVos <span class="token operator">=</span> skuSaleAttrValueService<span class="token punctuation">.</span><span class="token function">getSaleAttrsBySpuId</span><span class="token punctuation">(</span>spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    skuItemVo<span class="token punctuation">.</span><span class="token function">setSaleAttr</span><span class="token punctuation">(</span>skuItemSaleAttrVos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//4ã€è·å–spuçš„ä»‹ç» pms_spu_info_desc</span>
    <span class="token class-name">SpuInfoDescEntity</span> spuInfoDescEntity <span class="token operator">=</span> spuInfoDescService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    skuItemVo<span class="token punctuation">.</span><span class="token function">setDesp</span><span class="token punctuation">(</span>spuInfoDescEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//5ã€è·å–spuçš„è§„æ ¼å‚æ•°ä¿¡æ¯ã€‚</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemVo<span class="token punctuation">.</span>SpuItemAttrGroupVo</span><span class="token punctuation">&gt;</span></span> attrGroupVos <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">getAttrGroupWithAttrsBySpuIdAndCatalogId</span><span class="token punctuation">(</span>spuId<span class="token punctuation">,</span>catalogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    skuItemVo<span class="token punctuation">.</span><span class="token function">setGroupAttrs</span><span class="token punctuation">(</span>attrGroupVos<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> skuItemVo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.2.2.png" alt="image-20220802100658259" tabindex="0" loading="lazy"><figcaption>image-20220802100658259</figcaption></figure><h5 id="_3ã€è·å–skuå›¾ç‰‡ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_3ã€è·å–skuå›¾ç‰‡ä¿¡æ¯" aria-hidden="true">#</a> 3ã€è·å–skuå›¾ç‰‡ä¿¡æ¯</h5><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.SkuImagesService</code>æ¥å£é‡Œæ·»åŠ <code>getImagesBySkuId</code>æŠ½è±¡æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuImagesEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">getImagesBySkuId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.3.1.png" alt="image-20220802100745220" tabindex="0" loading="lazy"><figcaption>image-20220802100745220</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.impl.SkuImagesServiceImpl</code>ç±»é‡Œå®ç°<code>getImagesBySkuId</code>æŠ½è±¡æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuImagesEntity</span><span class="token punctuation">&gt;</span></span> <span class="token function">getImagesBySkuId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

   <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuImagesEntity</span><span class="token punctuation">&gt;</span></span> lambdaQueryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   lambdaQueryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">SkuImagesEntity</span><span class="token operator">::</span><span class="token function">getSkuId</span><span class="token punctuation">,</span> skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baseMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>lambdaQueryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.3.2.png" alt="image-20220802101301908" tabindex="0" loading="lazy"><figcaption>image-20220802101301908</figcaption></figure><h5 id="_4ã€è·å–spuè§„æ ¼å‚æ•°ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#_4ã€è·å–spuè§„æ ¼å‚æ•°ä¿¡æ¯" aria-hidden="true">#</a> 4ã€è·å–spuè§„æ ¼å‚æ•°ä¿¡æ¯</h5><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.AttrGroupService</code>æ¥å£é‡Œæ·»åŠ <code>getAttrGroupWithAttrsBySpuIdAndCatalogId</code>æŠ½è±¡æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemVo<span class="token punctuation">.</span>SpuItemAttrGroupVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAttrGroupWithAttrsBySpuIdAndCatalogId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> spuId<span class="token punctuation">,</span> <span class="token class-name">Long</span> catalogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.4.1.png" alt="image-20220802101801380" tabindex="0" loading="lazy"><figcaption>image-20220802101801380</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.impl.AttrGroupServiceImpl</code>ç±»é‡Œå®ç°<code>getAttrGroupWithAttrsBySpuIdAndCatalogId</code>æŠ½è±¡æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemVo<span class="token punctuation">.</span>SpuItemAttrGroupVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAttrGroupWithAttrsBySpuIdAndCatalogId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> spuId<span class="token punctuation">,</span> <span class="token class-name">Long</span> catalogId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//æŸ¥å‡ºå½“å‰spuå¯¹åº”çš„æ‰€æœ‰å±æ€§çš„åˆ†ç»„ä¿¡æ¯ä»¥åŠå½“å‰åˆ†ç»„ä¸‹çš„æ‰€æœ‰å±æ€§å¯¹åº”çš„å€¼</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baseMapper<span class="token punctuation">.</span><span class="token function">getAttrGroupWithAttrsBySpuIdAndCatalogId</span><span class="token punctuation">(</span>spuId<span class="token punctuation">,</span>catalogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.4.2.png" alt="image-20220802102053960" tabindex="0" loading="lazy"><figcaption>image-20220802102053960</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.dao.AttrGroupDao</code>æ¥å£é‡Œæ·»åŠ <code>getAttrGroupWithAttrsBySpuIdAndCatalogId</code>æŠ½è±¡æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemVo<span class="token punctuation">.</span>SpuItemAttrGroupVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAttrGroupWithAttrsBySpuIdAndCatalogId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;spuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> spuId<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;catalogId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> catalogId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.4.3.gif" alt="GIF 2022-8-2 10-23-33" tabindex="0" loading="lazy"><figcaption>GIF 2022-8-2 10-23-33</figcaption></figure><h5 id="_5ã€ç¼–å†™sql" tabindex="-1"><a class="header-anchor" href="#_5ã€ç¼–å†™sql" aria-hidden="true">#</a> 5ã€ç¼–å†™sql</h5><p>æƒ³è¦å°è£…çš„æ•°æ®</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å•†å“çš„åŸºæœ¬å±æ€§åˆ†ç»„
 * (åŸºæœ¬ä¿¡æ¯:
 *    æœºèº«é•¿åº¦ï¼ˆmmï¼‰ 150.5
 *    æœºèº«å®½åº¦ï¼ˆmmï¼‰ 77.8
 *    æœºèº«åšåº¦ï¼ˆmmï¼‰ 8.2
 *    æœºèº«é‡é‡ï¼ˆgï¼‰  çº¦186gï¼ˆå«ç”µæ± ï¼‰
 * )
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SpuItemAttrGroupVo</span><span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * ç»„å
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> groupName<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * å±æ€§åˆ—è¡¨
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuBaseAttrVo</span><span class="token punctuation">&gt;</span></span> attrs<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * å•†å“è¯¦ç»†ä¿¡æ¯é‡Œçš„åŸºæœ¬å±æ€§
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SpuBaseAttrVo</span><span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * å±æ€§å
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> attrName<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * å±æ€§å€¼
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> attrValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.5.1.png" alt="image-20220804192407328" tabindex="0" loading="lazy"><figcaption>image-20220804192407328</figcaption></figure><p>åœ¨<code>gulimall_pms</code>æ•°æ®åº“é‡Œï¼Œå¯ä»¥æ ¹æ®<code>catelog_id</code>å¯ä»¥åœ¨<code>pms_attr_group</code>è¡¨é‡ŒæŸ¥å‡º<code>attr_group_name</code>å’Œ<code>attr_group_id</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.5.2.png" alt="image-20220731212330393" tabindex="0" loading="lazy"><figcaption>image-20220731212330393</figcaption></figure><p>æ ¹æ®<code>catelog_id</code>åœ¨<code>pms_attr_group</code>è¡¨é‡ŒæŸ¥å‡º<code>attr_group_name</code>å’Œ<code>attr_group_id</code>çš„<code>sql</code>è¯­å¥</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>select * from pms_attr_group where catelog_id = 225;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.5.3.png" alt="image-20220802090316099" tabindex="0" loading="lazy"><figcaption>image-20220802090316099</figcaption></figure><p>æ ¹æ®åˆšåˆšæŸ¥å‡ºçš„<code>attr_group_id</code>å¯ä»¥åœ¨<code>pms_attr_attrgroup_relation</code>è¡¨é‡ŒæŸ¥å‡ºå¯¹åº”çš„æ‰€æœ‰<code>attr_id</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.5.4.png" alt="image-20220804192923497" tabindex="0" loading="lazy"><figcaption>image-20220804192923497</figcaption></figure><p>æ ¹æ®åˆšåˆšæŸ¥å‡ºçš„<code>attr_group_id</code>åœ¨<code>pms_attr_attrgroup_relation</code>è¡¨é‡ŒæŸ¥å‡ºå¯¹åº”çš„æ‰€æœ‰<code>attr_id</code>çš„<code>sql</code>è¯­å¥</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>select pag.attr_group_name,pag.attr_group_id,paar.attr_id
from pms_attr_group pag
left join pms_attr_attrgroup_relation paar on pag.attr_group_id = paar.attr_group_id
where catelog_id = 225;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.5.5.png" alt="image-20220802090959411" tabindex="0" loading="lazy"><figcaption>image-20220802090959411</figcaption></figure><p>æ ¹æ®åˆšåˆšæŸ¥è¯¢åˆ°çš„<code>attr_id</code>å¯ä»¥åœ¨<code>pms_attr</code>è¡¨é‡ŒæŸ¥è¯¢å‡º<code>attr_name</code></p><p>âš ï¸è¿™é‡Œçš„<code>pms_attr</code>è¡¨é‡Œ<code>value_select</code>ä¸ºå¯é€‰çš„<code>value</code>åˆ—è¡¨ï¼Œä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„<code>attrValue</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.5.6.png" alt="image-20220804193530836" tabindex="0" loading="lazy"><figcaption>image-20220804193530836</figcaption></figure><p>æ ¹æ®æŸ¥è¯¢åˆ°çš„<code>attr_id</code>åœ¨<code>pms_attr</code>è¡¨é‡ŒæŸ¥è¯¢å‡º<code>attr_name</code>çš„<code>sql</code>è¯­å¥</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select pag.attr_group_name,pag.attr_group_id,paar.attr_id,pattr.attr_name
from pms_attr_group pag
left join pms_attr_attrgroup_relation paar on pag.attr_group_id = paar.attr_group_id
left join pms_attr pattr on paar.attr_id = pattr.attr_id
where pag.catelog_id = 225;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.5.7.png" alt="image-20220802091511570" tabindex="0" loading="lazy"><figcaption>image-20220802091511570</figcaption></figure><p>æ ¹æ®åˆšåˆšæŸ¥å‡ºçš„<code>attr_id</code>å¯ä»¥åœ¨<code>pms_product_attr_value</code>è¡¨é‡ŒæŸ¥å¯¹åº”çš„<code>attr_value</code>(å…¶å®è¿™é‡Œé¢æœ‰<code>attr_name</code>å®Œå…¨æ²¡æœ‰å¿…è¦åœ¨<code>pms_attr</code>è¡¨é‡Œé¢æŸ¥)</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.5.8.png" alt="image-20220804194438412" tabindex="0" loading="lazy"><figcaption>image-20220804194438412</figcaption></figure><p>æ ¹æ®åˆšåˆšæŸ¥å‡ºçš„<code>attr_id</code>åœ¨<code>pms_product_attr_value</code>è¡¨é‡ŒæŸ¥å¯¹åº”çš„<code>attr_value</code>çš„<code>sql</code>è¯­å¥</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select pag.attr_group_name,pag.attr_group_id,paar.attr_id,pattr.attr_name,ppav.attr_value
from pms_attr_group pag
left join pms_attr_attrgroup_relation paar on pag.attr_group_id = paar.attr_group_id
left join pms_attr pattr on paar.attr_id = pattr.attr_id
left join pms_product_attr_value ppav on pattr.attr_id = ppav.attr_id
where pag.catelog_id = 225;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.5.9.png" alt="image-20220802092257211" tabindex="0" loading="lazy"><figcaption>image-20220802092257211</figcaption></figure><p>åˆšåˆšå·²ç»æŸ¥è¯¢å‡ºäº†å½“å‰<code>catelog_id</code>çš„æ‰€æœ‰<code>attr_group_name</code>ã€<code>attr_name</code>ã€<code>attr_value</code>ï¼Œå†ç­›é€‰æ‰ä¸æ˜¯å½“å‰<code>spu_id</code>çš„æ•°æ®å°±è¡Œäº†(è¿™æ ·åšæ„Ÿè§‰å¥½åƒä¸å¤ªé«˜æ•ˆï¼Œæˆ‘è§‰å¾—åº”è¯¥å…ˆåœ¨<code>pms_product_attr_value</code>è¡¨é‡ŒæŸ¥è¯¢å‡ºå½“å‰<code>spu_id</code>çš„æ‰€æœ‰<code>attr_id</code>ï¼Œåœ¨æ ¹æ®<code>attr_id</code>æŸ¥å‡º<code>attr_group_name</code>)</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select pag.attr_group_name,pag.attr_group_id,paar.attr_id,pattr.attr_name,ppav.attr_value,ppav.spu_id
from pms_attr_group pag
left join pms_attr_attrgroup_relation paar on pag.attr_group_id = paar.attr_group_id
left join pms_attr pattr on paar.attr_id = pattr.attr_id
left join pms_product_attr_value ppav on pattr.attr_id = ppav.attr_id
where pag.catelog_id = 225 and ppav.spu_id = 1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.5.10.png" alt="image-20220802092848294" tabindex="0" loading="lazy"><figcaption>image-20220802092848294</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/mapper/product/AttrGroupDao.xml</code>æ–‡ä»¶é‡Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼ˆå†…éƒ¨ç±»å‰é¢ä½¿ç”¨<code>$</code>è¿æ¥ï¼Œè€Œä¸æ˜¯<code>.</code>ï¼‰</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spuItemAttrGroupVo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.gulimall.product.vo.SkuItemVo$SpuItemAttrGroupVo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>groupName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr_group_name<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attrs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.gulimall.product.vo.SkuItemVo$SpuBaseAttrVo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attrName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr_name<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attrValues<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr_value<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getAttrGroupWithAttrsBySpuIdAndCatalogId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>spuItemAttrGroupVo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select pag.attr_group_name,pag.attr_group_id,paar.attr_id,pattr.attr_name,ppav.attr_value,ppav.spu_id
    from gulimall_pms.pms_attr_group pag
             left join gulimall_pms.pms_attr_attrgroup_relation paar on pag.attr_group_id = paar.attr_group_id
             left join gulimall_pms.pms_attr pattr on paar.attr_id = pattr.attr_id
             left join gulimall_pms.pms_product_attr_value ppav on pattr.attr_id = ppav.attr_id
    where pag.catelog_id = #{catalogId} and ppav.spu_id = #{spuId};
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.5.11.png" alt="image-20220802104501856" tabindex="0" loading="lazy"><figcaption>image-20220802104501856</figcaption></figure><h5 id="_6ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_6ã€æµ‹è¯•" aria-hidden="true">#</a> 6ã€æµ‹è¯•</h5><p>æŠŠ<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.impl.SkuInfoServiceImpl</code>ç±»çš„<code>item</code>æ–¹æ³•çš„<code>3ã€è·å–spuçš„é”€å”®å±æ€§ç»„åˆã€‚</code>çš„éƒ¨åˆ†æ³¨é‡Šæ‰</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemVo<span class="token punctuation">.</span>SkuItemSaleAttrVo</span><span class="token punctuation">&gt;</span></span> skuItemSaleAttrVos <span class="token operator">=</span> skuSaleAttrValueService<span class="token punctuation">.</span><span class="token function">getSaleAttrsBySpuId</span><span class="token punctuation">(</span>spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
skuItemVo<span class="token punctuation">.</span><span class="token function">setSaleAttr</span><span class="token punctuation">(</span>skuItemSaleAttrVos<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.6.1.png" alt="image-20220802104358079" tabindex="0" loading="lazy"><figcaption>image-20220802104358079</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.GulimallProductApplicationTests</code>æµ‹è¯•ç±»é‡Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œæ‰§è¡Œæµ‹è¯•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">AttrGroupService</span> attrGroupService<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">attrGroupServiceTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>attrGroupService<span class="token punctuation">.</span><span class="token function">getAttrGroupWithAttrsBySpuIdAndCatalogId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token number">225L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŠ¥äº†å¦‚ä¸‹é”™è¯¯</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Caused by: java.lang.IllegalStateException: No typehandler found for property attrValues
	at org.apache.ibatis.mapping.ResultMapping$Builder.validate(ResultMapping.java:151)
	at org.apache.ibatis.mapping.ResultMapping$Builder.build(ResultMapping.java:140)
	at org.apache.ibatis.builder.MapperBuilderAssistant.buildResultMapping(MapperBuilderAssistant.java:391)
	at org.apache.ibatis.builder.xml.XMLMapperBuilder.buildResultMappingFromContext(XMLMapperBuilder.java:393)
	at org.apache.ibatis.builder.xml.XMLMapperBuilder.resultMapElement(XMLMapperBuilder.java:280)
	at org.apache.ibatis.builder.xml.XMLMapperBuilder.processNestedResultMappings(XMLMapperBuilder.java:402)
	at org.apache.ibatis.builder.xml.XMLMapperBuilder.buildResultMappingFromContext(XMLMapperBuilder.java:383)
	at org.apache.ibatis.builder.xml.XMLMapperBuilder.resultMapElement(XMLMapperBuilder.java:280)
	at org.apache.ibatis.builder.xml.XMLMapperBuilder.resultMapElement(XMLMapperBuilder.java:253)
	at org.apache.ibatis.builder.xml.XMLMapperBuilder.resultMapElements(XMLMapperBuilder.java:245)
	at org.apache.ibatis.builder.xml.XMLMapperBuilder.configurationElement(XMLMapperBuilder.java:118)
	... 95 more
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.6.2.png" alt="image-20220802104717746" tabindex="0" loading="lazy"><figcaption>image-20220802104717746</figcaption></figure><p>å°†<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.vo.SkuItemVo</code>ç±»çš„<code>SpuBaseAttrVo</code>å†…éƒ¨ç±»çš„<code>private List&lt;String&gt; attrValues;</code>ä¿®æ”¹ä¸º<code>private String attrValue;</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.6.3.png" alt="image-20220802104829696" tabindex="0" loading="lazy"><figcaption>image-20220802104829696</figcaption></figure><p>å°†<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/mapper/product/AttrGroupDao.xml</code>æ–‡ä»¶é‡Œçš„<code>&lt;result property=&quot;attrValues&quot; column=&quot;attr_value&quot;/&gt;</code>ä¿®æ”¹ä¸º<code>&lt;result property=&quot;attrValue&quot; column=&quot;attr_value&quot;/&gt;</code></p><p>ç„¶åé‡å¯<code>GulimallProductApplication</code>æ¨¡å—ï¼Œåˆ·æ–°<code>http://item.gulimall.com/9.html</code>é¡µé¢ï¼Œ<code>GulimallProductApplication</code>æœåŠ¡çš„æ§åˆ¶å°æˆåŠŸè¾“å‡ºäº†<code>skuItemVo</code>çš„æ•°æ®</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">[</span>SkuItemVo.SpuItemAttrGroupVo(groupName=ä¸»ä½“<span class="token punctuation">,</span> attrs=<span class="token punctuation">[</span>SkuItemVo.SpuBaseAttrVo(attrName=å…¥ç½‘å‹å·<span class="token punctuation">,</span> attrValue=LIO-A00)<span class="token punctuation">,</span> SkuItemVo.SpuBaseAttrVo(attrName=ä¸Šå¸‚å¹´ä»½<span class="token punctuation">,</span> attrValue=<span class="token number">2019</span>)<span class="token punctuation">]</span>)<span class="token punctuation">,</span> SkuItemVo.SpuItemAttrGroupVo(groupName=åŸºæœ¬ä¿¡æ¯<span class="token punctuation">,</span> attrs=<span class="token punctuation">[</span>SkuItemVo.SpuBaseAttrVo(attrName=æœºèº«é¢œè‰²<span class="token punctuation">,</span> attrValue=é»‘è‰²)<span class="token punctuation">,</span> SkuItemVo.SpuBaseAttrVo(attrName=æœºèº«é•¿åº¦(mm)<span class="token punctuation">,</span> attrValue=<span class="token number">158.3</span>)<span class="token punctuation">,</span> SkuItemVo.SpuBaseAttrVo(attrName=æœºèº«æè´¨å·¥è‰º<span class="token punctuation">,</span> attrValue=å…¶ä»–)<span class="token punctuation">]</span>)<span class="token punctuation">,</span> SkuItemVo.SpuItemAttrGroupVo(groupName=ä¸»èŠ¯ç‰‡<span class="token punctuation">,</span> attrs=<span class="token punctuation">[</span>SkuItemVo.SpuBaseAttrVo(attrName=CPUå“ç‰Œ<span class="token punctuation">,</span> attrValue=æµ·æ€(Hisilicon))<span class="token punctuation">,</span> SkuItemVo.SpuBaseAttrVo(attrName=CPUå‹å·<span class="token punctuation">,</span> attrValue=HUAWEI Kirin <span class="token number">980</span>)<span class="token punctuation">]</span>)<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.6.4.png" alt="image-20220802105046822" tabindex="0" loading="lazy"><figcaption>image-20220802105046822</figcaption></figure><h5 id="_7ã€è·å–spué”€å”®å±æ€§é›†åˆ" tabindex="-1"><a class="header-anchor" href="#_7ã€è·å–spué”€å”®å±æ€§é›†åˆ" aria-hidden="true">#</a> 7ã€è·å–spué”€å”®å±æ€§é›†åˆ</h5><p>å»æ‰åˆšåˆšåœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.impl.SkuInfoServiceImpl</code>ç±»çš„<code>item</code>æ–¹æ³•çš„<code>3ã€è·å–spuçš„é”€å”®å±æ€§ç»„åˆã€‚</code>çš„æ³¨é‡Š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemVo<span class="token punctuation">.</span>SkuItemSaleAttrVo</span><span class="token punctuation">&gt;</span></span> skuItemSaleAttrVos <span class="token operator">=</span> skuSaleAttrValueService<span class="token punctuation">.</span><span class="token function">getSaleAttrsBySpuId</span><span class="token punctuation">(</span>spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
skuItemVo<span class="token punctuation">.</span><span class="token function">setSaleAttr</span><span class="token punctuation">(</span>skuItemSaleAttrVos<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.SkuSaleAttrValueService</code>æ¥å£é‡Œæ·»åŠ <code>getSaleAttrsBySpuId</code>æŠ½è±¡æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemVo<span class="token punctuation">.</span>SkuItemSaleAttrVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSaleAttrsBySpuId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.7.1.png" alt="image-20220802105245574" tabindex="0" loading="lazy"><figcaption>image-20220802105245574</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.impl.SkuSaleAttrValueServiceImpl</code>ç±»é‡Œå®ç°<code>getSaleAttrsBySpuId</code>æŠ½è±¡æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemVo<span class="token punctuation">.</span>SkuItemSaleAttrVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSaleAttrsBySpuId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> spuId<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getBaseMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSaleAttrsBySpuId</span><span class="token punctuation">(</span>spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.7.2.png" alt="image-20220802105432422" tabindex="0" loading="lazy"><figcaption>image-20220802105432422</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.dao.SkuSaleAttrValueDao</code>æ¥å£é‡Œæ·»åŠ <code>getSaleAttrsBySpuId</code>æŠ½è±¡æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemVo<span class="token punctuation">.</span>SkuItemSaleAttrVo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getSaleAttrsBySpuId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;spuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> spuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.7.3.gif" alt="GIF 2022-8-2 10-56-24" tabindex="0" loading="lazy"><figcaption>GIF 2022-8-2 10-56-24</figcaption></figure><h5 id="_8ã€ç¼–å†™sql" tabindex="-1"><a class="header-anchor" href="#_8ã€ç¼–å†™sql" aria-hidden="true">#</a> 8ã€ç¼–å†™sql</h5><p>æ ¹æ®<code>spu_id</code>åœ¨<code>pms_sku_info</code>è¡¨é‡Œå¯ä»¥æŸ¥å‡ºå¯¹åº”çš„<code>sku_id</code></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select * from pms_sku_info where spu_id=1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.8.1.png" alt="image-20220802110511143" tabindex="0" loading="lazy"><figcaption>image-20220802110511143</figcaption></figure><p>æ ¹æ®<code>sku_id</code>å¯ä»¥åœ¨<code>pms_sku_sale_attr_value</code>è¡¨é‡ŒæŸ¥å‡ºå¯¹åº”çš„<code>attr_id</code>å’Œ<code>attr_value</code></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select pssav.attr_id attr_id,pssav.attr_value attr_value
from pms_sku_info info
left join pms_sku_sale_attr_value pssav on info.sku_id = pssav.sku_id
where info.spu_id=1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.8.2.png" alt="image-20220802110549989" tabindex="0" loading="lazy"><figcaption>image-20220802110549989</figcaption></figure><p>å¯ä»¥å¯¹<code>pssav.attr_id</code>å’Œ<code>pssav.attr_name</code>è¿›è¡Œåˆ†ç»„ï¼Œ<code>group_concat(distinct pssav.attr_value)</code>å‡½æ•°å¯ä»¥å°†æœªåˆ†ç»„çš„æ•°æ®ç”¨<code>,</code>è¿æ¥èµ·æ¥</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select pssav.attr_id attr_id,pssav.attr_name attr_name, group_concat(distinct pssav.attr_value) attr_value
from pms_sku_info info
left join pms_sku_sale_attr_value pssav on info.sku_id = pssav.sku_id
where info.spu_id=1
group by pssav.attr_id,pssav.attr_name
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.8.3.png" alt="image-20220802110623514" tabindex="0" loading="lazy"><figcaption>image-20220802110623514</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/mapper/product/SkuSaleAttrValueDao.xml</code>æ–‡ä»¶é‡Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼ˆå†…éƒ¨ç±»å‰é¢ä½¿ç”¨<code>$</code>è¿æ¥ï¼Œè€Œä¸æ˜¯<code>.</code>ï¼‰</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>&lt;resultMap id=&quot;skuItemSaleAttrVo&quot; type=&quot;com.atguigu.gulimall.product.vo.SkuItemVo$SkuItemSaleAttrVo&quot;&gt;
    &lt;id property=&quot;attrId&quot; column=&quot;attr_id&quot;/&gt;
    &lt;result property=&quot;attrName&quot; column=&quot;attr_name&quot;/&gt;
    &lt;collection property=&quot;attrValues&quot; ofType=&quot;java.lang.String&quot;&gt;
        &lt;result column=&quot;attr_value&quot;/&gt;
    &lt;/collection&gt;
&lt;/resultMap&gt;

&lt;select id=&quot;getSaleAttrsBySpuId&quot; resultMap=&quot;skuItemSaleAttrVo&quot;&gt;
    select pssav.attr_id attr_id,pssav.attr_name attr_name,pssav.attr_value attr_value
    from gulimall_pms.pms_sku_info info
             left join gulimall_pms.pms_sku_sale_attr_value pssav on info.sku_id = pssav.sku_id
    where info.spu_id=#{spuId};
&lt;/select&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.8.4.png" alt="image-20220802195353614" tabindex="0" loading="lazy"><figcaption>image-20220802195353614</figcaption></figure><h5 id="_9ã€æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_9ã€æµ‹è¯•" aria-hidden="true">#</a> 9ã€æµ‹è¯•</h5><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.GulimallProductApplicationTests</code>æµ‹è¯•ç±»é‡Œæ·»åŠ å¦‚ä¸‹ä»£ç ã€‚ç„¶åæ‰§è¡Œæµ‹è¯•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token class-name">SkuSaleAttrValueService</span> skuSaleAttrValueService<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">skuSaleAttrValueServiceTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>skuSaleAttrValueService<span class="token punctuation">.</span><span class="token function">getSaleAttrsBySpuId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ§åˆ¶å°å·²æ­£ç¡®è¾“å‡ºå¦‚ä¸‹æ•°æ®ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">[</span>SkuItemVo.SkuItemSaleAttrVo(attrId=<span class="token number">4</span><span class="token punctuation">,</span> attrName=é¢œè‰²<span class="token punctuation">,</span> attrValues=<span class="token punctuation">[</span>æ˜Ÿæ²³é“¶<span class="token punctuation">,</span> äº®é»‘è‰²<span class="token punctuation">,</span> ç¿¡å†·ç¿ <span class="token punctuation">,</span> ç½—å…°ç´«<span class="token punctuation">]</span>)<span class="token punctuation">,</span> SkuItemVo.SkuItemSaleAttrVo(attrId=<span class="token number">11</span><span class="token punctuation">,</span> attrName=ç‰ˆæœ¬<span class="token punctuation">,</span> attrValues=<span class="token punctuation">[</span>8GB+128GB<span class="token punctuation">,</span> 8GB+256GB<span class="token punctuation">]</span>)<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.9.png" alt="image-20220802112111881" tabindex="0" loading="lazy"><figcaption>image-20220802112111881</figcaption></figure><h5 id="_10ã€åœ¨modelé‡Œæ·»åŠ æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_10ã€åœ¨modelé‡Œæ·»åŠ æ•°æ®" aria-hidden="true">#</a> 10ã€åœ¨<code>Model</code>é‡Œæ·»åŠ æ•°æ®</h5><p>ä¿®æ”¹<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.web.ItemController</code>ç±»çš„<code>skuItem</code>æ–¹æ³•</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å±•ç¤ºskuçš„è¯¦æƒ…
 * <span class="token keyword">@param</span> <span class="token parameter">skuId</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{skuId}.html&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">skuItem</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment">//System.out.println(&quot;å‡†å¤‡æŸ¥è¯¢&quot; + skuId + &quot;çš„è¯¦æƒ…&quot;);</span>
    <span class="token class-name">SkuItemVo</span> vo <span class="token operator">=</span> skuInfoService<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span>vo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.2.10.png" alt="image-20220802112435047" tabindex="0" loading="lazy"><figcaption>image-20220802112435047</figcaption></figure><h4 id="_3ã€å±•ç¤ºæ•°æ®" tabindex="-1"><a class="header-anchor" href="#_3ã€å±•ç¤ºæ•°æ®" aria-hidden="true">#</a> 3ã€å±•ç¤ºæ•°æ®</h4><h5 id="_1ã€ä¿®æ”¹æ ‡é¢˜ã€ä»·æ ¼ã€å¤§å›¾" tabindex="-1"><a class="header-anchor" href="#_1ã€ä¿®æ”¹æ ‡é¢˜ã€ä»·æ ¼ã€å¤§å›¾" aria-hidden="true">#</a> 1ã€ä¿®æ”¹æ ‡é¢˜ã€ä»·æ ¼ã€å¤§å›¾</h5><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œçš„<code>&lt;html&gt;</code>æ ‡ç­¾ä¸Šæ·»åŠ <code>xmlns:th=&quot;http://www.thymeleaf.org&quot;</code>å±æ€§ï¼Œå¼•å…¥<code>thymeleaf</code></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.thymeleaf.org<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.1.1.png" alt="image-20220802150449195" tabindex="0" loading="lazy"><figcaption>image-20220802150449195</figcaption></figure><p>åœ¨<code>http://item.gulimall.com/9.html</code>é¡µé¢é‡Œï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½åˆ°<code>åä¸º HUAWEI Mate 10 6GB+128GB äº®é»‘è‰² ç§»åŠ¨è”é€šç”µä¿¡4Gæ‰‹æœº åŒå¡åŒå¾…</code>ï¼Œå¤åˆ¶<code>åä¸º HUAWEI Mate 10 6GB+128GB äº®é»‘è‰² ç§»åŠ¨è”é€šç”µä¿¡4Gæ‰‹æœº åŒå¡åŒå¾…</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.1.2.png" alt="image-20220804205800473" tabindex="0" loading="lazy"><figcaption>image-20220804205800473</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œæœç´¢<code>åä¸º HUAWEI Mate 10 6GB+128GB äº®é»‘è‰² ç§»åŠ¨è”é€šç”µä¿¡4Gæ‰‹æœº åŒå¡åŒå¾…</code>ï¼Œåœ¨<code>class=&quot;box-name&quot;</code>çš„<code>&lt;div&gt;</code>é‡Œæ·»åŠ <code>th:text=&quot;\${item.info.skuTitle}&quot;</code>å±æ€§ï¼Œåœ¨<code>class=&quot;box-hide&quot;</code>çš„<code>&lt;div&gt;</code>é‡Œæ·»åŠ <code> th:text=&quot;\${item.info.skuSubtitle}&quot;</code>å±æ€§ï¼Œåˆ é™¤<code>class=&quot;box-hide&quot;</code>çš„<code>&lt;div&gt;</code>é‡Œ<code>&lt;u&gt;&lt;/u&gt;</code>é‡Œçš„å†…å®¹</p><p>ä¿®æ”¹<code>ä¸»æ ‡é¢˜</code>å’Œ<code>å‰¯æ ‡é¢˜</code>ï¼Œåˆ é™¤<code>ä¼˜æƒ ä¿¡æ¯è·³è½¬</code></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box-name<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${item.info.skuTitle}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   åä¸º HUAWEI Mate 10 6GB+128GB äº®é»‘è‰² ç§»åŠ¨è”é€šç”µä¿¡4Gæ‰‹æœº åŒå¡åŒå¾…
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box-hide<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${item.info.skuSubtitle}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>é¢„è®¢ç”¨æˆ·é¢„è®¡11æœˆ30æ—¥å·¦å³é™†ç»­å‘è´§ï¼éº’éºŸ970èŠ¯ç‰‡ï¼AIæ™ºèƒ½æ‹ç…§ï¼
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>u</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.1.3.png" alt="image-20220802150741326" tabindex="0" loading="lazy"><figcaption>image-20220802150741326</figcaption></figure><p>åœ¨<code>http://item.gulimall.com/9.html</code>é¡µé¢é‡Œï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½åˆ°<code>å¤§å›¾</code>ï¼Œå¤åˆ¶<code>probox</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.1.4.png" alt="image-20220802150947928" tabindex="0" loading="lazy"><figcaption>image-20220802150947928</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œæœç´¢<code>probox</code>ï¼Œåœ¨<code> class=&quot;probox&quot;</code>çš„<code>&lt;div&gt;</code>é‡Œçš„<code>&lt;img&gt;</code>æ ‡ç­¾ä¸Šæ·»åŠ <code>th:src=&quot;\${item.info.skuDefaultImg}&quot;</code>å±æ€§ï¼Œåœ¨<code>class=&quot;showbox&quot;</code>çš„<code>&lt;div&gt;</code>é‡Œçš„<code>&lt;img&gt;</code>æ ‡ç­¾ä¸Šæ·»åŠ <code>th:src=&quot;\${item.info.skuDefaultImg}&quot;</code>å±æ€§</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>imgbox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>probox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!--å•†å“å¤§å›¾å›¾ç‰‡--&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${item.info.skuDefaultImg}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hoverbox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showbox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token comment">&lt;!--å¤§å›¾æ”¾å¤§åçš„å›¾ç‰‡ --&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${item.info.skuDefaultImg}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.1.5.png" alt="image-20220802151259345" tabindex="0" loading="lazy"><figcaption>image-20220802151259345</figcaption></figure><p>åœ¨<code>http://item.gulimall.com/9.html</code>é¡µé¢é‡Œï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½åˆ°<code>4499.00</code>ï¼Œå¤åˆ¶<code>4499.00</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.1.6.png" alt="image-20220802151427909" tabindex="0" loading="lazy"><figcaption>image-20220802151427909</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œæœç´¢<code>4499.00</code>ï¼Œåœ¨è¯¥<code>&lt;span&gt;</code>æ ‡ç­¾é‡Œæ·»åŠ <code>th:text=&quot;\${item.info.price}&quot;</code>å±æ€§</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${item.info.price}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>4499.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.1.7.png" alt="image-20220802153343528" tabindex="0" loading="lazy"><figcaption>image-20220802153343528</figcaption></figure><p>é‡å¯<code>GulimallProductApplication</code>æœåŠ¡ï¼Œåˆ·æ–°<code>http://item.gulimall.com/9.html</code>é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°<code>ä¸»æ ‡é¢˜</code>ã€<code>å‰¯æ ‡é¢˜</code>ã€<code>ä»·æ ¼</code>ã€<code>å¤§å›¾</code>éƒ½å·²ç»åŠ¨æ€æ˜¾ç¤ºå‡ºæ¥äº†,ä½†æ˜¯ä»·æ ¼æ˜¾ç¤ºäº†å°æ•°ç‚¹å6ä½</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.1.8.png" alt="image-20220802153454603" tabindex="0" loading="lazy"><figcaption>image-20220802153454603</figcaption></figure><p>åœ¨<code>http://search.gulimall.com/list.html</code>é¡µé¢é‡Œæœç´¢<code>åä¸º</code>ï¼Œéšä¾¿ç‚¹å‡»ä¸€ä¸ªå•†å“ï¼Œå¯ä»¥çœ‹åˆ°åœ¨<code>http://item.gulimall.com/1.html</code>é¡µé¢é‡Œå·²åŠ¨æ€åˆ·æ–°å‡ºè¿™äº›æ•°æ®ï¼Œä½†æ˜¯ä»·æ ¼ç²¾ç¡®åˆ°äº†å°æ•°ç‚¹åä¸‰ä½</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.1.9.gif" alt="GIF 2022-8-2 15-36-59" tabindex="0" loading="lazy"><figcaption>GIF 2022-8-2 15-36-59</figcaption></figure><p>åœ¨<code>thymeleaf</code>é‡Œï¼Œæœ‰ä¸€ä¸ª<code>#numbers.formatDecimal(final Number target, final Integer minIntegerDigits, final Integer decimalDigits)</code>æ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®š<code>æœ€å°æ•´æ•°ä½æ•°</code>å’Œ<code>å°æ•°ä¸ªæ•°</code></p><p>å°†åˆšåˆšçš„<code>&lt;span th:text=&quot;\${item.info.price}&quot;&gt;4499.00&lt;/span&gt;</code>ä¿®æ”¹ä¸ºå¦‚ä¸‹ä»£ç </p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${#numbers.formatDecimal(item.info.price,1,2)}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>4499.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.1.10.png" alt="image-20220802154113758" tabindex="0" loading="lazy"><figcaption>image-20220802154113758</figcaption></figure><p>ç‚¹å‡»<code>Build</code> -&gt; <code>Recompile &quot;item.html&#39;</code> æˆ–æŒ‰å¿«æ·é”®<code>Ctrl+ Shift+F9</code>ï¼Œé‡æ–°ç¼–è¯‘å½“å‰é™æ€æ–‡ä»¶</p><p>æ‰“å¼€<code>http://item.gulimall.com/7.html</code>é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°ä»·æ ¼å·²åªæ˜¾ç¤ºå°æ•°ç‚¹åä¸¤ä½äº†</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.1.11.png" alt="image-20220802154150273" tabindex="0" loading="lazy"><figcaption>image-20220802154150273</figcaption></figure><h5 id="_2ã€ä¿®æ”¹é”€å”®å±æ€§ã€å°å›¾" tabindex="-1"><a class="header-anchor" href="#_2ã€ä¿®æ”¹é”€å”®å±æ€§ã€å°å›¾" aria-hidden="true">#</a> 2ã€ä¿®æ”¹é”€å”®å±æ€§ã€å°å›¾</h5><p>åœ¨<code>http://item.gulimall.com/7.html</code>é¡µé¢é‡Œï¼Œï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½åˆ°<code>æ— è´§ï¼Œæ­¤å•†å“æš‚æ—¶å”®å®Œ</code>ï¼Œå¤åˆ¶<code>æ— è´§ï¼Œæ­¤å•†å“æš‚æ—¶å”®å®Œ</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.2.1.png" alt="image-20220802154434635" tabindex="0" loading="lazy"><figcaption>image-20220802154434635</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.vo.SkuItemVo</code>ç±»é‡Œæ·»åŠ <code>hasStock</code>å­—æ®µï¼Œç”¨æ¥æŒ‡æ˜æ˜¯å¦æœ‰è´§</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ˜¯å¦æœ‰è´§
 */</span>
<span class="token keyword">boolean</span> hasStock <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.2.2.png" alt="image-20220802154552565" tabindex="0" loading="lazy"><figcaption>image-20220802154552565</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œæœç´¢<code>æ— è´§ï¼Œæ­¤å•†å“æš‚æ—¶å”®å®Œ</code>ï¼Œåœ¨æ­¤<code>&lt;span&gt;</code>æ ‡ç­¾é‡Œæ·»åŠ <code>th:text</code>å±æ€§</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${item.hasStock?&#39;æœ‰è´§&#39;:&#39;æ— è´§ï¼Œæ­¤å•†å“æš‚æ—¶å”®å®Œ&#39;}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>æœ‰è´§<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.2.3.png" alt="image-20220802155031124" tabindex="0" loading="lazy"><figcaption>image-20220802155031124</figcaption></figure><p>ç‚¹å‡»<code>Build</code> -&gt; <code>Recompile &quot;item.html&#39;</code> æˆ–æŒ‰å¿«æ·é”®<code>Ctrl+ Shift+F9</code>ï¼Œé‡æ–°ç¼–è¯‘å½“å‰é™æ€æ–‡ä»¶</p><p>åˆ·æ–°<code>http://item.gulimall.com/7.html</code>é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æ˜¾ç¤º<code>æœ‰è´§</code>äº†</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.2.4.png" alt="image-20220802155138616" tabindex="0" loading="lazy"><figcaption>image-20220802155138616</figcaption></figure><p>åœ¨<code>http://item.gulimall.com/7.html</code>é¡µé¢é‡Œï¼Œï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½åˆ°<code>é€‰æ‹©é¢œè‰²</code>ï¼Œå¤åˆ¶<code>é€‰æ‹©é¢œè‰²</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.2.5.png" alt="image-20220802155237628" tabindex="0" loading="lazy"><figcaption>image-20220802155237628</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œæœç´¢<code>é€‰æ‹©é¢œè‰²</code>ï¼Œåªä¿ç•™ä¸€ä¸ª<code>class=&quot;box-attr clear&quot;</code>çš„<code>&lt;div&gt;</code>ï¼Œåˆ æ‰å…¶ä½™åŒçº§<code>&lt;div&gt;</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.2.6.png" alt="image-20220802155328193" tabindex="0" loading="lazy"><figcaption>image-20220802155328193</figcaption></figure><p>å°†å…¶ä¿®æ”¹ä¸ºå¦‚ä¸‹ä»£ç </p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box-attr-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box-attr clear<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr : \${item.saleAttr}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">&gt;</span></span>é€‰æ‹©[[\${attr.attrName}]]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>val : \${attr.attrValues}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--&lt;img src=&quot;/static/item/img/59ddfcb1Nc3edb8f1.jpg&quot; /&gt;--&gt;</span>
               [[\${val}]]
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.2.7.png" alt="image-20220802162459901" tabindex="0" loading="lazy"><figcaption>image-20220802162459901</figcaption></figure><p>åœ¨<code>http://item.gulimall.com/3.html</code>é¡µé¢é‡Œï¼Œï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½åˆ°å°å›¾ç‰‡ï¼Œå¤åˆ¶<code>box-lh-one</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.2.8.png" alt="image-20220813093708919" tabindex="0" loading="lazy"><figcaption>image-20220813093708919</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œæœç´¢<code>box-lh-one</code>ï¼Œåªä¿ç•™ä¸€ä¸ª<code>class=&quot;box-attr clear&quot;</code>çš„<code>&lt;div&gt;</code></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box-lh-one<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image : \${item.images}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${image.imgUrl}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.2.9.png" alt="image-20220802160025226" tabindex="0" loading="lazy"><figcaption>image-20220802160025226</figcaption></figure><p>ç‚¹å‡»<code>Build</code> -&gt; <code>Recompile &quot;item.html&#39;</code> æˆ–æŒ‰å¿«æ·é”®<code>Ctrl+ Shift+F9</code>ï¼Œé‡æ–°ç¼–è¯‘å½“å‰é™æ€æ–‡ä»¶</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.2.10.png" alt="image-20220802160751563" tabindex="0" loading="lazy"><figcaption>image-20220802160751563</figcaption></figure><p>ä½†å›¾ç‰‡æœ‰å¯èƒ½ä¸ºç©ºï¼Œå› æ­¤éœ€è¦åŠ ä¸€ä¸ªåˆ¤æ–­</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box-lh-one<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image : \${item.images}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${!#strings.isEmpty(image.imgUrl)}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${image.imgUrl}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.2.11.png" alt="image-20220802160526179" tabindex="0" loading="lazy"><figcaption>image-20220802160526179</figcaption></figure><h5 id="_3ã€ä¿®æ”¹å•†å“ä»‹ç»ã€è§„æ ¼ä¸åŒ…è£…" tabindex="-1"><a class="header-anchor" href="#_3ã€ä¿®æ”¹å•†å“ä»‹ç»ã€è§„æ ¼ä¸åŒ…è£…" aria-hidden="true">#</a> 3ã€ä¿®æ”¹å•†å“ä»‹ç»ã€è§„æ ¼ä¸åŒ…è£…</h5><p>åœ¨<code>http://item.gulimall.com/3.html</code>é¡µé¢é‡Œï¼Œï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½åˆ°å•†å“è¯¦æƒ…çš„å›¾ç‰‡ï¼Œå¤åˆ¶<code>xiaoguo</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.1.png" alt="image-20220802162621276" tabindex="0" loading="lazy"><figcaption>image-20220802162621276</figcaption></figure><p>æŠŠ<code>class=&quot;xiaoguo&quot;</code>çš„<code>&lt;img&gt;</code>æ ‡ç­¾çš„ä¸Šé¢<code>&lt;p&gt;</code>æ ‡ç­¾å’Œ<code>&lt;table&gt;</code>æ ‡ç­¾æ³¨é‡Šæ‰</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;p&gt;
    &lt;a href=&quot;#&quot;&gt;å“ç‰Œ:åä¸ºï¼ˆHUAWEIï¼‰&lt;/a&gt;
&lt;/p&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŠŠ<code>class=&quot;xiaoguo&quot;</code>çš„<code>&lt;img&gt;</code>æ ‡ç­¾ä¿®æ”¹ä¸ºå¦‚ä¸‹ä»£ç </p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xiaoguo<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>desp : \${#strings.listSplit(item.desp.decript,&#39;,&#39;)}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${desp}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.2.png" alt="image-20220802163541409" tabindex="0" loading="lazy"><figcaption>image-20220802163541409</figcaption></figure><p>åœ¨<code>http://item.gulimall.com/3.html</code>é¡µé¢é‡Œï¼Œï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½åˆ°<code>è§„æ ¼ä¸åŒ…è£…</code>ï¼Œå¤åˆ¶<code>è§„æ ¼ä¸åŒ…è£…</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.3.png" alt="image-20220802164153238" tabindex="0" loading="lazy"><figcaption>image-20220802164153238</figcaption></figure><p>å°†<code>è§„æ ¼ä¸åŒ…è£…</code>æ‰€åœ¨çš„<code>&lt;a&gt;</code>æ ‡ç­¾çš„<code>href=&quot;##&quot;</code>å±æ€§åˆ æ‰ï¼Œå¹¶åˆ æ‰åŒçº§å…¶ä»–<code>&lt;li&gt;</code>æ ‡ç­¾é‡Œçš„<code>&lt;a&gt;</code>æ ‡ç­¾é‡Œçš„<code>href=&quot;#&quot;</code>å±æ€§</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shopjieshao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jieshoa<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">background</span><span class="token punctuation">:</span> #e4393c<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>å•†å“ä»‹ç»<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>baozhuang<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token punctuation">&gt;</span></span>è§„æ ¼ä¸åŒ…è£…<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>baozhang<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token punctuation">&gt;</span></span>å”®åä¿éšœ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pingjia<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token punctuation">&gt;</span></span>å•†å“è¯„ä»·(4ä¸‡+)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shuoming<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token punctuation">&gt;</span></span>é¢„çº¦è¯´æ˜<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.4.png" alt="image-20220802164419137" tabindex="0" loading="lazy"><figcaption>image-20220802164419137</figcaption></figure><p>é‡å¯<code>GulimallProductApplication</code>æœåŠ¡ï¼Œåˆ·æ–°<code>http://item.gulimall.com/3.html</code>é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°ç‚¹å‡»<code>å•†å“ä»‹ç»</code>ã€<code>è§„æ ¼ä¸åŒ…è£…</code>ã€<code>å”®åä¿éšœ</code>ã€<code>å•†å“è¯„ä»·(4ä¸‡+)</code>ã€<code>é¢„çº¦è¯´æ˜</code>éƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå°±æ˜¯é¼ æ ‡æ ·å¼æœ‰ç‚¹é—®é¢˜</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.5.gif" alt="GIF 2022-8-2 16-45-37" tabindex="0" loading="lazy"><figcaption>GIF 2022-8-2 16-45-37</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶çš„<code>&lt;head&gt;</code>æ ‡ç­¾é‡Œä¿®æ”¹é¼ æ ‡æ ·å¼</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span>  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
   <span class="token selector">a:hover</span><span class="token punctuation">{</span>
      <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.6.png" alt="image-20220802165345938" tabindex="0" loading="lazy"><figcaption>image-20220802165345938</figcaption></figure><p>ç‚¹å‡»<code>Build</code> -&gt; <code>Recompile &quot;item.html&#39;</code> æˆ–æŒ‰å¿«æ·é”®<code>Ctrl+ Shift+F9</code>ï¼Œé‡æ–°ç¼–è¯‘å½“å‰é™æ€æ–‡ä»¶</p><p>åˆ·æ–°<code>http://item.gulimall.com/3.html</code>é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°é¼ æ ‡æ ·å¼å·²ç»æ­£å¸¸äº†</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.7.gif" alt="GIF 2022-8-2 16-54-19" tabindex="0" loading="lazy"><figcaption>GIF 2022-8-2 16-54-19</figcaption></figure><p>åœ¨<code>http://item.gulimall.com/3.html</code>é¡µé¢é‡Œï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½åˆ°å•†å“ä»‹ç»æœ€ä¸‹é¢çš„è§„æ ¼ä»‹ç»ï¼Œå¤åˆ¶<code>guiGebox guiGebox1</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.8.png" alt="image-20220802170417765" tabindex="0" loading="lazy"><figcaption>image-20220802170417765</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œæœç´¢<code>guiGebox guiGebox1</code>ï¼Œåªä¿ç•™é‡Œé¢ç¬¬ä¸€ä¸ª<code>class=&quot;guiGe&quot;</code>çš„<code>&lt;div&gt;</code>ï¼Œåˆ æ‰å…¶ä»–çš„<code>class=&quot;guiGe&quot;</code>çš„<code>&lt;div&gt;</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.9.png" alt="image-20220802170547221" tabindex="0" loading="lazy"><figcaption>image-20220802170547221</figcaption></figure><p>å°†å…¶ä¿®æ”¹ä¸ºå¦‚ä¸‹æ ·å¼</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>guiGebox guiGebox1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>guiGe<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>guige : \${item.groupAttrs}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${guige.groupName}<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> left</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>ä¸»ä½“<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr:\${guige.attrs}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${attr.attrName}<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> left</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>å“ç‰Œ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${attr.attrValue}<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> left</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>åä¸º(HUAWEI)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>package-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>åŒ…è£…æ¸…å•<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>æ‰‹æœºï¼ˆå«å†…ç½®ç”µæ± ï¼‰ X 1ã€5Aå¤§ç”µæµåä¸ºSuperChargeå……ç”µå™¨X 1ã€5A USBæ•°æ®çº¿ X 1ã€åŠå…¥è€³å¼çº¿æ§è€³æœº X 1ã€å¿«é€ŸæŒ‡å—X 1ã€ä¸‰åŒ…å‡­è¯ X 1ã€å–å¡é’ˆ X 1ã€ä¿æŠ¤å£³ X 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.10.png" alt="image-20220802172130594" tabindex="0" loading="lazy"><figcaption>image-20220802172130594</figcaption></figure><p>ç‚¹å‡»<code>Build</code> -&gt; <code>Recompile &quot;item.html&#39;</code> æˆ–æŒ‰å¿«æ·é”®<code>Ctrl+ Shift+F9</code>ï¼Œé‡æ–°ç¼–è¯‘å½“å‰é™æ€æ–‡ä»¶</p><p>åˆ·æ–°<code>http://item.gulimall.com/3.html</code>é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°å•†å“ä»‹ç»é‡Œçš„é”€å”®å±æ€§å·²ç»æ˜¾ç¤ºå‡ºæ¥äº†</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.11.png" alt="image-20220802172158517" tabindex="0" loading="lazy"><figcaption>image-20220802172158517</figcaption></figure><p>åœ¨<code>http://item.gulimall.com/3.html</code>é¡µé¢é‡Œï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½åˆ°è§„æ ¼ä¸åŒ…è£…é‡Œçš„é”€å”®å±æ€§ï¼Œå¤åˆ¶<code>guiGebox</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.12.png" alt="image-20220802163735252" tabindex="0" loading="lazy"><figcaption>image-20220802163735252</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œæœç´¢<code>guiGebox</code>ï¼Œåªä¿ç•™é‡Œé¢ç¬¬ä¸€ä¸ª<code>class=&quot;guiGe&quot;</code>çš„<code>&lt;div&gt;</code>ï¼Œåˆ æ‰å…¶ä»–çš„<code>class=&quot;guiGe&quot;</code>çš„<code>&lt;div&gt;</code></p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.13.png" alt="image-20220802185536572" tabindex="0" loading="lazy"><figcaption>image-20220802185536572</figcaption></figure><p>å°†å…¶ä¿®æ”¹ä¸ºå¦‚ä¸‹æ ·å¼</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>guiGebox<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>guiGe<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>guige : \${item.groupAttrs}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${guige.groupName}<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> left</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>ä¸»ä½“<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr:\${guige.attrs}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${attr.attrName}<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> left</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>å“ç‰Œ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${attr.attrValue}<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> left</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>åä¸º(HUAWEI)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>package-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>åŒ…è£…æ¸…å•<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>æ‰‹æœºï¼ˆå«å†…ç½®ç”µæ± ï¼‰ X 1ã€5Aå¤§ç”µæµåä¸ºSuperChargeå……ç”µå™¨X 1ã€5A USBæ•°æ®çº¿ X 1ã€åŠå…¥è€³å¼çº¿æ§è€³æœº X 1ã€å¿«é€ŸæŒ‡å—X 1ã€ä¸‰åŒ…å‡­è¯ X 1ã€å–å¡é’ˆ X 1ã€ä¿æŠ¤å£³ X 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.14.png" alt="image-20220802190210444" tabindex="0" loading="lazy"><figcaption>image-20220802190210444</figcaption></figure><p>ç‚¹å‡»<code>Build</code> -&gt; <code>Recompile &quot;item.html&#39;</code> æˆ–æŒ‰å¿«æ·é”®<code>Ctrl+ Shift+F9</code>ï¼Œé‡æ–°ç¼–è¯‘å½“å‰é™æ€æ–‡ä»¶</p><p>åˆ·æ–°<code>http://item.gulimall.com/3.html</code>é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°è§„æ ¼ä¸åŒ…è£…é‡Œçš„é”€å”®å±æ€§å·²ç»æ˜¾ç¤ºå‡ºæ¥äº†</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.15.png" alt="image-20220802190954869" tabindex="0" loading="lazy"><figcaption>image-20220802190954869</figcaption></figure><p>ä½†æ˜¯æ­¤æ—¶çš„<code>å•†å“ä»‹ç»</code>é‡Œçš„é”€å”®å±æ€§ç«Ÿç„¶æ˜¾ç¤ºäº†ä¸¤æ¬¡ä¸€æ¨¡ä¸€æ ·çš„æ•°æ®</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.16.png" alt="GIF 2022-8-2 19-12-48" tabindex="0" loading="lazy"><figcaption>GIF 2022-8-2 19-12-48</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œæœç´¢<code>guiGebox guiGebox1</code>ï¼Œæ³¨é‡Šæ‰è¯¥<code>class=&quot;guiGebox guiGebox1&quot;</code>çš„<code>&lt;div&gt;</code>æ ‡ç­¾</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.17.png" alt="image-20220802191412216" tabindex="0" loading="lazy"><figcaption>image-20220802191412216</figcaption></figure><p>ç‚¹å‡»<code>Build</code> -&gt; <code>Recompile &#39;item.html&#39;</code> æˆ–æŒ‰å¿«æ·é”®<code>Ctrl+ Shift+F9</code>ï¼Œé‡æ–°ç¼–è¯‘å½“å‰é™æ€æ–‡ä»¶</p><p>åˆ·æ–°<code>http://item.gulimall.com/3.html</code>é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ¬¡å°±åªæ˜¾ç¤ºä¸€æ¬¡äº†</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.3.3.18.png" alt="GIF 2022-8-2 19-15-17" tabindex="0" loading="lazy"><figcaption>GIF 2022-8-2 19-15-17</figcaption></figure><h4 id="_4ã€ç‚¹å‡»å¯é€‰å‚æ•°è·³è½¬åˆ°æŒ‡å®šskué¡µé¢" tabindex="-1"><a class="header-anchor" href="#_4ã€ç‚¹å‡»å¯é€‰å‚æ•°è·³è½¬åˆ°æŒ‡å®šskué¡µé¢" aria-hidden="true">#</a> 4ã€ç‚¹å‡»å¯é€‰å‚æ•°è·³è½¬åˆ°æŒ‡å®šskué¡µé¢</h4><h5 id="_1ã€ç¼–å†™sql" tabindex="-1"><a class="header-anchor" href="#_1ã€ç¼–å†™sql" aria-hidden="true">#</a> 1ã€ç¼–å†™<code>sql</code></h5><p>å½“ç‚¹å‡»æŸä¸€ä¸ªå…·ä½“çš„<code>é¢œè‰²</code>æˆ–<code>å†…å­˜å®¹é‡</code>ç­‰æ—¶ï¼Œå¯ä»¥æŸ¥è¯¢å“ªäº›<code>sku</code>æœ‰è¿™ä¸ªå…·ä½“çš„<code>é¢œè‰²</code>æˆ–<code>å†…å­˜å®¹é‡</code>ã€‚ä¿®æ”¹ä¸Šæ¬¡å†™çš„æŸ¥è¯¢è¯¥<code>sku</code>å¯é€‰å‚æ•°çš„sqlï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹<code>sql</code>ï¼Œå¤šæŸ¥è¯¢ä¸€ä¸ª<code>pssav.attr_name</code></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select pssav.sku_id,pssav.attr_id attr_id,pssav.attr_name,pssav.attr_value attr_value
from pms_sku_info info
left join pms_sku_sale_attr_value pssav on info.sku_id = pssav.sku_id
where info.spu_id=1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.1.1.png" alt="image-20220802192144097" tabindex="0" loading="lazy"><figcaption>image-20220802192144097</figcaption></figure><p>å¯ä»¥æ ¹æ®<code>spu_id</code>æŸ¥è¯¢è¯¥å•†å“çš„æ‰€æœ‰å¯é€‰å‚æ•°çš„æ‰€æœ‰å…·ä½“å±æ€§å€¼ï¼Œç„¶ååˆ¤æ–­å“ªäº›<code>sku</code>æœ‰è¯¥å±æ€§å€¼ã€‚å½“ç‚¹å‡»æŸä¸€ä¸ªå¯é€‰å‚æ•°çš„å…·ä½“å±æ€§å€¼æ—¶ï¼Œä¿®æ”¹è¯¥å¯é€‰å‚æ•°çš„å±æ€§å€¼ï¼Œå…¶ä»–å¯é€‰å‚æ•°çš„å…·ä½“å±æ€§å€¼ä¸å˜ï¼Œå†æŸ¥æ‰¾<code>âˆ©</code>äº¤é›†ï¼Œåˆ¤æ–­è¦é€‰æ‹©çš„<code>sku</code>ï¼Œè¦æ˜¾ç¤ºçš„<code>sku</code>å°±æ˜¯æ»¡è¶³æ‰€æœ‰å¯é€‰å‚æ•°çš„æŸä¸€å…·ä½“å±æ€§å€¼çš„<code>sku</code>æ±‚<code>âˆ©</code>äº¤é›†ã€‚(eg: å½“å‰<code>sku</code>çš„å¯é€‰å‚æ•°ä¿¡æ¯ä¸ºï¼š<code>é¢œè‰²=äº®é»‘è‰²</code>(å…·æœ‰è¯¥å¯é€‰å‚æ•°çš„å±æ€§å€¼çš„<code>sku</code>æœ‰<code>3,4</code>)ã€<code>ç‰ˆæœ¬=8GB+128GB</code>(å…·æœ‰è¯¥å¯é€‰å‚æ•°çš„å±æ€§å€¼çš„<code>sku</code>æœ‰<code>1,3,5,7</code>)ã€‚å› æ­¤å¦‚æœç‚¹å‡»<code>é¢œè‰²=ç½—å…°ç´«</code>å°±éœ€è¦åˆ¤æ–­å±æ€§å…·æœ‰<code>é¢œè‰²=ç½—å…°ç´«</code>(sku=7,8)å’Œ<code>ç‰ˆæœ¬=8GB+128GB</code>(sku=1,3,5,7)çš„<code>sku</code> ,å°†æ»¡è¶³è¿™äº›å±æ€§å€¼çš„<code>sku</code>æ±‚äº¤é›†å°±ä¸º<code>7</code>ï¼Œå› æ­¤åº”è¯¥è·³è½¬åˆ°<code>sku_id</code>=<code>7</code>çš„å•†å“é¡µ)</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select pssav.attr_id attr_id,pssav.attr_name attr_name,pssav.attr_value attr_value,
       group_concat(distinct pssav.sku_id) sku_id
from pms_sku_info info
         left join pms_sku_sale_attr_value pssav on info.sku_id = pssav.sku_id
where info.spu_id=1
group by pssav.attr_id,pssav.attr_name,pssav.attr_value;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.1.2.png" alt="image-20220802193044714" tabindex="0" loading="lazy"><figcaption>image-20220802193044714</figcaption></figure><h5 id="_2ã€ä¿®æ”¹ä»£ç " tabindex="-1"><a class="header-anchor" href="#_2ã€ä¿®æ”¹ä»£ç " aria-hidden="true">#</a> 2ã€ä¿®æ”¹ä»£ç </h5><p>æŠŠ<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.vo.SkuItemVo</code>ç±»é‡Œçš„<code>private List&lt;String&gt; attrValues;</code>ä¿®æ”¹ä¸º<code>private List&lt;AttrValueWithSkuIdVo&gt; attrValues;</code></p><p>å†æ–°å»º<code>AttrValueWithSkuIdVo</code>åŒ¿åå†…éƒ¨ç±»</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">AttrValueWithSkuIdVo</span><span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * å±æ€§å€¼(å¦‚ç¿¡å†·ç¿ ã€8GB+128GBã€8GB+256GBç­‰)
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> attrValue<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * å…·æœ‰è¯¥å±æ€§å€¼çš„skuIdé›†åˆ
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> skuIds<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.2.1.png" alt="image-20220802194718825" tabindex="0" loading="lazy"><figcaption>image-20220802194718825</figcaption></figure><p>ä¿®æ”¹<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/mapper/product/SkuSaleAttrValueDao.xml</code>æ–‡ä»¶çš„idä¸º<code>getSaleAttrsBySpuId</code>çš„æŸ¥è¯¢è¯­å¥</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skuItemSaleAttrVo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.gulimall.product.vo.SkuItemVo$SkuItemSaleAttrVo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attrId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr_id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attrName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr_name<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attrValues<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ofType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.atguigu.gulimall.product.vo.SkuItemVo$AttrValueWithSkuIdVo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attrValue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr_value<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skuIds<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sku_id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getSaleAttrsBySpuId<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skuItemSaleAttrVo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    select pssav.attr_id attr_id,pssav.attr_name attr_name,pssav.attr_value attr_value,
           group_concat(distinct pssav.sku_id) sku_id
    from gulimall_pms.pms_sku_info info
             left join gulimall_pms.pms_sku_sale_attr_value pssav on info.sku_id = pssav.sku_id
    where info.spu_id=1
    group by pssav.attr_id,pssav.attr_name,pssav.attr_value;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.2.2.png" alt="image-20220802195721440" tabindex="0" loading="lazy"><figcaption>image-20220802195721440</figcaption></figure><h5 id="_3ã€ä¿®æ”¹é¡µé¢" tabindex="-1"><a class="header-anchor" href="#_3ã€ä¿®æ”¹é¡µé¢" aria-hidden="true">#</a> 3ã€ä¿®æ”¹é¡µé¢</h5><p>ä¿®æ”¹<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>é‡Œ<code> class=&quot;box-attr-3&quot;</code>çš„<code>&lt;div&gt;</code></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box-attr-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box-attr clear<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr : \${item.saleAttr}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">&gt;</span></span>é€‰æ‹©[[\${attr.attrName}]]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>val : \${attr.attrValues}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>attr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skus=\${val.skuIds}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--&lt;img src=&quot;/static/item/img/59ddfcb1Nc3edb8f1.jpg&quot; /&gt;--&gt;</span>
               [[\${val.attrValue}]]
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.1.png" alt="image-20220802200349661" tabindex="0" loading="lazy"><figcaption>image-20220802200349661</figcaption></figure><p>é‡å¯<code>GulimallProductApplication</code>æ¨¡å—ï¼Œåœ¨<code>http://item.gulimall.com/3.html</code>é¡µé¢é‡Œï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½åˆ°é€‰æ‹©é¢œè‰²é‡Œçš„<code>æ˜Ÿæ²³é“¶</code>å’Œ<code>8GB+256GB</code></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">skus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1,2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>æ˜Ÿæ²³é“¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">skus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2,4,6,8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>8GB+256GB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°<code>æ˜Ÿæ²³é“¶</code>å’Œ<code>8GB+256GB</code>çš„<code>skus</code>é›†åˆçš„âˆ©äº¤é›†åªæœ‰<code>2</code>ï¼Œè¿™å°±æ˜¯æƒ³è¦çš„<code>sku</code>(è¾¹æ¡†é¢œè‰²æœ‰é—®é¢˜)</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.2.png" alt="image-20220802200202794" tabindex="0" loading="lazy"><figcaption>image-20220802200202794</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œæœç´¢<code>box-attr clear</code>,è·³è½¬åˆ°å¯é€‰å‚æ•°è¿™é‡Œï¼Œ</p><p>å°†<code>class=&quot;box-attr clear&quot;</code>çš„<code>&lt;div&gt;</code>é‡Œçš„<code>&lt;a&gt;</code>æ ‡ç­¾é‡Œçš„<code>href=&quot;#&quot;</code>åˆ æ‰ï¼Œæ›¿æ¢ä¸º<code> th:class=&quot;\${#lists.contains(#strings.listSplit(val.skuIds,&#39;,&#39;),item.info.skuId.toString())?&#39;sku_attr_value checked&#39;:&#39;sku_attr_value&#39;}&quot;</code>ï¼Œå¦‚æœé€‰æ‹©äº†è¯¥å±æ€§å€¼å°±<code>class</code>å±æ€§é‡ŒåŠ ä¸Š<code>checked</code></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box-attr-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>box-attr clear<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>attr : \${item.saleAttr}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">&gt;</span></span>é€‰æ‹©[[\${attr.attrName}]]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>val : \${attr.attrValues}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\${#lists.contains(#strings.listSplit(val.skuIds,&#39;,&#39;),item.info.skuId.toString())?&#39;sku_attr_value checked&#39;:&#39;sku_attr_value&#39;}<span class="token punctuation">&quot;</span></span>
               <span class="token attr-name"><span class="token namespace">th:</span>attr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>skus=\${val.skuIds}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--&lt;img src=&quot;/static/item/img/59ddfcb1Nc3edb8f1.jpg&quot; /&gt;--&gt;</span>
               [[\${val.attrValue}]]
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.3.png" alt="image-20220802204646306" tabindex="0" loading="lazy"><figcaption>image-20220802204646306</figcaption></figure><p>ç‚¹å‡»<code>Build</code> -&gt; <code>Recompile &quot;item.html&#39;</code> æˆ–æŒ‰å¿«æ·é”®<code>Ctrl+ Shift+F9</code>ï¼Œé‡æ–°ç¼–è¯‘å½“å‰é™æ€æ–‡ä»¶</p><p>å¯ä»¥çœ‹åˆ°å½“å‰<code>3</code>å·<code>sku</code>ï¼Œé‡Œï¼ŒattrValue çš„<code>skus</code>å±æ€§é‡ŒåŒ…å«è¯¥<code>3</code>å·çš„<code>sku</code>çš„æ ‡ç­¾<code>class</code>éƒ½ä¸º<code>sku_attr_value checked</code>ï¼Œå…¶ä»–<code>attrValue</code>çš„<code>skus</code>å±æ€§é‡ŒåŒ…ä¸å«è¯¥<code>3</code>å·çš„<code>sku</code>çš„æ ‡ç­¾<code>class</code>éƒ½ä¸º<code>sku_attr_value</code>(è¾¹æ¡†é¢œè‰²æœ‰é—®é¢˜)</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.4.png" alt="image-20220802204605054" tabindex="0" loading="lazy"><figcaption>image-20220802204605054</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œçš„<code>&lt;script&gt;</code>é‡Œæ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼Œå»æ‰æ‰€æœ‰<code>class</code>é‡Œå«æœ‰<code>sku_attr_value</code>çš„<code>&lt;a&gt;</code>æ ‡ç­¾çš„çˆ¶æ ‡ç­¾çš„çº¢è‰²è¾¹æ¡†ï¼Œå¹¶å°†<code>class=&#39;sku_attr_value checked&#39;</code>çš„<code>&lt;a&gt;</code>æ ‡ç­¾çš„çˆ¶æ ‡ç­¾æ·»åŠ çº¢è‰²è¾¹æ¡†</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.sku_attr_value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;border&quot;</span><span class="token operator">:</span><span class="token string">&quot;solid 1px #ccc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;a[class=&#39;sku_attr_value checked&#39;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;border&quot;</span><span class="token operator">:</span><span class="token string">&quot;solid 1px red&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.5.png" alt="image-20220802205731494" tabindex="0" loading="lazy"><figcaption>image-20220802205731494</figcaption></figure><p>ç‚¹å‡»<code>Build</code> -&gt; <code>Recompile &quot;item.html&#39;</code> æˆ–æŒ‰å¿«æ·é”®<code>Ctrl+ Shift+F9</code>ï¼Œé‡æ–°ç¼–è¯‘å½“å‰é™æ€æ–‡ä»¶</p><p>å¯ä»¥çœ‹åˆ°å½“å‰<code>3</code>å·<code>sku</code>ï¼Œé‡Œï¼ŒattrValue çš„<code>skus</code>å±æ€§é‡ŒåŒ…å«è¯¥<code>3</code>å·çš„<code>sku</code>çš„æ ‡ç­¾<code>class</code>éƒ½ä¸º<code>sku_attr_value checked</code>ï¼Œå…¶ä»–<code>attrValue</code>çš„<code>skus</code>å±æ€§é‡ŒåŒ…ä¸å«è¯¥<code>3</code>å·çš„<code>sku</code>çš„æ ‡ç­¾<code>class</code>éƒ½ä¸º<code>sku_attr_value</code>ï¼Œå¹¶ä¸”éƒ½åº”ç”¨ä¸Šäº†çº¢è‰²è¾¹æ¡†æ ·å¼</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.6.png" alt="image-20220802205829833" tabindex="0" loading="lazy"><figcaption>image-20220802205829833</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œçš„<code>&lt;script&gt;</code>é‡Œæ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼Œç»™<code>class</code>é‡Œå«æœ‰<code>sku_attr_value</code>çš„æ ‡ç­¾æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œåˆ¤æ–­ç‚¹å‡»åå¯èƒ½è¦è·³è½¬çš„<code>sku</code>çš„é›†åˆ</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.sku_attr_value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//ç‚¹å‡»çš„å…ƒç´ å…ˆæ·»åŠ ä¸Šè‡ªå®šä¹‰çš„å±æ€§ã€‚ä¸ºäº†è¯†åˆ«æˆ‘ä»¬æ˜¯åˆšæ‰è¢«ç‚¹å‡»çš„</span>
   <span class="token keyword">var</span> skus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">&quot;clicked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">var</span> curr <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;skus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//å½“å‰è¢«ç‚¹å‡»çš„æ‰€æœ‰skuç»„åˆæ•°ç»„æ”¾è¿›å»</span>
   skus<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//å»æ‰åŒä¸€è¡Œçš„æ‰€æœ‰çš„checked</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;.sku_attr_value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">&quot;checked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//å…¶ä»–è¡Œçš„è¢«é€‰ä¸­çš„skuIdsä¹Ÿæ”¾åˆ°skusé‡Œ</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;a[class=&#39;sku_attr_value checked&#39;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      skus<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;skus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>skus<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.7.png" alt="image-20220802212245851" tabindex="0" loading="lazy"><figcaption>image-20220802212245851</figcaption></figure><p>ç‚¹å‡»<code>Build</code> -&gt; <code>Recompile &quot;item.html&#39;</code> æˆ–æŒ‰å¿«æ·é”®<code>Ctrl+ Shift+F9</code>ï¼Œé‡æ–°ç¼–è¯‘å½“å‰é™æ€æ–‡ä»¶</p><p>åœ¨<code>http://item.gulimall.com/2.html</code>é¡µé¢é‡Œï¼Œå¦‚æœç‚¹å‡»<code>é€‰æ‹©é¢œè‰²</code>é‡Œçš„<code>æ˜Ÿæ²³é“¶</code>ï¼Œæ­¤æ—¶å·²æ±‚å‡ºç¬¦åˆæ»¡è¶³æ‰€æœ‰å¯é€‰å‚æ•°çš„æŸä¸ªå±æ€§å€¼çš„<code>sku</code>çš„é›†åˆ</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.8.png" alt="image-20220802212145502" tabindex="0" loading="lazy"><figcaption>image-20220802212145502</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œçš„<code>&lt;script&gt;</code>é‡Œåœ¨<code>.sku_attr_value</code>çš„ç‚¹å‡»äº‹ä»¶æ–¹æ³•é‡Œç»§ç»­æ·»åŠ ä»£ç </p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.sku_attr_value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//ç‚¹å‡»çš„å…ƒç´ å…ˆæ·»åŠ ä¸Šè‡ªå®šä¹‰çš„å±æ€§ã€‚ä¸ºäº†è¯†åˆ«æˆ‘ä»¬æ˜¯åˆšæ‰è¢«ç‚¹å‡»çš„</span>
   <span class="token keyword">var</span> skus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">&quot;clicked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">var</span> curr <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;skus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//å½“å‰è¢«ç‚¹å‡»çš„æ‰€æœ‰skuç»„åˆæ•°ç»„æ”¾è¿›å»</span>
   skus<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//å»æ‰åŒä¸€è¡Œçš„æ‰€æœ‰çš„checked</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;.sku_attr_value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">&quot;checked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//å…¶ä»–è¡Œçš„è¢«é€‰ä¸­çš„skuIdsä¹Ÿæ”¾åˆ°skusé‡Œ</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;a[class=&#39;sku_attr_value checked&#39;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      skus<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;skus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>skus<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//å–å‡ºä»–ä»¬çš„äº¤é›†ï¼Œå¾—åˆ°skuId (skus[0]ä¸ºåˆšåˆšç‚¹å‡»çš„attrValue)</span>
   <span class="token keyword">var</span> filterEle <span class="token operator">=</span> skus<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>skus<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//ä½¿ç”¨ $(filterEle) æŠŠ jså¯¹è±¡ è½¬ä¸º Jqueryå¯¹è±¡</span>
      filterEle <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>filterEle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>skus<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token comment">//JQueryå¯¹è±¡</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>filterEle<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//ç¬¬0ä¸ªå…ƒç´ å³ä¸ºæƒ³è¦è·å–çš„å€¼</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>filterEle<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.9.png" alt="image-20220802213251687" tabindex="0" loading="lazy"><figcaption>image-20220802213251687</figcaption></figure><p>åœ¨<code>http://item.gulimall.com/2.html</code>é¡µé¢é‡Œï¼Œäº®é»‘è‰²å’Œ8GB+128GBéƒ½æœ‰çš„æ˜¯3</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.10.png" alt="image-20220802212809885" tabindex="0" loading="lazy"><figcaption>image-20220802212809885</figcaption></figure><p>åœ¨<code>http://item.gulimall.com/1.html</code>é¡µé¢é‡Œï¼Œåœ¨æ­¤é¡µé¢ç‚¹å‡»é€‰æ‹©é¢œè‰²é‡Œçš„<code>äº®é»‘è‰²</code>ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡º3</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.11.png" alt="image-20220802213018996" tabindex="0" loading="lazy"><figcaption>image-20220802213018996</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/templates/item.html</code>æ–‡ä»¶é‡Œçš„<code>&lt;script&gt;</code>é‡Œåœ¨<code>.sku_attr_value</code>çš„ç‚¹å‡»äº‹ä»¶æ–¹æ³•é‡Œç»§ç»­æ·»åŠ ä»£ç </p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;.sku_attr_value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//ç‚¹å‡»çš„å…ƒç´ å…ˆæ·»åŠ ä¸Šè‡ªå®šä¹‰çš„å±æ€§ã€‚ä¸ºäº†è¯†åˆ«æˆ‘ä»¬æ˜¯åˆšæ‰è¢«ç‚¹å‡»çš„</span>
   <span class="token keyword">var</span> skus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">&quot;clicked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">var</span> curr <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;skus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//å½“å‰è¢«ç‚¹å‡»çš„æ‰€æœ‰skuç»„åˆæ•°ç»„æ”¾è¿›å»</span>
   skus<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>curr<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//å»æ‰åŒä¸€è¡Œçš„æ‰€æœ‰çš„checked</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;.sku_attr_value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">&quot;checked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//å…¶ä»–è¡Œçš„è¢«é€‰ä¸­çš„skuIdsä¹Ÿæ”¾åˆ°skusé‡Œ</span>
   <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;a[class=&#39;sku_attr_value checked&#39;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      skus<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;skus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>skus<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//å–å‡ºä»–ä»¬çš„äº¤é›†ï¼Œå¾—åˆ°skuId (skus[0]ä¸ºåˆšåˆšç‚¹å‡»çš„attrValue)</span>
   <span class="token keyword">var</span> filterEle <span class="token operator">=</span> skus<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>skus<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//ä½¿ç”¨ $(filterEle) æŠŠ jså¯¹è±¡ è½¬ä¸º Jqueryå¯¹è±¡</span>
      filterEle <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>filterEle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>skus<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token comment">//JQueryå¯¹è±¡</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>filterEle<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//ç¬¬0ä¸ªå…ƒç´ å³ä¸ºæƒ³è¦è·å–çš„å€¼</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>filterEle<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//4ã€è·³è½¬</span>
   location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;http://item.gulimall.com/&quot;</span><span class="token operator">+</span>filterEle<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">&quot;.html&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.12.png" alt="image-20220802213149530" tabindex="0" loading="lazy"><figcaption>image-20220802213149530</figcaption></figure><p>ç‚¹å‡»<code>Build</code> -&gt; <code>Recompile &quot;item.html&#39;</code> æˆ–æŒ‰å¿«æ·é”®<code>Ctrl+ Shift+F9</code>ï¼Œé‡æ–°ç¼–è¯‘å½“å‰é™æ€æ–‡ä»¶</p><p>åœ¨<code>http://item.gulimall.com/1.html</code>é¡µé¢é‡Œç‚¹å‡»é€‰æ‹©é¢œè‰²é‡Œçš„<code>äº®é»‘è‰²</code>ï¼Œå¯ä»¥çœ‹åˆ°æ­£ç¡®è·³è½¬åˆ°äº†<code>http://item.gulimall.com/3.html</code>é¡µé¢</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.4.3.13.gif" alt="GIF 2022-8-2 21-34-19" tabindex="0" loading="lazy"><figcaption>GIF 2022-8-2 21-34-19</figcaption></figure><h4 id="_5ã€å¼‚æ­¥ç¼–æ’" tabindex="-1"><a class="header-anchor" href="#_5ã€å¼‚æ­¥ç¼–æ’" aria-hidden="true">#</a> 5ã€å¼‚æ­¥ç¼–æ’</h4><h5 id="_1ã€é…ç½®çº¿ç¨‹æ± " tabindex="-1"><a class="header-anchor" href="#_1ã€é…ç½®çº¿ç¨‹æ± " aria-hidden="true">#</a> 1ã€é…ç½®çº¿ç¨‹æ± </h5><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.config</code>åŒ…é‡Œæ–°å»º<code>MyThreadConfig</code>é…ç½®ç±»ï¼Œåœ¨è¿™é‡Œé¢é…ç½®çº¿ç¨‹æ± ï¼Œä½†è¿™ç§å›ºå®šé…ç½®çš„å†™æ³•ä¸æ˜¯å¾ˆå¥½</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>product<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingDeque</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> æ— åæ°
 * <span class="token keyword">@date</span> 2022/8/3
 * @Description: çº¿ç¨‹æ± 
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span> <span class="token function">threadPoolExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span>
                <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span>  <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.1.1.png" alt="image-20220803092004898" tabindex="0" loading="lazy"><figcaption>image-20220803092004898</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.config</code>åŒ…é‡Œæ–°å»º<code>ThreadPollConfigProperties</code>ç±»ï¼Œåœ¨è¯¥ç±»é‡Œå®šä¹‰çº¿ç¨‹æ± å¯èƒ½çš„å‚æ•°ï¼Œå¹¶å’Œé…ç½®æ–‡ä»¶çš„<code>gulimall.thread</code>ç»‘å®š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>product<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> æ— åæ°
 * <span class="token keyword">@date</span> 2022/8/3
 * @Description:
 */</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;gulimall.thread&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPollConfigProperties</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> corePoolSize<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> maximumPoolSize<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> keepAliveTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.1.2.png" alt="image-20220803092437609" tabindex="0" loading="lazy"><figcaption>image-20220803092437609</figcaption></figure><p>å¯ä»¥æ ¹æ®æç¤ºæ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼Œå¯åŠ¨è¯¥æ¨¡å—åï¼Œå†™è‡ªå®šä¹‰çš„é…ç½®å¯ä»¥æœ‰æç¤º</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.1.3.png" alt="image-20220803092755205" tabindex="0" loading="lazy"><figcaption>image-20220803092755205</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>pom.xml</code>é‡Œæ·»åŠ å¦‚ä¸‹ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--æ·»åŠ æ³¨é‡Šå¤„ç†å™¨(ä½¿ç”¨ideaæ·»åŠ è‡ªå®šä¹‰é…ç½®ä¼šæœ‰æç¤º)--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-configuration-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.1.4.png" alt="image-20220803093240135" tabindex="0" loading="lazy"><figcaption>image-20220803093240135</figcaption></figure><p>åœ¨<code>gulimall-product</code>æ¨¡å—çš„<code>src/main/resources/application.properties</code>æ–‡ä»¶é‡Œæ·»åŠ å¦‚ä¸‹é…ç½®</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token key attr-name">gulimall.thread.core-pool-size</span><span class="token punctuation">=</span><span class="token value attr-value">20</span>
<span class="token key attr-name">gulimall.thread.maximum-pool-size</span><span class="token punctuation">=</span><span class="token value attr-value">200</span>
<span class="token key attr-name">gulimall.thread.keep-alive-time</span><span class="token punctuation">=</span><span class="token value attr-value">10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.1.5.png" alt="image-20220803093858347" tabindex="0" loading="lazy"><figcaption>image-20220803093858347</figcaption></figure><p>ä¿®æ”¹<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.config.MyThreadConfig</code>é…ç½®ç±»ï¼Œæ”¹ä¸ºä»é…ç½®æ–‡ä»¶é‡ŒåŠ¨æ€å–å€¼</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>product<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingDeque</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> æ— åæ°
 * <span class="token keyword">@date</span> 2022/8/3
 * @Description: çº¿ç¨‹æ± 
 */</span>
<span class="token comment">//@EnableConfigurationProperties(ThreadPollConfigProperties.class)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span> <span class="token function">threadPoolExecutor</span><span class="token punctuation">(</span><span class="token class-name">ThreadPollConfigProperties</span> poll<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>poll<span class="token punctuation">.</span><span class="token function">getCorePoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                poll<span class="token punctuation">.</span><span class="token function">getMaximumPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> poll<span class="token punctuation">.</span><span class="token function">getKeepAliveTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span>  <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.1.6.png" alt="image-20220803093723240" tabindex="0" loading="lazy"><figcaption>image-20220803093723240</figcaption></figure><h5 id="_2ã€ä½¿ç”¨å¼‚æ­¥ç¼–æ’" tabindex="-1"><a class="header-anchor" href="#_2ã€ä½¿ç”¨å¼‚æ­¥ç¼–æ’" aria-hidden="true">#</a> 2ã€ä½¿ç”¨å¼‚æ­¥ç¼–æ’</h5><p>ä¿®æ”¹<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.impl.SkuInfoServiceImpl</code>ç±»çš„<code>item</code>æ–¹æ³•ï¼Œæ”¹ç”¨å¼‚æ­¥ç¼–æ’æ¥è·å–ä¿¡æ¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">SkuItemVo</span> <span class="token function">item</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">SkuItemVo</span> skuItemVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuItemVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//1ã€skuåŸºæœ¬ä¿¡æ¯è·å–pms_sku_info</span>
    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuInfoEntity</span><span class="token punctuation">&gt;</span></span> infoFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">SkuInfoEntity</span> skuInfoEntity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuItemVo<span class="token punctuation">.</span><span class="token function">setInfo</span><span class="token punctuation">(</span>skuInfoEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> skuInfoEntity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//3ã€è·å–spuçš„é”€å”®å±æ€§ç»„åˆã€‚</span>
    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> saleAttrFuture <span class="token operator">=</span> infoFuture<span class="token punctuation">.</span><span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemVo<span class="token punctuation">.</span>SkuItemSaleAttrVo</span><span class="token punctuation">&gt;</span></span> skuItemSaleAttrVos <span class="token operator">=</span> skuSaleAttrValueService<span class="token punctuation">.</span><span class="token function">getSaleAttrsBySpuId</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getSpuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuItemVo<span class="token punctuation">.</span><span class="token function">setSaleAttr</span><span class="token punctuation">(</span>skuItemSaleAttrVos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//4ã€è·å–spuçš„ä»‹ç» pms_spu_info_desc</span>
    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> descFuture <span class="token operator">=</span> infoFuture<span class="token punctuation">.</span><span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpuInfoDescEntity</span> spuInfoDescEntity <span class="token operator">=</span> spuInfoDescService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getSpuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuItemVo<span class="token punctuation">.</span><span class="token function">setDesp</span><span class="token punctuation">(</span>spuInfoDescEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//5ã€è·å–spuçš„è§„æ ¼å‚æ•°ä¿¡æ¯ã€‚</span>
    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> baseAttrFuture <span class="token operator">=</span> infoFuture<span class="token punctuation">.</span><span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemVo<span class="token punctuation">.</span>SpuItemAttrGroupVo</span><span class="token punctuation">&gt;</span></span> attrGroupVos <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">getAttrGroupWithAttrsBySpuIdAndCatalogId</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getSpuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> info<span class="token punctuation">.</span><span class="token function">getCatalogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuItemVo<span class="token punctuation">.</span><span class="token function">setGroupAttrs</span><span class="token punctuation">(</span>attrGroupVos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//2ã€skuçš„å›¾ç‰‡ä¿¡æ¯pms_sku_images</span>
    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> imageFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuImagesEntity</span><span class="token punctuation">&gt;</span></span> images <span class="token operator">=</span> skuImagesService<span class="token punctuation">.</span><span class="token function">getImagesBySkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        skuItemVo<span class="token punctuation">.</span><span class="token function">setImages</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//ä¸ç”¨æ·»åŠ infoFutureï¼Œå› ä¸º saleAttrFuture,descFuture,baseAttrFutureèƒ½å®Œæˆåœ¨å…¶ä¹‹å‰çš„infoFutureå¿…ç„¶èƒ½å®Œæˆ</span>
    <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>saleAttrFuture<span class="token punctuation">,</span>descFuture<span class="token punctuation">,</span>baseAttrFuture<span class="token punctuation">,</span>imageFuture<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> skuItemVo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.2.1.png" alt="image-20220803095329617" tabindex="0" loading="lazy"><figcaption>image-20220803095329617</figcaption></figure><p>é¼ æ ‡æ”¾åœ¨<code> CompletableFuture.allOf(saleAttrFuture,descFuture,baseAttrFuture,imageFuture).get();</code>çš„<code>get</code>è¿™é‡Œï¼ŒæŒ‰<code>alt+enter</code>å¿«æ·é”®ï¼Œé€‰æ‹©<code>Add exceptions to method signature</code>ï¼Œå†ç‚¹å‡»<code>yes</code>ï¼Œç»™æœ¬ç±»å’Œæœ¬ç±»çš„æ¥å£çš„<code>item</code>æ–¹æ³•æŠ›å‡ºå¼‚å¸¸</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.2.2.gif" alt="GIF 2022-8-3 10-11-03" tabindex="0" loading="lazy"><figcaption>GIF 2022-8-3 10-11-03</figcaption></figure><p>æ­¤æ—¶<code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.service.SkuInfoService</code>æ¥å£çš„<code>item</code>æ–¹æ³•å˜ä¸ºå¦‚ä¸‹ä»£ç </p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SkuItemVo</span> <span class="token function">item</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.2.3.png" alt="image-20220813152500357" tabindex="0" loading="lazy"><figcaption>image-20220813152500357</figcaption></figure><p><code>gulimall-product</code>æ¨¡å—çš„<code>com.atguigu.gulimall.product.web.ItemController</code>ç±»çš„<code>skuItem</code>æ–¹æ³•å˜ä¸ºå¦‚ä¸‹ä»£ç </p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å±•ç¤ºskuçš„è¯¦æƒ…
 * <span class="token keyword">@param</span> <span class="token parameter">skuId</span>
 * <span class="token keyword">@return</span>
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{skuId}.html&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">skuItem</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å‡†å¤‡æŸ¥è¯¢&quot;</span> <span class="token operator">+</span> skuId <span class="token operator">+</span> <span class="token string">&quot;çš„è¯¦æƒ…&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SkuItemVo</span> vo <span class="token operator">=</span> skuInfoService<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span>vo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.2.4.png" alt="image-20220813152705939" tabindex="0" loading="lazy"><figcaption>image-20220813152705939</figcaption></figure><p>åœ¨<code>http://item.gulimall.com</code>é¡µé¢é‡Œéšä¾¿è¾“ä¸€ä¸ªå…³é”®è¯ï¼Œç„¶åç‚¹å‡»æœç´¢æŒ‰é’®ï¼Œåœ¨<code>http://search.gulimall.com/list.html?keyword=åä¸º</code>é¡µé¢é‡Œï¼Œéšä¾¿ç‚¹ä¸€ä¸ªå•†å“ï¼Œå‡ºç°äº†å¼‚å¸¸</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.2.5.gif" alt="GIF 2022-8-3 10-02-11" tabindex="0" loading="lazy"><figcaption>GIF 2022-8-3 10-02-11</figcaption></figure><p>æŸ¥çœ‹<code>GulimallProductApplication</code>æœåŠ¡çš„æ§åˆ¶å°ï¼ŒæŠ¥äº†å¦‚ä¸‹å¼‚å¸¸ï¼ŒåŸå› è¯´çš„å¾ˆæ¸…é™¤<code>Prohibited package name: java.util.concurrent</code>ï¼ŒåŒ…åä¸èƒ½ä»¥<code>java</code>å¼€å¤´</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>java.lang.SecurityException: Prohibited package name: java.util.concurrent
    at java.lang.ClassLoader.preDefineClass(ClassLoader.java:655) ~[na:1.8.0_301]
    at java.lang.ClassLoader.defineClass(ClassLoader.java:754) ~[na:1.8.0_301]
    at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142) ~[na:1.8.0_301]
    at java.net.URLClassLoader.defineClass(URLClassLoader.java:468) ~[na:1.8.0_301]
    at java.net.URLClassLoader.access$100(URLClassLoader.java:74) ~[na:1.8.0_301]
    at java.net.URLClassLoader$1.run(URLClassLoader.java:369) ~[na:1.8.0_301]
    at java.net.URLClassLoader$1.run(URLClassLoader.java:363) ~[na:1.8.0_301]
    at java.security.AccessController.doPrivileged(Native Method) ~[na:1.8.0_301]
    at java.net.URLClassLoader.findClass(URLClassLoader.java:362) ~[na:1.8.0_301]
    at org.springframework.boot.devtools.restart.classloader.RestartClassLoader.findClass(RestartClassLoader.java:159) ~[spring-boot-devtools-2.1.8.RELEASE.jar:2.1.8.RELEASE]
    at org.springframework.boot.devtools.restart.classloader.RestartClassLoader.loadClass(RestartClassLoader.java:141) ~[spring-boot-devtools-2.1.8.RELEASE.jar:2.1.8.RELEASE]
    at java.lang.ClassLoader.loadClass(ClassLoader.java:351) ~[na:1.8.0_301]
    at com.atguigu.gulimall.product.service.impl.SkuInfoServiceImpl.item(SkuInfoServiceImpl.java:133) ~[classes/:na]
    at com.atguigu.gulimall.product.service.impl.SkuInfoServiceImpl$$FastClassBySpringCGLIB$$f4bab3b6.invoke(&lt;generated&gt;) ~[classes/:na]
    at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218) ~[spring-core-5.1.9.RELEASE.jar:5.1.9.RELEASE]
    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:684) ~[spring-aop-5.1.9.RELEASE.jar:5.1.9.RELEASE]
    at com.atguigu.gulimall.product.service.impl.SkuInfoServiceImpl$$EnhancerBySpringCGLIB$$204d922f.item(&lt;generated&gt;) ~[classes/:na]
    at com.atguigu.gulimall.product.web.ItemController.skuItem(ItemController.java:34) ~[classes/:na]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.2.6.png" alt="image-20220803100300583" tabindex="0" loading="lazy"><figcaption>image-20220803100300583</figcaption></figure><p>ç»è¿‡æŸ¥æ‰¾å‘ç°<code>gulimall-common</code>æ¨¡å—ä¸çŸ¥é“æ€ä¹ˆå¤šäº†<code>java.util.concurrent.CompletableFuture</code>å’Œ<code>java.util.concurrent.FutureTask</code>ï¼Œåˆ æ‰é‡å¯<code>gulimall-product</code>æ¨¡å—å°±å¥½äº†</p><figure><img src="https://gitlab.com/apzs/image/-/raw/master/image/5.6.3.5.2.7.png" alt="image-20220804113632736" tabindex="0" loading="lazy"><figcaption>image-20220804113632736</figcaption></figure>`,339);function m(v,g){const t=e("RouterLink");return c(),o("div",null,[k,s("p",null,[l(t,{to:"/gulimall/code/5.6.3.1.4.item.html"},{default:i(()=>[n("ç‚¹å‡»æŸ¥çœ‹å®Œæ•´"),r,n("é¡µé¢")]),_:1})]),d])}const f=p(u,[["render",m],["__file","advanced3.html.vue"]]);export{f as default};
