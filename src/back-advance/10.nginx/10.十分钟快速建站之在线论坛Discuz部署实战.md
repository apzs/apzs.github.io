 

> ğŸŒ±æœ¬ä¸“æ å°†ä¼šä»åŸºç¡€å¼€å§‹ï¼Œå¾ªåºæ¸è¿›è®²è§£Nginxçš„ä½¿ç”¨å’Œæœ‰å…³é…ç½®ï¼Œä¹Ÿè¯·å¤§å®¶å¤šå¤šæ”¯æŒ,å¸Œæœ›å¤§å®¶éƒ½èƒ½å¤Ÿä»ä¸­è·ç›Šã€‚  
> ğŸ“«ä¸“æ åœ°å€:[Nginx](https://blog.csdn.net/learning_xzj/category_11792194.html)  
> ğŸ“«ç›¸å…³è½¯ä»¶:[é“¾æ¥åœ°å€](https://pan.baidu.com/s/12VmjEzxEKeiwrONceaWguA?pwd=aaaa)

### æ–‡ç« ç›®å½•

*   *   *   [ä½¿ç”¨å®å¡”é¢æ¿è¿›è¡Œç¯å¢ƒå®‰è£…](#_9)
        *   [ä½¿ç”¨oneinstackå¯¹é›†æˆç¯å¢ƒè¿›è¡Œå®‰è£…](#oneinstack_289)
        *   [nginx.cfgé…ç½®è¡¥å……å€¼return,proxy_passä»¥åŠrewriteæ¯”è¾ƒ](#nginxcfgreturnproxy_passrewrite_305)

éƒ¨å±å®Œæˆçš„æ•ˆæœå›¾ï¼š  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://gitlab.com/apzs/image/-/raw/master/image/c7b7d3001dca4f6fb1463e4daeaea156.png)

### ä½¿ç”¨å®å¡”é¢æ¿è¿›è¡Œç¯å¢ƒå®‰è£…

æœ¬ä¾‹é‡‡ç”¨å®å¡”ç‰ˆè¿›è¡Œå®æˆ˜ï¼Œç›¸åº”ç¯å¢ƒå¦‚ä¸‹ï¼š

![image-20220502231844011](https://gitlab.com/apzs/image/-/raw/master/image/a3672cef8b6cdfb789c57a40764ffea6.png)

å®å¡”çš„nginx.cfgå¦‚ä¸‹ï¼š

```nginx
user  www www;
worker_processes auto;
error_log  /www/wwwlogs/nginx_error.log  crit;
pid        /www/server/nginx/logs/nginx.pid;
worker_rlimit_nofile 51200;

events
    {
        use epoll;
        worker_connections 51200;
        multi_accept on;
    }

http
    {
        include       mime.types;
		#include luawaf.conf;

		include proxy.conf;

        default_type  application/octet-stream;

        server_names_hash_bucket_size 512;
        client_header_buffer_size 32k;
        large_client_header_buffers 4 32k;
        client_max_body_size 50m;

        sendfile   on;
        tcp_nopush on;

        keepalive_timeout 60;

        tcp_nodelay on;

        fastcgi_connect_timeout 300;
        fastcgi_send_timeout 300;
        fastcgi_read_timeout 300;
        fastcgi_buffer_size 64k;
        fastcgi_buffers 4 64k;
        fastcgi_busy_buffers_size 128k;
        fastcgi_temp_file_write_size 256k;
		fastcgi_intercept_errors on;

        gzip on;
        gzip_min_length  1k;
        gzip_buffers     4 16k;
        gzip_http_version 1.1;
        gzip_comp_level 2;
        gzip_types     text/plain application/javascript application/x-javascript text/javascript text/css application/xml;
        gzip_vary on;
        gzip_proxied   expired no-cache no-store private auth;
        gzip_disable   "MSIE [1-6]\.";

        limit_conn_zone $binary_remote_addr zone=perip:10m;
		limit_conn_zone $server_name zone=perserver:10m;

        server_tokens off;
        access_log off;

server
    {
        listen 888;
        server_name phpmyadmin;
        index index.html index.htm index.php;
        root  /www/server/phpmyadmin;
            location ~ /tmp/ {
                return 403;
            }

        #error_page   404   /404.html;
        include enable-php.conf;

        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
        {
            expires      30d;
        }

        location ~ .*\.(js|css)?$
        {
            expires      12h;
        }

        location ~ /\.
        {
            deny all;
        }

        access_log  /www/wwwlogs/access.log;
    }
    include /www/server/panel/vhost/nginx/*.conf;
}
```


å¯ä»¥çœ‹åˆ°888ç«¯å£ç›‘å¬çš„æ˜¯phpé¡¹ç›®ï¼Œå°†phpé¡¹ç›®ä¸Šä¼ è‡³å¦‚ä¸‹ä½ç½®ï¼š

![image-20220502225756993](https://gitlab.com/apzs/image/-/raw/master/image/c904b86be47d7bc7f54004d949844746.png)

è®¿é—® http://192.168.8.129:888/upload/install

![image-20220502230009299](https://gitlab.com/apzs/image/-/raw/master/image/683516a26cf12a4c616663e65bed1823.png)

![image-20220502230042037](https://gitlab.com/apzs/image/-/raw/master/image/86f9a22d7e091d9d16d1793208e09e23.png)

å‡ºç°è¿™ç§æƒ…å†µï¼Œç”±äºæ˜¯æ¼”ç¤ºï¼Œæ‰€ä»¥å°†uploadç›®å½•çš„æƒé™æ”¹æˆå¯è¯»å¯å†™ï¼Œç”Ÿäº§ç¯å¢ƒåƒä¸‡ä¸èƒ½è¿™ä¹ˆåšã€‚

    chmod -R 777 upload/


åˆ·æ–°é¡µé¢ï¼Œå‡ºç°å¦‚ä¸‹é¡µé¢ï¼š

![image-20220502230839216](https://gitlab.com/apzs/image/-/raw/master/image/c6b0c885ff9c3771d6f9fa3d8f75e0aa.png)

![image-20220502230902228](https://gitlab.com/apzs/image/-/raw/master/image/22b9d441b0d17aad357c8fb999d2e5b5.png)

![image-20220502230958539](https://gitlab.com/apzs/image/-/raw/master/image/6c656b768c3615dd4ad5ef3a490c8797.png)

![image-20220502231059150](https://gitlab.com/apzs/image/-/raw/master/image/df721a61a7ffabd3002e39a61b4fec59.png)

![image-20220502231109994](https://gitlab.com/apzs/image/-/raw/master/image/ad5b67ba578e52b3c6c106a454c6581b.png)

ä½¿ç”¨ipè®¿é—®ï¼š

![image-20220502231650912](https://gitlab.com/apzs/image/-/raw/master/image/4c7e82a8ee28c22cc48ef746f3e6cf1f.png)

ä½¿ç”¨åŸŸåè®¿é—®ï¼š

![image-20220502231717687](https://gitlab.com/apzs/image/-/raw/master/image/dd078413dc06b930da1c9678fc6e91e0.png)

å¦‚æœä¸æƒ³è·³è½¬ï¼Œå¯ä»¥åœ¨443ç«¯å£ä¸‹ç›´æ¥é…ç½®phpè®¿é—®è·¯å¾„ï¼Œè¯¦ç»†nginx.confå¦‚ä¸‹:

```nginx
user  www www;
worker_processes auto;
error_log  /www/wwwlogs/nginx_error.log  crit;
pid        /www/server/nginx/logs/nginx.pid;
worker_rlimit_nofile 51200;

events
    {
        use epoll;
        worker_connections 51200;
        multi_accept on;
    }

http
    {
        include       mime.types;
		#include luawaf.conf;

		include proxy.conf;

        default_type  application/octet-stream;

        server_names_hash_bucket_size 512;
        client_header_buffer_size 32k;
        large_client_header_buffers 4 32k;
        client_max_body_size 50m;

        sendfile   on;
        tcp_nopush on;

        keepalive_timeout 60;

        tcp_nodelay on;

        fastcgi_connect_timeout 300;
        fastcgi_send_timeout 300;
        fastcgi_read_timeout 300;
        fastcgi_buffer_size 64k;
        fastcgi_buffers 4 64k;
        fastcgi_busy_buffers_size 128k;
        fastcgi_temp_file_write_size 256k;
		fastcgi_intercept_errors on;

        gzip on;
        gzip_min_length  1k;
        gzip_buffers     4 16k;
        gzip_http_version 1.1;
        gzip_comp_level 2;
        gzip_types     text/plain application/javascript application/x-javascript text/javascript text/css application/xml;
        gzip_vary on;
        gzip_proxied   expired no-cache no-store private auth;
        gzip_disable   "MSIE [1-6]\.";

        limit_conn_zone $binary_remote_addr zone=perip:10m;
		limit_conn_zone $server_name zone=perserver:10m;

        server_tokens off;
        access_log off;

server {
	listen 443 ssl;
	server_name localhost;  
	ssl_certificate 7706851_www.xzj520520.cn.pem;
	ssl_certificate_key 7706851_www.xzj520520.cn.key;
	
	index index.html index.htm index.php;
        root  /www/server/phpmyadmin/upload;
            location ~ /tmp/ {
                return 403;
            }

        #error_page   404   /404.html;
        include enable-php.conf;

        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
        {
            expires      30d;
        }

        location ~ .*\.(js|css)?$
        {
            expires      12h;
        }

        location ~ /\.
        {
            deny all;
        }

        access_log  /www/wwwlogs/access.log;
}

server {
	listen 80;
	server_name www.xzj520520.cn xzj520520.cn; 

	return 301 https://$server_name$request_uri;	
}

server
    {
        listen 888;
        server_name phpmyadmin;
        index index.html index.htm index.php;
        root  /www/server/phpmyadmin;
            location ~ /tmp/ {
                return 403;
            }

        #error_page   404   /404.html;
        include enable-php.conf;

        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
        {
            expires      30d;
        }

        location ~ .*\.(js|css)?$
        {
            expires      12h;
        }

        location ~ /\.
        {
            deny all;
        }

        access_log  /www/wwwlogs/access.log;
    }
include /www/server/panel/vhost/nginx/*.conf;
}
```


 è®¿é—®:xzj520520.cn,ç»“æœå¦‚ä¸‹ï¼š

![image-20220503095601725](https://gitlab.com/apzs/image/-/raw/master/image/b463707c11a914d233b389bf8bb6a6ac.png)

### ä½¿ç”¨oneinstackå¯¹é›†æˆç¯å¢ƒè¿›è¡Œå®‰è£…

è¿™é‡Œä¹Ÿå¯ä»¥ç”¨oneinstackä»£æ›¿å®å¡”é¢æ¿å¯¹é›†æˆç¯å¢ƒï¼ˆåŒ…æ‹¬nginxï¼Œtomcatï¼Œphpadminç­‰ï¼‰è¿›è¡Œå®‰è£…ï¼Œæ“ä½œå¦‚ä¸‹ï¼š

ç½‘å€: https://oneinstack.com/

é€‰æ‹©è‡ªåŠ¨å®‰è£…:

![image-20220502192622670](https://gitlab.com/apzs/image/-/raw/master/image/fddaf82e343e89a8531c02f3cfd147af.png)

é€‰æ‹©è¦å®‰è£…çš„è½¯ä»¶ï¼Œä¸€ä¸ªå°tipï¼šä¿®æ”¹æ•°æ®åº“å¯†ç ï¼Œä»¥é˜²æ­¢å®‰è£…å¥½ä¹‹åä¸çŸ¥é“æ•°æ®åº“çš„å¯†ç æ˜¯ä»€ä¹ˆï¼Œé€‰æ‹©å¥½è¦æŒ‰ç…§çš„è½¯ä»¶ä¹‹åå¤åˆ¶å®‰è£…å‘½ä»¤ï¼Œè¿›è¡Œå®‰è£…:

![image-20220502192741255](https://gitlab.com/apzs/image/-/raw/master/image/0ee2494fd3d860075d91917322f3d537.png)

### nginx.cfgé…ç½®è¡¥å……å€¼return,proxy_passä»¥åŠrewriteæ¯”è¾ƒ

```nginx
server {
	listen 80;
 	server_name www.xzj520520.cn xzj520520.cn; 
	
	#1. é‡å®šå‘,å¦‚æœå€¼æ²¡æœ‰åŒ¹é…åˆ™ä¼šé»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä¸ªserver_name,åœ¨è¿™é‡Œä¸ºçš„å€¼ä¸º www.xzj520520.cnï¼Œä¾‹ï¼š
	 	 return 301 https://$server_name$request_uri;	
 	#      return 301 http://$server_name:888/upload$request_uri;	
	#é…ç½®æ ¹ç›®å½•ä»¥åŠé»˜è®¤é¡µé¢
        location / {
            # 2.ä½¿ç”¨proxy_pass 
            # 2.1 ä½¿ç”¨ip(å› ä¸ºè¿™ç§æ–¹å¼ä¸èƒ½ä¼ é€’uriï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡80è®¿é—®server_nameä¸­å­˜åœ¨çš„åŸŸåï¼Œå¦åˆ™ä¼šå‡ºé”™)ï¼ˆä¸å¸¸ç”¨ï¼‰
            # proxy_pass http://192.168.8.129:888//upload;
            # 2.2 ä½¿ç”¨åŸŸåï¼Œè¿™ç§æ–¹å¼å¯ä»¥ä¼ é€’uri
             proxy_pass https:///www.xzj520520.cn;
            #3.ä½¿ç”¨rewrite è¿™ç§æ–¹å¼å¯ä»¥å¯¹ä¼ é€’çš„å‚æ•°è¿›è¡Œéšè—ï¼Œä¼šåœ¨proxy_passåœ°å€ä¸Šæ·»åŠ rewriteçš„å†…å®¹ï¼Œå¦‚3.1çš„ä¸¤è¡Œï¼Œå¦‚æœè®¿é—®xzj52052.cn/admin.phpä¼šè®¿é—®åˆ°http://192.168.8.129:888/admin.phpï¼Œå¯ä»¥ä¼ é€’uri
            # 3.1 ä½¿ç”¨ip
            # rewrite ^/[\D|\d]*$ /upload/$1 break;
            # proxy_pass http://192.168.8.129:888;
            # 3.2 ä½¿ç”¨åŸŸå
            # rewrite ^/[\D|\d]*$ /$1 break;
            # proxy_pass https://www.xzj520520.cn;
        }

	...
}
```
