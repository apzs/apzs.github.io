 

> ğŸŒ±æœ¬ä¸“æ å°†ä¼šä»åŸºç¡€å¼€å§‹ï¼Œå¾ªåºæ¸è¿›è®²è§£Nginxçš„ä½¿ç”¨å’Œæœ‰å…³é…ç½®ï¼Œä¹Ÿè¯·å¤§å®¶å¤šå¤šæ”¯æŒ,å¸Œæœ›å¤§å®¶éƒ½èƒ½å¤Ÿä»ä¸­è·ç›Šã€‚  
> ğŸ“«ä¸“æ åœ°å€:[Nginx](https://blog.csdn.net/learning_xzj/category_11792194.html)  
> ğŸ“«ç›¸å…³è½¯ä»¶:[é“¾æ¥åœ°å€](https://pan.baidu.com/s/12VmjEzxEKeiwrONceaWguA?pwd=aaaa)

### æ–‡ç« ç›®å½•

*   *   [åå‘ä»£ç†åœ¨ç³»ç»Ÿç»“æ„ä¸­çš„åº”ç”¨åœºæ™¯](#_5)
    *   *   [Nginxçš„åå‘ä»£ç†é…ç½®](#Nginx_29)
        *   [åŸºäºåå‘ä»£ç†çš„è´Ÿè½½å‡è¡¡å™¨](#_39)
        *   *   [å°†101ä»£ç†åˆ°102](#101102_349)
            *   [é…ç½®101çš„è´Ÿè½½å‡è¡¡ï¼ˆè½®è¯¢æ¨¡å¼ï¼‰](#101_406)
            *   [é…ç½®101çš„è´Ÿè½½å‡è¡¡ï¼ˆæƒé‡æ¨¡å¼ï¼‰](#101_475)
            *   [å…¶ä»–è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆä¸å¸¸ç”¨ï¼‰](#_538)

åå‘ä»£ç†åœ¨ç³»ç»Ÿç»“æ„ä¸­çš„åº”ç”¨åœºæ™¯
---------------------------------------------------------------------------------------------------------------

![image-20220430170948611](https://gitlab.com/apzs/image/-/raw/master/image/2c4bf89af40ccce29bec18a69d9c3e11.png)

åå‘ä»£ç†æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—Internetä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼›å¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™Internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªæœåŠ¡å™¨ã€‚

åå‘ä»£ç†æœåŠ¡å™¨é€šå¸¸æœ‰ä¸¤ç§æ¨¡å‹ï¼Œä¸€ç§æ˜¯ä½œä¸ºå†…å®¹æœåŠ¡å™¨çš„æ›¿èº«ï¼Œå¦ä¸€ç§ä½œä¸ºå†…å®¹æœåŠ¡å™¨é›†ç¾¤çš„è´Ÿè½½å‡è¡¡å™¨ã€‚

*   ä½œå†…å®¹æœåŠ¡å™¨çš„æ›¿èº«

å¦‚æœæ‚¨çš„å†…å®¹æœåŠ¡å™¨å…·æœ‰å¿…é¡»ä¿æŒå®‰å…¨çš„æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ä¿¡ç”¨å¡å·æ•°æ®åº“ï¼Œå¯åœ¨é˜²ç«å¢™å¤–éƒ¨è®¾ç½®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ä½œä¸ºå†…å®¹æœåŠ¡å™¨çš„æ›¿èº«ã€‚å½“å¤–éƒ¨å®¢æˆ·æœºå°è¯•è®¿é—®å†…å®¹æœåŠ¡å™¨æ—¶ï¼Œä¼šå°†å…¶é€åˆ°ä»£ç†æœåŠ¡å™¨ã€‚å®é™…å†…å®¹ä½äºå†…å®¹æœåŠ¡å™¨ä¸Šï¼Œåœ¨é˜²ç«å¢™å†…éƒ¨å—åˆ°å®‰å…¨ä¿æŠ¤ã€‚ä»£ç†æœåŠ¡å™¨ä½äºé˜²ç«å¢™å¤–éƒ¨ï¼Œåœ¨å®¢æˆ·æœºçœ‹æ¥å°±åƒæ˜¯å†…å®¹æœåŠ¡å™¨ã€‚

å½“å®¢æˆ·æœºå‘ç«™ç‚¹æå‡ºè¯·æ±‚æ—¶ï¼Œè¯·æ±‚å°†è½¬åˆ°ä»£ç†æœåŠ¡å™¨ã€‚ç„¶åï¼Œä»£ç†æœåŠ¡å™¨é€šè¿‡é˜²ç«å¢™ä¸­çš„ç‰¹å®šé€šè·¯ï¼Œå°†å®¢æˆ·æœºçš„è¯·æ±‚å‘é€åˆ°å†…å®¹æœåŠ¡å™¨ã€‚å†…å®¹æœåŠ¡å™¨å†é€šè¿‡è¯¥é€šé“å°†ç»“æœå›ä¼ ç»™ä»£ç†æœåŠ¡å™¨ã€‚ä»£ç†æœåŠ¡å™¨å°†æ£€ç´¢åˆ°çš„ä¿¡æ¯å‘é€ç»™å®¢æˆ·æœºï¼Œå¥½åƒä»£ç†æœåŠ¡å™¨å°±æ˜¯å®é™…çš„å†…å®¹æœåŠ¡å™¨ã€‚å¦‚æœå†…å®¹æœåŠ¡å™¨è¿”å›é”™è¯¯æ¶ˆæ¯ï¼Œä»£ç†æœåŠ¡å™¨ä¼šå…ˆè¡Œæˆªå–è¯¥æ¶ˆæ¯å¹¶æ›´æ”¹æ ‡å¤´ä¸­åˆ—å‡ºçš„ä»»ä½• URLï¼Œç„¶åå†å°†æ¶ˆæ¯å‘é€ç»™å®¢æˆ·æœºã€‚å¦‚æ­¤å¯é˜²æ­¢å¤–éƒ¨å®¢æˆ·æœºè·å–å†…éƒ¨å†…å®¹æœåŠ¡å™¨çš„é‡å®šå‘ URLã€‚

è¿™æ ·ï¼Œä»£ç†æœåŠ¡å™¨å°±åœ¨å®‰å…¨æ•°æ®åº“å’Œå¯èƒ½çš„æ¶æ„æ”»å‡»ä¹‹é—´æä¾›äº†åˆä¸€é“å±éšœã€‚ä¸æœ‰æƒè®¿é—®æ•´ä¸ªæ•°æ®åº“çš„æƒ…å†µç›¸å¯¹æ¯”ï¼Œå°±ç®—æ˜¯ä¾¥å¹¸æ”»å‡»æˆåŠŸï¼Œä½œæ¶è€…å……å…¶é‡ä¹Ÿä»…é™äºè®¿é—®å•ä¸ªäº‹åŠ¡ä¸­æ‰€æ¶‰åŠçš„ä¿¡æ¯ã€‚æœªç»æˆæƒçš„ç”¨æˆ·æ— æ³•è®¿é—®åˆ°çœŸæ­£çš„å†…å®¹æœåŠ¡å™¨ï¼Œå› ä¸ºé˜²ç«å¢™é€šè·¯åªå…è®¸ä»£ç†æœåŠ¡å™¨æœ‰æƒè¿›è¡Œè®¿é—®ã€‚

*   ä½œä¸ºå†…å®¹æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å™¨

å¯ä»¥åœ¨ä¸€ä¸ªç»„ç»‡å†…ä½¿ç”¨å¤šä¸ªä»£ç†æœåŠ¡å™¨æ¥å¹³è¡¡å„ Web æœåŠ¡å™¨é—´çš„ç½‘ç»œè´Ÿè½½ã€‚åœ¨æ­¤æ¨¡å‹ä¸­ï¼Œå¯ä»¥åˆ©ç”¨ä»£ç†æœåŠ¡å™¨çš„é«˜é€Ÿç¼“å­˜ç‰¹æ€§ï¼Œåˆ›å»ºä¸€ä¸ªç”¨äºè´Ÿè½½å¹³è¡¡çš„æœåŠ¡å™¨æ± ã€‚æ­¤æ—¶ï¼Œä»£ç†æœåŠ¡å™¨å¯ä»¥ä½äºé˜²ç«å¢™çš„ä»»æ„ä¸€ä¾§ã€‚å¦‚æœ Web æœåŠ¡å™¨æ¯å¤©éƒ½ä¼šæ¥æ”¶å¤§é‡çš„è¯·æ±‚ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»£ç†æœåŠ¡å™¨åˆ†æ‹… Web æœåŠ¡å™¨çš„è´Ÿè½½å¹¶æé«˜ç½‘ç»œè®¿é—®æ•ˆç‡ã€‚

å¯¹äºå®¢æˆ·æœºå‘å¾€çœŸæ­£æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œä»£ç†æœåŠ¡å™¨èµ·ç€ä¸­é—´è°ƒåœè€…çš„ä½œç”¨ã€‚ä»£ç†æœåŠ¡å™¨ä¼šå°†æ‰€è¯·æ±‚çš„æ–‡æ¡£å­˜å…¥é«˜é€Ÿç¼“å­˜ã€‚å¦‚æœæœ‰ä¸æ­¢ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼ŒDNS å¯ä»¥é‡‡ç”¨â€œè½®è¯¢æ³•â€é€‰æ‹©å…¶ IP åœ°å€ï¼Œéšæœºåœ°ä¸ºè¯·æ±‚é€‰æ‹©è·¯ç”±ã€‚å®¢æˆ·æœºæ¯æ¬¡éƒ½ä½¿ç”¨åŒä¸€ä¸ª URLï¼Œä½†è¯·æ±‚æ‰€é‡‡å–çš„è·¯ç”±æ¯æ¬¡éƒ½å¯èƒ½ç»è¿‡ä¸åŒçš„ä»£ç†æœåŠ¡å™¨ã€‚

å¯ä»¥ä½¿ç”¨å¤šä¸ªä»£ç†æœåŠ¡å™¨æ¥å¤„ç†å¯¹ä¸€ä¸ªé«˜ç”¨é‡å†…å®¹æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å†…å®¹æœåŠ¡å™¨å¯ä»¥å¤„ç†æ›´é«˜çš„è´Ÿè½½ï¼Œå¹¶ä¸”æ¯”å…¶ç‹¬è‡ªå·¥ä½œæ—¶æ›´æœ‰æ•ˆç‡ã€‚åœ¨åˆå§‹å¯åŠ¨æœŸé—´ï¼Œä»£ç†æœåŠ¡å™¨é¦–æ¬¡ä»å†…å®¹æœåŠ¡å™¨æ£€ç´¢æ–‡æ¡£ï¼Œæ­¤åï¼Œå¯¹å†…å®¹æœåŠ¡å™¨çš„è¯·æ±‚æ•°ä¼šå¤§å¤§ä¸‹é™ã€‚

### Nginxçš„åå‘ä»£ç†é…ç½®

é…ç½®å¦‚ä¸‹ï¼š

![image-20220430182343864](https://gitlab.com/apzs/image/-/raw/master/image/5f7011630051c26dceabac426398d8da.png)

è®¿é—®http://test80.xzj520520.cn/ï¼š

![image-20220430182313784](https://gitlab.com/apzs/image/-/raw/master/image/17f7eb20fab9e8b13b197761a52a3f26.png)

### åŸºäºåå‘ä»£ç†çš„è´Ÿè½½å‡è¡¡å™¨

å…‹éš†ä¸¤ä¸ªcentosï¼Œipåˆ†åˆ«è®¾ä¸º192.168.8.102ï¼Œ192.168.8.103ï¼ˆç½‘æ®µè¦ç”¨è‡ªå·±çš„ç”µè„‘å¯¹åº”ï¼‰

![image-20220430184102076](https://gitlab.com/apzs/image/-/raw/master/image/ee071c0b85cc9e477fda83cd1b8816c5.png)

ä¿®æ”¹é™æ€ip

![image-20220430184135760](https://gitlab.com/apzs/image/-/raw/master/image/5a6583de9e03b8b09e25c986ef014fc2.png)

![image-20220430184225267](https://gitlab.com/apzs/image/-/raw/master/image/ea3bdc4d593bb79f5f5b5ae2cc1d8e6a.png)

é‡å¯ç½‘ç»œæœåŠ¡ï¼š

![image-20220430184320760](https://gitlab.com/apzs/image/-/raw/master/image/45e242f2f8e53f37e9e44b3604fb1bb2.png)

å¦ä¸€ä¸ªè™šæ‹Ÿæœºçš„é…ç½®ä¹Ÿæ˜¯ä¸€æ ·ã€‚é…ç½®å¥½è™šæ‹Ÿæœºä¹‹å,é…ç½®nginx.cfg

102çš„nginx.cfg

```nginx
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    server {
        listen       80;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   html;
            index  index.html index.htm;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ \.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ \.php$ {
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #    deny  all;
        #}
    }


    # another virtual host using mix of IP-, name-, and port-based configuration
    #
    #server {
    #    listen       8000;
    #    listen       somename:8080;
    #    server_name  somename  alias  another.alias;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}


    # HTTPS server
    #
    #server {
    #    listen       443 ssl;
    #    server_name  localhost;

    #    ssl_certificate      cert.pem;
    #    ssl_certificate_key  cert.key;

    #    ssl_session_cache    shared:SSL:1m;
    #    ssl_session_timeout  5m;

    #    ssl_ciphers  HIGH:!aNULL:!MD5;
    #    ssl_prefer_server_ciphers  on;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}

}
```


102çš„nginxåœ¨htmlç›®å½•ä¸‹çš„index.htmlæ–‡ä»¶

```html
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>I am from 192.168.8.102</h1>
</body>
</html>
```

103çš„nginx.cfg

```nginx
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    server {
        listen       80;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   html;
            index  index.html index.htm;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ \.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ \.php$ {
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #    deny  all;
        #}
    }


    # another virtual host using mix of IP-, name-, and port-based configuration
    #
    #server {
    #    listen       8000;
    #    listen       somename:8080;
    #    server_name  somename  alias  another.alias;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}


    # HTTPS server
    #
    #server {
    #    listen       443 ssl;
    #    server_name  localhost;

    #    ssl_certificate      cert.pem;
    #    ssl_certificate_key  cert.key;
    #    ssl_session_cache    shared:SSL:1m;
    #    ssl_session_timeout  5m;

    #    ssl_ciphers  HIGH:!aNULL:!MD5;
    #    ssl_prefer_server_ciphers  on;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}

}
```


103çš„nginxåœ¨htmlç›®å½•ä¸‹çš„index.htmlæ–‡ä»¶

```html
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>I am from 192.168.8.103</h1>
</body>
</html>
```


æµ‹è¯•ï¼š

è®¿é—®http://192.168.8.102/

![image-20220430185446556](https://gitlab.com/apzs/image/-/raw/master/image/168f9640c8971952719fcc11ed8b921f.png)

è®¿é—®http://192.168.8.103/

![image-20220430185502170](https://gitlab.com/apzs/image/-/raw/master/image/dfdd9aa50c590abf87c1f17c3bd92611.png)

#### å°†101ä»£ç†åˆ°102

101çš„nginx.conf

```nginx
worker_processes  1; #å…è®¸è¿›ç¨‹æ•°é‡ï¼Œå»ºè®®è®¾ç½®ä¸ºcpuæ ¸å¿ƒæ•°æˆ–è€…autoè‡ªåŠ¨æ£€æµ‹ï¼Œæ³¨æ„WindowsæœåŠ¡å™¨ä¸Šè™½ç„¶å¯ä»¥å¯åŠ¨å¤šä¸ªprocessesï¼Œä½†æ˜¯å®é™…åªä¼šç”¨å…¶ä¸­ä¸€ä¸ª

events {
    #å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°=è¿æ¥æ•°*è¿›ç¨‹æ•°ï¼‰
    #æ ¹æ®ç¡¬ä»¶è°ƒæ•´ï¼Œå’Œå‰é¢å·¥ä½œè¿›ç¨‹é…åˆèµ·æ¥ç”¨ï¼Œå°½é‡å¤§ï¼Œä½†æ˜¯åˆ«æŠŠcpuè·‘åˆ°100%å°±è¡Œã€‚
    worker_connections  1024;
}


http {
    #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨(æ˜¯confç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶)
    include       mime.types;
    #é»˜è®¤æ–‡ä»¶ç±»å‹ï¼Œå¦‚æœmime.typesé¢„å…ˆå®šä¹‰çš„ç±»å‹æ²¡åŒ¹é…ä¸Šï¼Œé»˜è®¤ä½¿ç”¨äºŒè¿›åˆ¶æµçš„æ–¹å¼ä¼ è¾“
    default_type  application/octet-stream;

    #sendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸ºonã€‚å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œIOå¤„ç†é€Ÿåº¦ã€‚
    sendfile        on;
    
     #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’
    keepalive_timeout  65;

 #è™šæ‹Ÿä¸»æœºçš„é…ç½®
    server {
    #ç›‘å¬ç«¯å£
        listen       80;
        #åŸŸåï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼éš”å¼€
        server_name  test80.xzj520520.cn;

	#é…ç½®æ ¹ç›®å½•ä»¥åŠé»˜è®¤é¡µé¢
        location / {
            proxy_pass http://192.168.8.102;
            # root   /www/test80;
            # index  index.html index.htm;
        }

	#å‡ºé”™é¡µé¢é…ç½®
        error_page   500 502 503 504  /50x.html;
        #/50x.htmlæ–‡ä»¶æ‰€åœ¨ä½ç½®
        location = /50x.html {
            root   html;
        }
        
    }

}
```


æµ‹è¯•ï¼Œè®¿é—®192.168.8.101

![image-20220430185930024](https://gitlab.com/apzs/image/-/raw/master/image/1b7a5b0afded2ba14961e1bbd6d28828.png)

#### é…ç½®101çš„è´Ÿè½½å‡è¡¡ï¼ˆè½®è¯¢æ¨¡å¼ï¼‰

![image-20220430190409638](https://gitlab.com/apzs/image/-/raw/master/image/666d5e0ed07a7351ace225743985ce38.png)

 

```nginx
worker_processes  1; #å…è®¸è¿›ç¨‹æ•°é‡ï¼Œå»ºè®®è®¾ç½®ä¸ºcpuæ ¸å¿ƒæ•°æˆ–è€…autoè‡ªåŠ¨æ£€æµ‹ï¼Œæ³¨æ„WindowsæœåŠ¡å™¨ä¸Šè™½ç„¶å¯ä»¥å¯åŠ¨å¤šä¸ªprocessesï¼Œä½†æ˜¯å®é™…åªä¼šç”¨å…¶ä¸­ä¸€ä¸ª

events {
    #å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°=è¿æ¥æ•°*è¿›ç¨‹æ•°ï¼‰
    #æ ¹æ®ç¡¬ä»¶è°ƒæ•´ï¼Œå’Œå‰é¢å·¥ä½œè¿›ç¨‹é…åˆèµ·æ¥ç”¨ï¼Œå°½é‡å¤§ï¼Œä½†æ˜¯åˆ«æŠŠcpuè·‘åˆ°100%å°±è¡Œã€‚
    worker_connections  1024;
}


http {
    #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨(æ˜¯confç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶)
    include       mime.types;
    #é»˜è®¤æ–‡ä»¶ç±»å‹ï¼Œå¦‚æœmime.typesé¢„å…ˆå®šä¹‰çš„ç±»å‹æ²¡åŒ¹é…ä¸Šï¼Œé»˜è®¤ä½¿ç”¨äºŒè¿›åˆ¶æµçš„æ–¹å¼ä¼ è¾“
    default_type  application/octet-stream;

    #sendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸ºonã€‚å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œIOå¤„ç†é€Ÿåº¦ã€‚
    sendfile        on;
    
     #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’
    keepalive_timeout  65;

#å®šä¹‰ä¸€ç»„æœåŠ¡å™¨
upstream httpds{
    server 192.168.8.102:80;
    server 192.168.8.103:80;
}

 #è™šæ‹Ÿä¸»æœºçš„é…ç½®
    server {
    #ç›‘å¬ç«¯å£
        listen       80;
        #åŸŸåï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼éš”å¼€
        server_name  test80.xzj520520.cn;

	#é…ç½®æ ¹ç›®å½•ä»¥åŠé»˜è®¤é¡µé¢
        location / {
            proxy_pass http://httpds;
            # root   /www/test80;
            # index  index.html index.htm;
        }

	#å‡ºé”™é¡µé¢é…ç½®
        error_page   500 502 503 504  /50x.html;
        #/50x.htmlæ–‡ä»¶æ‰€åœ¨ä½ç½®
        location = /50x.html {
            root   html;
        }
        
    }
    

}
```


æµ‹è¯•ï¼š

å¤šæ¬¡è®¿é—®http://192.168.8.101/å‘ç°102å’Œ103è¢«äº¤æ›¿è®¿é—®

![image-20220430190456271](https://gitlab.com/apzs/image/-/raw/master/image/15c36a0e7c5383365cb15f4c40655406.png)

![image-20220430190504857](https://gitlab.com/apzs/image/-/raw/master/image/16d364f3c00253cb69b7f9616cdc97c3.png)

#### é…ç½®101çš„è´Ÿè½½å‡è¡¡ï¼ˆæƒé‡æ¨¡å¼ï¼‰

```nginx
worker_processes  1; #å…è®¸è¿›ç¨‹æ•°é‡ï¼Œå»ºè®®è®¾ç½®ä¸ºcpuæ ¸å¿ƒæ•°æˆ–è€…autoè‡ªåŠ¨æ£€æµ‹ï¼Œæ³¨æ„WindowsæœåŠ¡å™¨ä¸Šè™½ç„¶å¯ä»¥å¯åŠ¨å¤šä¸ªprocessesï¼Œä½†æ˜¯å®é™…åªä¼šç”¨å…¶ä¸­ä¸€ä¸ª

events {
    #å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°=è¿æ¥æ•°*è¿›ç¨‹æ•°ï¼‰
    #æ ¹æ®ç¡¬ä»¶è°ƒæ•´ï¼Œå’Œå‰é¢å·¥ä½œè¿›ç¨‹é…åˆèµ·æ¥ç”¨ï¼Œå°½é‡å¤§ï¼Œä½†æ˜¯åˆ«æŠŠcpuè·‘åˆ°100%å°±è¡Œã€‚
    worker_connections  1024;
}


http {
    #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨(æ˜¯confç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶)
    include       mime.types;
    #é»˜è®¤æ–‡ä»¶ç±»å‹ï¼Œå¦‚æœmime.typesé¢„å…ˆå®šä¹‰çš„ç±»å‹æ²¡åŒ¹é…ä¸Šï¼Œé»˜è®¤ä½¿ç”¨äºŒè¿›åˆ¶æµçš„æ–¹å¼ä¼ è¾“
    default_type  application/octet-stream;

    #sendfileæŒ‡ä»¤æŒ‡å®šnginxæ˜¯å¦è°ƒç”¨sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸ºonã€‚å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œIOå¤„ç†é€Ÿåº¦ã€‚
    sendfile        on;
    
     #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’
    keepalive_timeout  65;

#å®šä¹‰ä¸€ç»„æœåŠ¡å™¨
upstream httpds{
    server 192.168.8.102 weight=10;
    server 192.168.8.103 weight=1;
    # server 192.168.8.102 weight=10 down; #downè¡¨ç¤ºä¸å‚ä¸è´Ÿè½½å‡è¡¡
    # server 192.168.8.102 weight=10 backup; #backupè¡¨ç¤ºæ˜¯å¤‡ç”¨æœåŠ¡å™¨ï¼Œæ²¡æœ‰æœåŠ¡å™¨å¯ç”¨çš„æ—¶å€™ä½¿ç”¨
}

 #è™šæ‹Ÿä¸»æœºçš„é…ç½®
    server {
    #ç›‘å¬ç«¯å£
        listen       80;
        #åŸŸåï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ç©ºæ ¼éš”å¼€
        server_name  test80.xzj520520.cn;

	#é…ç½®æ ¹ç›®å½•ä»¥åŠé»˜è®¤é¡µé¢
        location / {
            proxy_pass http://httpds;
            # root   /www/test80;
            # index  index.html index.htm;
        }

	#å‡ºé”™é¡µé¢é…ç½®
        error_page   500 502 503 504  /50x.html;
        #/50x.htmlæ–‡ä»¶æ‰€åœ¨ä½ç½®
        location = /50x.html {
            root   html;
        }
        
    }
    

}
```


æµ‹è¯•ï¼š

å¤šæ¬¡è®¿é—®http://192.168.8.101/å‘ç°102è®¿é—®çš„æ¬¡æ•°å¤šä½™103è®¿é—®çš„æ¬¡æ•°ã€‚

#### å…¶ä»–è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆä¸å¸¸ç”¨ï¼‰

*   ip_hash

æ ¹æ®å®¢æˆ·ç«¯çš„ipåœ°å€è½¬å‘åŒä¸€å°æœåŠ¡å™¨ï¼Œå¯ä»¥ä¿æŒä¼šè¯ï¼Œä½†æ˜¯å¾ˆå°‘ç”¨è¿™ç§æ–¹å¼å»ä¿æŒä¼šè¯ï¼Œä¾‹å¦‚æˆ‘ä»¬å½“å‰æ­£åœ¨ä½¿ç”¨wifiè®¿é—®ï¼Œå½“åˆ‡æ¢æˆæ‰‹æœºä¿¡å·è®¿é—®æ—¶ï¼Œä¼šè¯å°±ä¸ä¿æŒäº†ã€‚

*   least_conn

æœ€å°‘è¿æ¥è®¿é—®ï¼Œä¼˜å…ˆè®¿é—®è¿æ¥æœ€å°‘çš„é‚£ä¸€å°æœåŠ¡å™¨ï¼Œè¿™ç§æ–¹å¼ä¹Ÿå¾ˆå°‘ä½¿ç”¨ï¼Œå› ä¸ºè¿æ¥å°‘ï¼Œå¯èƒ½æ˜¯ç”±äºè¯¥æœåŠ¡å™¨é…ç½®è¾ƒä½ï¼Œåˆšå¼€å§‹èµ‹äºˆçš„æƒé‡è¾ƒä½ã€‚

*   url_hashï¼ˆéœ€è¦ç¬¬ä¸‰æ–¹æ’ä»¶ï¼‰

æ ¹æ®ç”¨æˆ·è®¿é—®çš„urlå®šå‘è½¬å‘è¯·æ±‚ï¼Œä¸åŒçš„urlè½¬å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼ˆå®šå‘æµé‡è½¬å‘ï¼‰ã€‚

*   fairï¼ˆéœ€è¦ç¬¬ä¸‰æ–¹æ’ä»¶ï¼‰

æ ¹æ®åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´è½¬å‘è¯·æ±‚ï¼Œè¿™ç§æ–¹å¼ä¹Ÿå¾ˆå°‘ä½¿ç”¨ï¼Œå› ä¸ºå®¹æ˜“é€ æˆæµé‡å€¾æ–œï¼Œç»™æŸä¸€å°æœåŠ¡å™¨å‹å®ã€‚
