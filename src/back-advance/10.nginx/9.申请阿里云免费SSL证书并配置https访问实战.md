 

> 🌱本专栏将会从基础开始，循序渐进讲解Nginx的使用和有关配置，也请大家多多支持,希望大家都能够从中获益。  
> 📫专栏地址:[Nginx](https://blog.csdn.net/learning_xzj/category_11792194.html)  
> 📫相关软件:[链接地址](https://pan.baidu.com/s/12VmjEzxEKeiwrONceaWguA?pwd=aaaa)

### 文章目录

*   *   [使用阿里云配置https](#https_5)
    *   *   [实战](#_76)
    

使用阿里云配置https
------------

阿里云免费证书购买在如下位置：

![image-20220502180114579](https://gitlab.com/apzs/image/-/raw/master/image/75623dc67cb36f649da95b78a7f74f99.png)

![image-20220502180214498](https://gitlab.com/apzs/image/-/raw/master/image/bd00fb70abe129333354572c660fb670.png)

![image-20220502180253209](https://gitlab.com/apzs/image/-/raw/master/image/2c71e7a6c02cabfde45431ed5a55ab77.png)

购买完成后在如下位置创建证书并申请证书：

![image-20220502180721249](https://gitlab.com/apzs/image/-/raw/master/image/4fbf13f6e0e98049133f5d77a2f1400c.png)

填写验证信息

![image-20220502180746873](https://gitlab.com/apzs/image/-/raw/master/image/cf354daaeb3d26dffd0ec61949124689.png)

![image-20220502180905706](https://gitlab.com/apzs/image/-/raw/master/image/a0ebc865297fab463b6614082bfecbfb.png)

DNS对应的记录在如下页面：

![image-20220502185442580](https://gitlab.com/apzs/image/-/raw/master/image/6001a15ab5c5306a07fc66f0cb553a0c.png)

证书签发后，选择下载：

![image-20220502185524886](https://gitlab.com/apzs/image/-/raw/master/image/916f5f7fd55308cd17034fc78b01f213.png)

![image-20220502185354484](https://gitlab.com/apzs/image/-/raw/master/image/303201c7b58e2977a24a0e7982935a9e.png)

下载后的文件如图所示：

![image-20220502185627427](https://gitlab.com/apzs/image/-/raw/master/image/46f5beab54d365cf6b2187c80eb607ae.png)

接下来需要将这两个文件上传到nginx目录下的conf目录下：

![image-20220502185843137](https://gitlab.com/apzs/image/-/raw/master/image/3c3b6a8a0d6cbdbfda5f446295d280b5.png)

nginx配置证书：

```nginx
server {
	listen 443 ssl;
	server_name localhost;  # 接收所有访问443端口的请求
	ssl_certificate 7706851_www.xzj520520.cn.pem;
	ssl_certificate_key 7706851_www.xzj520520.cn.key;
}
```


配置完之后，重启nginx:

```nginx
systemctl restart nginx
```


由于http协议默认的端口是80，而https默认的端口是443，如果想让http的访问跳转到https的访问，可以做如下配置：

```nginx
server {

	listen 80;
	server_name www.xzj520520.cn xzj520520.cn; # 换成自己的域名
	...

	return 301 https://$server_name$request_uri;	

}
```


至此，已经完成https的配置。

### 实战

配置nginx.cfg

```nginx
user  www www;
worker_processes auto;
error_log  /www/wwwlogs/nginx_error.log  crit;
pid        /www/server/nginx/logs/nginx.pid;
worker_rlimit_nofile 51200;

events
    {
        use epoll;
        worker_connections 51200;
        multi_accept on;
    }

http
    {
        include       mime.types;

		include proxy.conf;

        default_type  application/octet-stream;

        server_names_hash_bucket_size 512;
        client_header_buffer_size 32k;
        large_client_header_buffers 4 32k;
        client_max_body_size 50m;

        sendfile   on;
        tcp_nopush on;

        keepalive_timeout 60;

        tcp_nodelay on;

        fastcgi_connect_timeout 300;
        fastcgi_send_timeout 300;
        fastcgi_read_timeout 300;
        fastcgi_buffer_size 64k;
        fastcgi_buffers 4 64k;
        fastcgi_busy_buffers_size 128k;
        fastcgi_temp_file_write_size 256k;
		fastcgi_intercept_errors on;

        gzip on;
        gzip_min_length  1k;
        gzip_buffers     4 16k;
        gzip_http_version 1.1;
        gzip_comp_level 2;
        gzip_types     text/plain application/javascript application/x-javascript text/javascript text/css application/xml;
        gzip_vary on;
        gzip_proxied   expired no-cache no-store private auth;
        gzip_disable   "MSIE [1-6]\.";

        limit_conn_zone $binary_remote_addr zone=perip:10m;
		limit_conn_zone $server_name zone=perserver:10m;

        server_tokens off;
        access_log off;

server {
	listen 443 ssl;
	server_name localhost;  
	ssl_certificate 7706851_www.xzj520520.cn.pem;
	ssl_certificate_key 7706851_www.xzj520520.cn.key;
	
	#配置根目录以及默认页面
        location / {
            root   html;
            index  index.html index.htm index.php;
        }

	#出错页面配置
        error_page   500 502 503 504  /50x.html;
        #/50x.html文件所在位置
        location = /50x.html {
            root   html;
        }
}

server {
	listen 80;
# 	server_name localhost www.xzj520520.cn xzj520520.cn; 
  server_name www.xzj520520.cn xzj520520.cn;

	# 重定向，会显示跳转的地址server_name,如果访问的地址没有匹配会默认使用第一个，即www.xzj520520.cn
	return 301 https://$server_name$request_uri;	
}

}
```


访问http://xzj520520.cn, 发现自动变成https访问：

![image-20220503091752269](https://gitlab.com/apzs/image/-/raw/master/image/debc77dd0c49471f9e9a2673179a2768.png)

访问https://a.xzj520520.cn,显示安全提示页面:

![image-20220503091912018](https://gitlab.com/apzs/image/-/raw/master/image/2b5395b8525d0e8d2b4cb517da2c3680.png)
